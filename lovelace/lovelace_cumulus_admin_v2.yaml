# â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
# â•‘ DASHBOARD CUMULUS - VERSION ADMIN/TECHNIQUE                                â•‘
# â•‘ Monitoring complet, diagnostics, configuration avancÃ©e                     â•‘
# â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

title: Cumulus Admin
path: cumulus-admin
icon: mdi:wrench
theme: Mushroom Shadow
type: custom:vertical-layout

cards:
  # â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  # â”‚ EN-TÃŠTE - VUE D'ENSEMBLE SYSTÃˆME                                        â”‚
  # â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  - type: custom:button-card
    name: SystÃ¨me Cumulus - Monitoring
    label: |
      [[[
        const uptime = states['sensor.cumulus_uptime']?.state || 'N/A';
        const version = states['sensor.cumulus_version']?.state || '2.0';
        const health = states['sensor.cumulus_score_sante']?.state || 0;
        return `Version ${version} Â· SantÃ© ${health}% Â· Uptime ${uptime}`;
      ]]]
    show_label: true
    styles:
      card:
        - height: 80px
        - background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)'
        - border-radius: 20px
      name:
        - font-size: 1.5rem
        - color: white
        - font-weight: 600
      label:
        - color: rgba(255,255,255,0.8)
        - font-size: 0.9rem

  # â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  # â”‚ SECTION 1 : Ã‰TAT TEMPS RÃ‰EL                                             â”‚
  # â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  - type: custom:mushroom-title-card
    title: ğŸ” Ã‰tat Temps RÃ©el
    subtitle: Monitoring instantanÃ© du systÃ¨me

  - type: horizontal-stack
    cards:
      # Ã‰tat Cumulus
      - type: custom:mushroom-entity-card
        entity: switch.shellypro1_ece334ee1b64
        name: Contacteur
        icon: mdi:power
        icon_color: |
          {% if is_state('switch.shellypro1_ece334ee1b64', 'on') %}
            green
          {% else %}
            grey
          {% endif %}
        primary_info: name
        secondary_info: state
        tap_action:
          action: toggle

      # Puissance instantanÃ©e
      - type: custom:mushroom-template-card
        primary: Puissance
        secondary: |
          {% if is_state('switch.shellypro1_ece334ee1b64', 'on') %}
            3000 W
          {% else %}
            0 W
          {% endif %}
        icon: mdi:flash
        icon_color: |
          {% if is_state('switch.shellypro1_ece334ee1b64', 'on') %}
            orange
          {% else %}
            grey
          {% endif %}

      # Mode actif
      - type: custom:mushroom-template-card
        primary: Mode
        secondary: |
          {% set mode = states('sensor.cumulus_mode_actif') %}
          {% if mode == 'PV' %}
            â˜€ï¸ Solaire
          {% elif mode == 'HC' %}
            ğŸŒ™ Heures Creuses
          {% elif mode == 'FORCE' %}
            ğŸ”¥ ForcÃ©
          {% else %}
            â¸ï¸ ArrÃªt
          {% endif %}
        icon: mdi:auto-mode
        icon_color: |
          {% set mode = states('sensor.cumulus_mode_actif') %}
          {% if mode == 'PV' %}
            yellow
          {% elif mode == 'HC' %}
            blue
          {% elif mode == 'FORCE' %}
            red
          {% else %}
            grey
          {% endif %}

  # Graphique production solaire temps rÃ©el
  - type: custom:apexcharts-card
    header:
      show: true
      title: Production Solaire & Import RÃ©seau
      show_states: true
      colorize_states: true
    graph_span: 3h
    update_interval: 30s
    yaxis:
      - id: power
        apex_config:
          title:
            text: Puissance (W)
    series:
      - entity: sensor.pv_total_entree_sb_aps_w
        name: Production PV
        color: '#ffd43b'
        type: area
        opacity: 0.3
        stroke_width: 2
        yaxis_id: power
        group_by:
          func: avg
          duration: 1min
      - entity: sensor.smart_meter_grid_import
        name: Import RÃ©seau
        color: '#ff6b6b'
        type: line
        stroke_width: 2
        yaxis_id: power
        transform: 'return x < 0 ? 0 : x;'
        group_by:
          func: avg
          duration: 1min
      - entity: sensor.cumulus_puissance_disponible_w
        name: Disponible Cumulus
        color: '#51cf66'
        type: line
        stroke_width: 3
        yaxis_id: power
        group_by:
          func: avg
          duration: 1min
    apex_config:
      chart:
        height: 250
      grid:
        show: true
        borderColor: '#90A4AE20'
      tooltip:
        enabled: true
        shared: true
      legend:
        position: top
    card_mod:
      style: |
        ha-card {
          background: rgba(255,255,255,0.05);
          border: 1px solid rgba(255,255,255,0.1);
        }

  # â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  # â”‚ SECTION 2 : ANALYSE TEMPÃ‰RATURE & CHAUFFES                              â”‚
  # â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  - type: custom:mushroom-title-card
    title: ğŸŒ¡ï¸ Analyse Thermique
    subtitle: Ã‰volution tempÃ©rature et historique chauffes

  - type: custom:apexcharts-card
    header:
      show: true
      title: TempÃ©rature Cumulus (48h)
      show_states: true
    graph_span: 48h
    yaxis:
      - id: temp
        min: 20
        max: 70
        apex_config:
          title:
            text: TempÃ©rature (Â°C)
      - id: state
        opposite: true
        min: 0
        max: 1
        show: false
    series:
      - entity: sensor.cumulus_temperature_estimee
        name: TempÃ©rature
        color: '#ff6b6b'
        type: line
        stroke_width: 3
        yaxis_id: temp
        group_by:
          func: avg
          duration: 10min
      - entity: sensor.cumulus_temperature_consigne
        name: Consigne
        color: '#339af0'
        type: line
        stroke_width: 1
        stroke_dash_array: 5
        yaxis_id: temp
      - entity: switch.shellypro1_ece334ee1b64
        name: Chauffes
        color: '#ffd43b'
        type: area
        opacity: 0.2
        yaxis_id: state
        transform: 'return x === "on" ? 1 : 0;'
        show:
          in_header: false
    apex_config:
      chart:
        height: 300
      annotations:
        yaxis:
          - y: 55
            borderColor: '#51cf66'
            strokeDashArray: 5
            label:
              text: Optimal
              style:
                color: '#51cf66'
          - y: 45
            borderColor: '#ffa94d'
            strokeDashArray: 5
            label:
              text: Minimum
              style:
                color: '#ffa94d'
    card_mod:
      style: |
        ha-card {
          background: rgba(255,255,255,0.05);
          border: 1px solid rgba(255,255,255,0.1);
        }

  # Tableau historique des chauffes
  - type: custom:fold-entity-row
    head:
      type: custom:mushroom-template-card
      primary: ğŸ“Š Historique Chauffes (7 derniers jours)
      secondary: "{{ states('sensor.cumulus_nombre_chauffes_semaine') }} chauffes Â· {{ states('sensor.cumulus_kwh_semaine') }} kWh"
      icon: mdi:table
    entities:
      - type: custom:flex-table-card
        entities:
          - sensor.cumulus_historique_chauffes
        columns:
          - name: Date
            data: date
            align: left
            modify: |
              if (x) {
                const d = new Date(x);
                return d.toLocaleDateString('fr-FR', {day: 'numeric', month: 'short'});
              }
              return '-';
          - name: Heure
            data: time
            align: center
          - name: DurÃ©e
            data: duration
            align: center
            suffix: ' min'
          - name: Mode
            data: mode
            align: center
            modify: |
              if (x === 'PV') return 'â˜€ï¸ PV';
              if (x === 'HC') return 'ğŸŒ™ HC';
              if (x === 'FORCE') return 'ğŸ”¥ Force';
              return x;
          - name: kWh
            data: energy
            align: right
            suffix: ' kWh'
            modify: 'parseFloat(x).toFixed(1)'
          - name: CoÃ»t
            data: cost
            align: right
            prefix: 'â‚¬'
            modify: 'parseFloat(x).toFixed(2)'
        card_mod:
          style: |
            ha-card {
              background: rgba(255,255,255,0.05);
              border: 1px solid rgba(255,255,255,0.1);
            }

  # â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  # â”‚ SECTION 3 : AUTOMATIONS & LOGIQUE                                       â”‚
  # â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  - type: custom:mushroom-title-card
    title: âš™ï¸ Automations & Logique
    subtitle: Ã‰tat des automatismes et conditions

  - type: grid
    columns: 2
    cards:
      # Automation PV
      - type: custom:mushroom-template-card
        primary: Automation PV
        secondary: |
          {% set last = state_attr('automation.cumulus_demarrage_pv', 'last_triggered') %}
          {% if last %}
            Dernier: {{ relative_time(last) }}
          {% else %}
            Jamais dÃ©clenchÃ©e
          {% endif %}
        icon: mdi:solar-power
        icon_color: |
          {% if is_state('automation.cumulus_demarrage_pv', 'on') %}
            green
          {% else %}
            red
          {% endif %}
        badge_icon: |
          {% set count = state_attr('automation.cumulus_demarrage_pv', 'current') %}
          {% if count and count > 0 %}
            mdi:play
          {% endif %}
        badge_color: orange
        tap_action:
          action: more-info
          entity: automation.cumulus_demarrage_pv

      # Automation HC
      - type: custom:mushroom-template-card
        primary: Automation HC
        secondary: |
          {% set last = state_attr('automation.cumulus_demarrage_hc', 'last_triggered') %}
          {% if last %}
            Dernier: {{ relative_time(last) }}
          {% else %}
            Jamais dÃ©clenchÃ©e
          {% endif %}
        icon: mdi:moon-waning-crescent
        icon_color: |
          {% if is_state('automation.cumulus_demarrage_hc', 'on') %}
            green
          {% else %}
            red
          {% endif %}
        tap_action:
          action: more-info
          entity: automation.cumulus_demarrage_hc

      # Limiteur Import
      - type: custom:mushroom-template-card
        primary: Limiteur Import
        secondary: |
          {% if is_state('automation.cumulus_limiteur_import', 'on') %}
            Actif Â· Seuil {{ states('input_number.cumulus_import_max_w') }}W
          {% else %}
            DÃ©sactivÃ©
          {% endif %}
        icon: mdi:shield-check
        icon_color: |
          {% if is_state('automation.cumulus_limiteur_import', 'on') %}
            green
          {% else %}
            grey
          {% endif %}

      # Verrous SystÃ¨me
      - type: custom:mushroom-template-card
        primary: Verrous
        secondary: |
          {% set deadband = is_state('input_boolean.cumulus_verrou_deadband', 'on') %}
          {% set daily = is_state('input_boolean.cumulus_verrou_chauffe_quotidienne', 'on') %}
          {% if deadband or daily %}
            âš ï¸ {{ 'Deadband' if deadband }}{{ ' + ' if deadband and daily }}{{ 'Quotidien' if daily }}
          {% else %}
            âœ… Aucun verrou actif
          {% endif %}
        icon: mdi:lock
        icon_color: |
          {% set deadband = is_state('input_boolean.cumulus_verrou_deadband', 'on') %}
          {% set daily = is_state('input_boolean.cumulus_verrou_chauffe_quotidienne', 'on') %}
          {% if deadband or daily %}
            orange
          {% else %}
            green
          {% endif %}

  # Conditions dÃ©taillÃ©es
  - type: custom:fold-entity-row
    head:
      type: custom:mushroom-template-card
      primary: ğŸ” Conditions DÃ©taillÃ©es
      secondary: Analyse des conditions de dÃ©marrage
      icon: mdi:format-list-checks
    entities:
      - type: custom:mushroom-template-card
        primary: Conditions PV
        secondary: |
          âœ“ Production: {{ states('sensor.cumulus_production_aps_w') }}W / {{ states('input_number.cumulus_seuil_pv_dynamique_w') }}W
          âœ“ Import: {{ states('sensor.cumulus_import_reseau_w') }}W < {{ states('input_number.cumulus_import_max_w') }}W
          âœ“ SOC: {{ states('sensor.system_sanguinet_etat_de_charge_du_sb') }}% > {{ states('input_number.cumulus_soc_min') }}%
          âœ“ FenÃªtre: {{ 'OUI' if is_state('binary_sensor.cumulus_fenetre_pv', 'on') else 'NON' }}
          âœ“ Verrous: {{ 'LIBRE' if is_state('binary_sensor.cumulus_conditions_ok', 'on') else 'BLOQUÃ‰' }}
        multiline_secondary: true
        icon: mdi:solar-panel
        icon_color: |
          {% if is_state('binary_sensor.cumulus_conditions_pv_ok', 'on') %}
            green
          {% else %}
            red
          {% endif %}

      - type: custom:mushroom-template-card
        primary: Conditions HC
        secondary: |
          âœ“ Heures Creuses: {{ 'OUI' if is_state('binary_sensor.heures_creuses', 'on') else 'NON' }}
          âœ“ Besoin eau: {{ states('sensor.cumulus_temperature_estimee') }}Â°C < {{ states('input_number.cumulus_temperature_cible_hc') }}Â°C
          âœ“ DerniÃ¨re chauffe: il y a {{ states('sensor.cumulus_heures_depuis_derniere_chauffe') }}h
          âœ“ Mode vacances: {{ 'ACTIF' if is_state('input_boolean.cumulus_mode_vacances', 'on') else 'INACTIF' }}
        multiline_secondary: true
        icon: mdi:moon-waning-crescent
        icon_color: |
          {% if is_state('binary_sensor.cumulus_conditions_hc_ok', 'on') %}
            green
          {% else %}
            red
          {% endif %}

  # â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  # â”‚ SECTION 4 : CONFIGURATION & RÃ‰GLAGES                                    â”‚
  # â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  - type: custom:mushroom-title-card
    title: ğŸ›ï¸ Configuration
    subtitle: ParamÃ¨tres et rÃ©glages fins

  - type: custom:fold-entity-row
    head:
      type: custom:mushroom-template-card
      primary: âš¡ Seuils Puissance
      secondary: RÃ©glages dÃ©clenchement et protection
      icon: mdi:tune
    entities:
      - entity: input_number.cumulus_seuil_pv_statique_w
        name: Seuil PV de base
      - entity: input_number.cumulus_seuil_pv_dynamique_w
        name: Seuil PV dynamique
      - entity: input_number.cumulus_import_max_w
        name: Import max autorisÃ©
      - entity: input_number.cumulus_talon_maison_w
        name: Talon consommation maison
      - entity: input_number.cumulus_solarbank_max_w
        name: Puissance max Solarbank

  - type: custom:fold-entity-row
    head:
      type: custom:mushroom-template-card
      primary: ğŸŒ¡ï¸ TempÃ©ratures
      secondary: Consignes et objectifs
      icon: mdi:thermometer
    entities:
      - entity: input_number.cumulus_temperature_cible_pv
        name: Cible PV (Â°C)
      - entity: input_number.cumulus_temperature_cible_hc
        name: Cible HC (Â°C)
      - entity: input_number.cumulus_temperature_minimale
        name: Minimum absolu (Â°C)
      - entity: input_number.cumulus_gradient_refroidissement
        name: Gradient refroidissement (Â°C/h)

  - type: custom:fold-entity-row
    head:
      type: custom:mushroom-template-card
      primary: â±ï¸ Temporisations
      secondary: DÃ©lais et fenÃªtres horaires
      icon: mdi:timer-settings
    entities:
      - entity: input_number.cumulus_delai_on_secondes
        name: DÃ©lai dÃ©marrage (sec)
      - entity: input_number.cumulus_delai_off_secondes
        name: DÃ©lai arrÃªt (sec)
      - entity: input_datetime.cumulus_heure_debut_pv
        name: DÃ©but fenÃªtre PV
      - entity: input_datetime.cumulus_heure_fin_pv
        name: Fin fenÃªtre PV
      - entity: input_number.cumulus_espacement_minimal_heures
        name: Espacement min chauffes (h)

  # â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  # â”‚ SECTION 5 : DIAGNOSTIC & SANTÃ‰                                          â”‚
  # â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  - type: custom:mushroom-title-card
    title: ğŸ¥ Diagnostic SystÃ¨me
    subtitle: SantÃ© et cohÃ©rence

  - type: custom:button-card
    name: Score de SantÃ© Global
    label: |
      [[[
        const score = states['sensor.cumulus_score_sante']?.state || 0;
        const details = states['sensor.cumulus_diagnostic_details']?.state || '';
        return `${score}% Â· ${details}`;
      ]]]
    icon: |
      [[[
        const score = states['sensor.cumulus_score_sante']?.state || 0;
        if (score >= 80) return 'mdi:check-circle';
        if (score >= 60) return 'mdi:alert';
        return 'mdi:alert-circle';
      ]]]
    show_label: true
    styles:
      card:
        - height: 100px
        - background: |
            [[[
              const score = states['sensor.cumulus_score_sante']?.state || 0;
              if (score >= 80) return 'linear-gradient(135deg, #51cf66 0%, #69db7c 100%)';
              if (score >= 60) return 'linear-gradient(135deg, #ffd43b 0%, #fab005 100%)';
              return 'linear-gradient(135deg, #ff6b6b 0%, #ff8787 100%)';
            ]]]
      name:
        - font-size: 1.3rem
        - color: white
      label:
        - color: rgba(255,255,255,0.9)
      icon:
        - color: white
        - width: 50px

  # Tests diagnostiques
  - type: grid
    columns: 3
    cards:
      - type: custom:mushroom-template-card
        primary: CohÃ©rence
        secondary: |
          {% if is_state('binary_sensor.cumulus_coherence_ok', 'on') %}
            âœ… OK
          {% else %}
            âŒ Erreur
          {% endif %}
        icon: mdi:check-network
        icon_color: |
          {% if is_state('binary_sensor.cumulus_coherence_ok', 'on') %}
            green
          {% else %}
            red
          {% endif %}

      - type: custom:mushroom-template-card
        primary: Sensors
        secondary: |
          {% set unavail = states.sensor | selectattr('entity_id', 'match', 'cumulus') | selectattr('state', 'eq', 'unavailable') | list | count %}
          {% if unavail == 0 %}
            âœ… Tous OK
          {% else %}
            âš ï¸ {{ unavail }} indispo
          {% endif %}
        icon: mdi:resistor-nodes
        icon_color: |
          {% set unavail = states.sensor | selectattr('entity_id', 'match', 'cumulus') | selectattr('state', 'eq', 'unavailable') | list | count %}
          {% if unavail == 0 %}
            green
          {% else %}
            orange
          {% endif %}

      - type: custom:mushroom-template-card
        primary: Automations
        secondary: |
          {% set off = states.automation | selectattr('entity_id', 'match', 'cumulus') | selectattr('state', 'eq', 'off') | list | count %}
          {% if off == 0 %}
            âœ… Actives
          {% else %}
            âš ï¸ {{ off }} inactives
          {% endif %}
        icon: mdi:robot
        icon_color: |
          {% set off = states.automation | selectattr('entity_id', 'match', 'cumulus') | selectattr('state', 'eq', 'off') | list | count %}
          {% if off == 0 %}
            green
          {% else %}
            orange
          {% endif %}

  # Logs systÃ¨me
  - type: custom:fold-entity-row
    head:
      type: custom:mushroom-template-card
      primary: ğŸ“ Logs SystÃ¨me
      secondary: Derniers Ã©vÃ©nements
      icon: mdi:text-box-outline
    entities:
      - type: custom:logbook-card
        entity: switch.shellypro1_ece334ee1b64
        max_items: 10
        collapse: 2
        card_mod:
          style: |
            ha-card {
              background: rgba(255,255,255,0.05);
              border: 1px solid rgba(255,255,255,0.1);
            }

  # â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  # â”‚ SECTION 6 : ACTIONS RAPIDES ADMIN                                       â”‚
  # â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  - type: custom:mushroom-title-card
    title: ğŸš€ Actions Rapides
    subtitle: Commandes administrateur

  - type: grid
    columns: 3
    cards:
      - type: custom:button-card
        name: Reset Verrous
        icon: mdi:lock-reset
        tap_action:
          action: call-service
          service: script.cumulus_reset_verrous
          confirmation:
            text: RÃ©initialiser tous les verrous ?
        styles:
          card:
            - height: 80px
            - background: 'linear-gradient(135deg, #339af0 0%, #74c0fc 100%)'
          name:
            - color: white
            - font-size: 0.9rem
          icon:
            - color: white

      - type: custom:button-card
        name: Test SystÃ¨me
        icon: mdi:test-tube
        tap_action:
          action: call-service
          service: script.cumulus_test_systeme
        styles:
          card:
            - height: 80px
            - background: 'linear-gradient(135deg, #51cf66 0%, #69db7c 100%)'
          name:
            - color: white
            - font-size: 0.9rem
          icon:
            - color: white

      - type: custom:button-card
        name: Export Stats
        icon: mdi:download
        tap_action:
          action: call-service
          service: script.cumulus_export_stats
        styles:
          card:
            - height: 80px
            - background: 'linear-gradient(135deg, #ffd43b 0%, #fab005 100%)'
          name:
            - color: white
            - font-size: 0.9rem
          icon:
            - color: white
