{
  "version": 1,
  "minor_version": 1,
  "key": "lovelace.dashboard_expe",
  "data": {
    "config": {
      "views": [
        {
          "title": "En cours",
          "path": "en-cours",
          "icon": "mdi:alarm-light-outline",
          "cards": [
            {
              "type": "custom:mushroom-number-card",
              "entity": "number.thermostat_salle_de_bain_preset_boost_temp"
            },
            {
              "type": "grid",
              "square": false,
              "columns": 1,
              "cards": [
                {
                  "type": "entities",
                  "entities": [
                    {
                      "entity": "number.thermostat_salle_de_bain_preset_comfort_temp",
                      "name": "Confort"
                    },
                    {
                      "entity": "number.thermostat_salle_de_bain_preset_eco_temp",
                      "name": "Eco"
                    }
                  ],
                  "title": "Thermostat Salle de Bain"
                },
                {
                  "type": "thermostat",
                  "entity": "climate.thermostat_sdb",
                  "features": [
                    {
                      "type": "climate-hvac-modes",
                      "hvac_modes": [
                        "heat",
                        "off"
                      ]
                    }
                  ]
                }
              ]
            },
            {
              "type": "custom:vertical-stack-in-card",
              "cards": [
                {
                  "type": "custom:mushroom-climate-card",
                  "tap_action": {
                    "action": "none"
                  },
                  "hold_action": {
                    "action": "more-info"
                  },
                  "double_tap_action": {
                    "action": "none"
                  },
                  "show_temperature_control": true,
                  "hvac_modes": [
                    "heat",
                    "off",
                    "cool"
                  ],
                  "layout": "horizontal",
                  "icon": "mdi:sofa",
                  "secondary_info": "none",
                  "name": "S√©jour",
                  "entity": "climate.daikin_split_salon_room_temperature"
                },
                {
                  "type": "grid",
                  "square": false,
                  "columns": 2,
                  "cards": [
                    {
                      "type": "custom:mushroom-entity-card",
                      "entity": "sensor.thermo_salon_temperature",
                      "primary_info": "state",
                      "secondary_info": "name",
                      "name": "Temperature",
                      "icon_color": "green"
                    },
                    {
                      "type": "custom:mushroom-entity-card",
                      "entity": "sensor.thermo_salon_humidity",
                      "primary_info": "state",
                      "secondary_info": "name",
                      "name": "Humidity",
                      "icon_color": "blue"
                    }
                  ]
                }
              ]
            },
            {
              "type": "vertical-stack",
              "cards": [
                {
                  "type": "custom:simple-thermostat",
                  "card_mod": {
                    "style": "ha-card {\n  --st-font-size-xl: 24px;\n  --st-font-size-m: 18px;\n  --st-font-size-title: 20px;\n  --st-font-size-sensors: 18px;\n  --st-spacing: 2px;\n}\n.mode-item {\n  --border-radius: 20px;\n}\n"
                  },
                  "header": {
                    "name": "S√©jour",
                    "icon": "mdi:sofa"
                  },
                  "entity": "climate.daikin_split_salon_room_temperature",
                  "hide": {
                    "temperature": true,
                    "state": true
                  },
                  "layout": {
                    "mode": {
                      "headings": false
                    }
                  },
                  "step_size": 0.5,
                  "decimals": 1,
                  "sensors": [
                    {
                      "entity": "sensor.thermo_salon_temperature",
                      "icon": "mdi:home-thermometer-outline",
                      "name": "Temp√©rature"
                    },
                    {
                      "entity": "sensor.thermo_salon_humidity",
                      "icon": "mdi:water",
                      "name": "Humidit√©"
                    }
                  ],
                  "control": {
                    "fan": {
                      "quiet": {
                        "name": "Silence"
                      }
                    },
                    "hvac": {
                      "off": {
                        "name": null,
                        "icon": "mdi:power"
                      },
                      "heat": {
                        "name": null,
                        "icon": "mdi:fire"
                      },
                      "cool": {
                        "name": null
                      },
                      "heat_cool": false,
                      "dry": false,
                      "fan_only": false
                    }
                  }
                }
              ]
            },
            {
              "type": "custom:vertical-stack-in-card",
              "card_mod": {
                "style": "ha-card {\n  background: rgba(255,255,255,0.03);\n  border-radius: 14px;\n  padding: 12px;\n  box-shadow: 0px 2px 8px rgba(0,0,0,0.15);\n}\n"
              },
              "cards": [
                {
                  "type": "markdown",
                  "content": "## üöø  Salle de Bain",
                  "card_mod": {
                    "style": "ha-card {\n  background: transparent;\n  box-shadow: none;\n  padding: 0 0 8px 0;\n}\n"
                  }
                },
                {
                  "type": "custom:mushroom-climate-card",
                  "entity": "climate.thermostat_sdb",
                  "icon": "mdi:shower",
                  "show_name": false,
                  "tap_action": "none",
                  "hold_action": "more-info",
                  "layout": "horizontal",
                  "show_temperature_control": true,
                  "hvac_modes": [
                    "heat",
                    "off"
                  ]
                },
                {
                  "type": "grid",
                  "columns": 2,
                  "square": false,
                  "cards": [
                    {
                      "type": "custom:button-card",
                      "entity": "sensor.thermo_sdb_temperature",
                      "name": "üå° Temp√©rature",
                      "show_icon": false,
                      "show_name": true,
                      "show_state": true,
                      "styles": {
                        "card": [
                          {
                            "background": "rgba(255,140,0,0.1)"
                          },
                          {
                            "border-radius": "10px"
                          },
                          {
                            "padding": "8px"
                          }
                        ],
                        "name": [
                          {
                            "font-size": "14px"
                          },
                          {
                            "font-weight": "bold"
                          }
                        ]
                      }
                    },
                    {
                      "type": "custom:button-card",
                      "entity": "sensor.thermo_sdb_humidity",
                      "name": "üíß Humidit√©",
                      "show_icon": false,
                      "show_name": true,
                      "show_state": true,
                      "styles": {
                        "card": [
                          {
                            "background": "rgba(30,144,255,0.1)"
                          },
                          {
                            "border-radius": "10px"
                          },
                          {
                            "padding": "8px"
                          }
                        ],
                        "name": [
                          {
                            "font-size": "14px"
                          },
                          {
                            "font-weight": "bold"
                          }
                        ]
                      }
                    }
                  ]
                }
              ]
            },
            {
              "type": "custom:vertical-stack-in-card",
              "card_mod": {
                "style": "/* keyframes pour l‚Äôanimation ‚Äúheartbeat‚Äù */\n@keyframes heartbeat {\n  0%   { transform: scale(1); }\n  25%  { transform: scale(1.15); }\n  50%  { transform: scale(1); }\n  75%  { transform: scale(1.15); }\n  100% { transform: scale(1); }\n}\n/* style du container */\nha-card {\n  background: rgba(255,255,255,0.03);\n  border-radius: 14px;\n  padding: 0;\n  box-shadow: 0 2px 8px rgba(0,0,0,0.15);\n}\n"
              },
              "cards": [
                {
                  "type": "custom:layout-card",
                  "layout_type": "horizontal",
                  "layout_options": {
                    "widths": [
                      "56px",
                      "auto",
                      "auto"
                    ]
                  },
                  "cards": [
                    {
                      "type": "custom:button-card",
                      "entity": "climate.thermostat_sdb",
                      "icon": "mdi:shower",
                      "show_icon": true,
                      "show_name": false,
                      "show_state": false,
                      "tap_action": "none",
                      "styles": {
                        "card": [
                          {
                            "height": "56px"
                          },
                          {
                            "width": "56px"
                          },
                          {
                            "background": "rgba(255,255,255,0.05)"
                          },
                          {
                            "border-radius": "12px"
                          },
                          {
                            "box-shadow": "none"
                          },
                          {
                            "margin": "4px"
                          }
                        ],
                        "icon": [
                          {
                            "width": "28px"
                          }
                        ]
                      },
                      "state": [
                        {
                          "value": "heat",
                          "styles": {
                            "card": [
                              {
                                "animation": "heartbeat 1.5s infinite"
                              }
                            ],
                            "icon": [
                              {
                                "filter": "drop-shadow(0 0 6px"
                              }
                            ]
                          }
                        }
                      ]
                    },
                    {
                      "type": "custom:button-card",
                      "entity": "climate.thermostat_sdb",
                      "show_icon": false,
                      "show_state": false,
                      "show_name": true,
                      "tap_action": {
                        "action": "more-info"
                      },
                      "name": "[[[\n  const t = entity.attributes.temperature.toFixed(1);\n  const mode = (entity.state === 'heat') ? 'üî• Chauffe' : '‚èπ √âteint';\n  return `Salle de Bain ${t}¬∞C ¬∑ ${mode}`;\n]]]\n",
                      "styles": {
                        "card": [
                          {
                            "background": "transparent"
                          },
                          {
                            "box-shadow": "none"
                          },
                          {
                            "padding": "16px 4px"
                          },
                          {
                            "text-align": "left"
                          }
                        ],
                        "name": [
                          {
                            "font-size": "17px"
                          },
                          {
                            "font-weight": "bold"
                          },
                          {
                            "color": "[[[\n  return (entity.state === 'heat')\n    ? 'var(--paper-item-icon-active-color)'\n    : 'var(--secondary-text-color)';\n]]]\n"
                          }
                        ]
                      }
                    },
                    {
                      "type": "custom:button-card",
                      "entity": "sensor.thermo_sdb_temperature",
                      "show_icon": false,
                      "show_name": false,
                      "show_state": true,
                      "tap_action": "none",
                      "styles": {
                        "card": [
                          {
                            "background": "rgba(255,255,255,0.05)"
                          },
                          {
                            "border-radius": "8px"
                          },
                          {
                            "height": "32px"
                          },
                          {
                            "min-width": "48px"
                          },
                          {
                            "margin": "12px 8px 12px 0"
                          },
                          {
                            "box-shadow": "none"
                          }
                        ],
                        "state": [
                          {
                            "font-size": "14px"
                          },
                          {
                            "font-weight": "bold"
                          },
                          {
                            "color": "var(--primary-text-color)"
                          }
                        ]
                      }
                    }
                  ]
                },
                {
                  "type": "grid",
                  "columns": 2,
                  "square": false,
                  "style": "ha-card {\n  padding: 8px;\n  box-shadow: none;\n  background: transparent;\n}\n",
                  "cards": [
                    {
                      "type": "custom:button-card",
                      "entity": "sensor.thermo_sdb_temperature",
                      "name": "üå° Temp√©rature",
                      "show_icon": false,
                      "show_name": true,
                      "show_state": true,
                      "styles": {
                        "card": [
                          {
                            "background": "rgba(255,140,0,0.1)"
                          },
                          {
                            "border-radius": "10px"
                          },
                          {
                            "padding": "8px"
                          },
                          {
                            "height": "60px"
                          }
                        ],
                        "state": [
                          {
                            "font-size": "16px"
                          },
                          {
                            "font-weight": "bold"
                          }
                        ]
                      }
                    },
                    {
                      "type": "custom:button-card",
                      "entity": "sensor.thermo_sdb_humidity",
                      "name": "üíß Humidit√©",
                      "show_icon": false,
                      "show_name": true,
                      "show_state": true,
                      "styles": {
                        "card": [
                          {
                            "background": "rgba(30,144,255,0.1)"
                          },
                          {
                            "border-radius": "10px"
                          },
                          {
                            "padding": "8px"
                          },
                          {
                            "height": "60px"
                          }
                        ],
                        "state": [
                          {
                            "font-size": "16px"
                          },
                          {
                            "font-weight": "bold"
                          }
                        ]
                      }
                    }
                  ]
                }
              ]
            },
            {
              "type": "vertical-stack",
              "cards": [
                {
                  "type": "horizontal-stack",
                  "cards": [
                    {
                      "type": "custom:button-card",
                      "name": "Off",
                      "icon": "mdi:power",
                      "tap_action": {
                        "action": "call-service",
                        "service": "climate.set_hvac_mode",
                        "service_data": {
                          "entity_id": "climate.daikin_split_salon_room_temperature",
                          "hvac_mode": "off"
                        }
                      },
                      "styles": {
                        "card": [
                          {
                            "padding": "8px"
                          },
                          {
                            "font-size": "14px"
                          },
                          {
                            "text-transform": "uppercase"
                          },
                          {
                            "border-radius": "8px"
                          },
                          {
                            "box-shadow": "0 1px 3px rgba(0,0,0,0.2)"
                          },
                          {
                            "background-color": "#eeeeee"
                          },
                          {
                            "color": "#424242"
                          }
                        ]
                      }
                    },
                    {
                      "type": "custom:button-card",
                      "name": "Chauffage",
                      "icon": "mdi:fire",
                      "tap_action": {
                        "action": "call-service",
                        "service": "climate.set_hvac_mode",
                        "service_data": {
                          "entity_id": "climate.daikin_split_salon_room_temperature",
                          "hvac_mode": "heat"
                        }
                      },
                      "styles": {
                        "card": [
                          {
                            "background-color": "#ffebee"
                          },
                          {
                            "color": "#b71c1c"
                          }
                        ]
                      }
                    },
                    {
                      "type": "custom:button-card",
                      "name": "Froid",
                      "icon": "mdi:snowflake",
                      "tap_action": {
                        "action": "call-service",
                        "service": "climate.set_hvac_mode",
                        "service_data": {
                          "entity_id": "climate.daikin_split_salon_room_temperature",
                          "hvac_mode": "cool"
                        }
                      },
                      "styles": {
                        "card": [
                          {
                            "background-color": "#e1f5fe"
                          },
                          {
                            "color": "#01579b"
                          }
                        ]
                      }
                    },
                    {
                      "type": "custom:button-card",
                      "name": "Actualiser",
                      "icon": "mdi:refresh",
                      "tap_action": {
                        "action": "call-service",
                        "service": "homeassistant.update_entity",
                        "service_data": {
                          "entity_id": "climate.daikin_split_salon_room_temperature"
                        }
                      },
                      "styles": {
                        "card": [
                          {
                            "padding": "8px"
                          },
                          {
                            "font-size": "14px"
                          },
                          {
                            "font-weight": "bold"
                          },
                          {
                            "text-transform": "uppercase"
                          },
                          {
                            "border-radius": "8px"
                          },
                          {
                            "box-shadow": "0 1px 3px rgba(0,0,0,0.2)"
                          },
                          {
                            "background-color": "#e3f2fd"
                          },
                          {
                            "color": "#1e88e5"
                          }
                        ]
                      }
                    }
                  ]
                },
                {
                  "type": "horizontal-stack",
                  "cards": [
                    {
                      "type": "custom:button-card",
                      "entity": "sensor.thermo_salon_temperature",
                      "name": "Temp√©rature",
                      "show_icon": true,
                      "show_name": true,
                      "show_state": true,
                      "icon": "mdi:home-thermometer-outline",
                      "styles": {
                        "card": [
                          {
                            "padding": "8px"
                          },
                          {
                            "font-size": "14px"
                          },
                          {
                            "border-radius": "8px"
                          },
                          {
                            "box-shadow": "0 1px 3px rgba(0,0,0,0.2)"
                          },
                          {
                            "background-color": "#fffde7"
                          },
                          {
                            "color": "#827717"
                          }
                        ]
                      }
                    },
                    {
                      "type": "custom:button-card",
                      "entity": "sensor.thermo_salon_humidity",
                      "name": "Humidit√©",
                      "show_icon": true,
                      "show_name": true,
                      "show_state": true,
                      "icon": "mdi:water",
                      "styles": {
                        "card": [
                          {
                            "padding": "8px"
                          },
                          {
                            "font-size": "14px"
                          },
                          {
                            "border-radius": "8px"
                          },
                          {
                            "box-shadow": "0 1px 3px rgba(0,0,0,0.2)"
                          },
                          {
                            "background-color": "#e8f5e9"
                          },
                          {
                            "color": "#1b5e20"
                          }
                        ]
                      }
                    }
                  ]
                }
              ]
            },
            {
              "type": "vertical-stack",
              "cards": [
                {
                  "type": "custom:mini-graph-card",
                  "name": "Puissance Solaire & D√©charge",
                  "icon": "mdi:solar-power",
                  "entities": [
                    {
                      "entity": "sensor.system_sanguinet_energie_solaire_sb",
                      "name": "Solaire (W)"
                    },
                    {
                      "entity": "sensor.system_sanguinet_alimentation_domestique_sb",
                      "name": "D√©charge vers maison (W)"
                    }
                  ],
                  "hours_to_show": 24,
                  "line_width": 2,
                  "points_per_hour": 4,
                  "animate": true,
                  "show": {
                    "legend": true,
                    "labels": true
                  }
                },
                {
                  "type": "custom:mini-graph-card",
                  "name": "Flux de charge Solarbank",
                  "icon": "mdi:battery-arrow-down",
                  "entities": [
                    {
                      "entity": "sensor.system_sanguinet_alimentation_de_la_batterie_sb",
                      "name": "Charge batterie (W)"
                    }
                  ],
                  "hours_to_show": 24,
                  "line_width": 2,
                  "points_per_hour": 4,
                  "show": {
                    "labels": true
                  }
                },
                {
                  "type": "sensor",
                  "name": "Rendement total",
                  "entity": "sensor.system_sanguinet_rendement_total",
                  "icon": "mdi:chart-bar",
                  "detail": 2
                }
              ]
            },
            {
              "type": "custom:simple-thermostat",
              "card_mod": {
                "style": "ha-card {\n  --st-font-size-title: 20px;\n  --st-font-size-xl: 20px;\n  --st-font-size-m: 16px;\n  --st-font-size-sensors: 15px;\n  padding: 8px;\n}\n.header {\n  display: flex;\n  justify-content: flex-end;\n  padding: 2px 0 6px 0;\n}\nh2.title {\n  font-size: var(--st-font-size-title);\n  font-weight: bold;\n  text-align: right;\n  margin: 0;\n}\n.sensors {\n  margin-bottom: 12px;\n  padding-bottom: 6px;\n  border-bottom: 1px solid var(--divider-color, #ddd);\n}\n.sensors .entity .name,\n.sensors .entity .value {\n  font-weight: bold;\n}\n.value {\n  font-weight: bold;\n}\n.mode-item,\n.controls paper-icon-button,\n.stepper paper-icon-button {\n  border-radius: 18px !important;\n  background-color: var(--primary-background-color);\n  border: 1px solid var(--divider-color, #ccc);\n}\n.mode-item.active {\n  background-color: var(--accent-color);\n  color: white;\n}\n"
              },
              "header": {
                "name": "Salon",
                "icon": "mdi:sofa"
              },
              "entity": "climate.daikin_split_salon_room_temperature",
              "hide": {
                "temperature": true,
                "state": true
              },
              "layout": {
                "mode": {
                  "headings": false
                }
              },
              "step_size": 0.5,
              "decimals": 1,
              "sensors": [
                {
                  "entity": "sensor.thermo_salon_temperature",
                  "name": "Temp.",
                  "icon": "mdi:thermometer"
                },
                {
                  "entity": "sensor.thermo_salon_humidity",
                  "name": "Hum.",
                  "icon": "mdi:water-percent"
                }
              ],
              "control": {
                "fan": {
                  "quiet": {
                    "name": "Silence"
                  }
                },
                "hvac": {
                  "off": {
                    "icon": "mdi:power",
                    "name": ""
                  },
                  "heat": {
                    "icon": "mdi:fire",
                    "name": ""
                  },
                  "cool": {
                    "icon": "mdi:snowflake",
                    "name": ""
                  },
                  "heat_cool": false,
                  "dry": false,
                  "fan_only": false
                }
              }
            },
            {
              "type": "entities",
              "entities": [
                {
                  "entity": "sensor.system_sanguinet_alimentation_de_la_batterie_sb",
                  "name": "Alimentation de la batterie SB"
                },
                {
                  "entity": "sensor.system_sanguinet_alimentation_domestique_sb",
                  "name": "Alimentation domestique SB"
                },
                {
                  "entity": "sensor.system_sanguinet_demande_domestique",
                  "name": "Demande domestique"
                },
                {
                  "entity": "sensor.system_sanguinet_economies_eur",
                  "name": "Economies ‚Ç¨"
                },
                {
                  "entity": "sensor.system_sanguinet_economies_de_co2",
                  "name": "Economies de CO‚ÇÇ"
                },
                {
                  "entity": "sensor.system_sanguinet_energie_solaire_sb",
                  "name": "Energie solaire SB"
                },
                {
                  "entity": "sensor.system_sanguinet_etat_de_charge_du_sb",
                  "name": "Etat de charge du SB"
                },
                {
                  "entity": "sensor.system_sanguinet_mode_d_utilisation_actif",
                  "name": "Mode d'utilisation actif"
                },
                {
                  "entity": "sensor.system_sanguinet_prix_spot_dynamique",
                  "name": "Prix spot dynamique"
                },
                {
                  "entity": "sensor.system_sanguinet_prix_total_dynamique",
                  "name": "Prix total dynamique"
                },
                {
                  "entity": "sensor.system_sanguinet_profit_de_l_ia",
                  "name": "Profit de l'IA"
                },
                {
                  "entity": "sensor.system_sanguinet_reglage_puissance_de_sortie_du_systeme",
                  "name": "R√©glage puissance de sortie du syst√®me"
                },
                {
                  "entity": "sensor.system_sanguinet_rendement_total",
                  "name": "Rendement total"
                },
                {
                  "entity": "sensor.system_sanguinet_temps_de_donnees_sb",
                  "name": "Temps de donn√©es SB"
                }
              ],
              "title": "SolarSystem"
            },
            {
              "type": "entities",
              "entities": [
                {
                  "entity": "sensor.solarbank_3_e2700_pro_ac_puissance_de_la_prise",
                  "name": "AC puissance de la prise"
                },
                {
                  "entity": "sensor.solarbank_3_e2700_pro_charge_du_reseau",
                  "name": "Charge du r√©seau"
                },
                "sensor.solarbank_3_e2700_pro_ac_puissance_domestique",
                {
                  "entity": "sensor.solarbank_3_e2700_pro_energie_de_la_batterie",
                  "name": "Energie de la batterie"
                },
                {
                  "entity": "sensor.solarbank_3_e2700_pro_etat_de_charge",
                  "name": "Etat de charge"
                },
                {
                  "entity": "sensor.solarbank_3_e2700_pro_mode",
                  "name": "Mode"
                },
                {
                  "entity": "sensor.solarbank_3_e2700_pro_puissance_de_charge",
                  "name": "Puissance de charge"
                },
                {
                  "entity": "sensor.solarbank_3_e2700_pro_puissance_de_chauffage",
                  "name": "Puissance de chauffage"
                },
                {
                  "entity": "sensor.solarbank_3_e2700_pro_puissance_de_sortie",
                  "name": "Puissance de sortie"
                },
                {
                  "entity": "sensor.solarbank_3_e2700_pro_puissance_solaire",
                  "name": "Puissance solaire"
                },
                {
                  "entity": "sensor.solarbank_3_e2700_pro_reglage_puissance_de_sortie",
                  "name": "R√©glage puissance de sortie"
                },
                {
                  "entity": "sensor.solarbank_3_e2700_pro_solaire_pv1",
                  "name": "Solaire PV1"
                },
                {
                  "entity": "sensor.solarbank_3_e2700_pro_solaire_pv2",
                  "name": "Solaire PV2"
                },
                {
                  "entity": "sensor.solarbank_3_e2700_pro_solaire_pv3",
                  "name": "Solaire PV3"
                },
                {
                  "entity": "sensor.solarbank_3_e2700_pro_solaire_pv4",
                  "name": "Solaire PV4"
                }
              ],
              "title": "sb3"
            },
            {
              "type": "entities",
              "entities": [
                {
                  "entity": "sensor.smart_meter_grid_export",
                  "name": "Grid export"
                },
                {
                  "entity": "sensor.smart_meter_grid_import",
                  "name": "Grid import"
                }
              ],
              "title": "SmartMeter"
            },
            {
              "type": "custom:vertical-stack-in-card",
              "card_mod": {
                "style": "ha-card {\n  font-size: 14px;\n  --ha-card-border-radius: 12px;\n  padding: 8px;\n}\n.grid {\n  display: grid;\n  grid-gap: 8px;\n}\n"
              },
              "cards": [
                {
                  "type": "grid",
                  "columns": 4,
                  "square": false,
                  "class": "grid",
                  "cards": [
                    {
                      "type": "button",
                      "entity": "switch.chargeur_isa",
                      "name": "Chargeur Isa",
                      "icon": "mdi:battery-charging",
                      "tap_action": {
                        "action": "toggle"
                      },
                      "show_name": true,
                      "show_icon": true,
                      "icon_height": "30px"
                    },
                    {
                      "type": "button",
                      "entity": "switch.chargeur_laurent",
                      "name": "Chargeur Laurent",
                      "icon": "mdi:battery-charging",
                      "tap_action": {
                        "action": "toggle"
                      },
                      "show_name": true,
                      "show_icon": false,
                      "icon_height": "30px"
                    },
                    {
                      "type": "gauge",
                      "entity": "sensor.iphone_isa_battery_level",
                      "name": "iPhone Isa",
                      "min": 0,
                      "max": 100,
                      "severity": {
                        "green": 50,
                        "yellow": 20,
                        "red": 0
                      }
                    },
                    {
                      "type": "gauge",
                      "entity": "sensor.ipad_de_isabelle_battery_level",
                      "name": "iPad Air",
                      "min": 0,
                      "max": 100,
                      "severity": {
                        "green": 50,
                        "yellow": 20,
                        "red": 0
                      }
                    },
                    {
                      "type": "button",
                      "entity": "switch.ordi_moniteur",
                      "name": "Hi-fi & √©cran",
                      "icon": "mdi:monitor-speaker",
                      "tap_action": {
                        "action": "toggle"
                      },
                      "show_name": true,
                      "show_icon": true,
                      "icon_height": "30px",
                      "color": "light-green"
                    },
                    {
                      "type": "button",
                      "entity": "switch.0x08ddebfffed9ed45",
                      "name": "Atelier",
                      "icon": "mdi:lightbulb",
                      "tap_action": {
                        "action": "toggle"
                      },
                      "show_name": true,
                      "show_icon": true,
                      "icon_height": "30px",
                      "color": "light-green"
                    },
                    {
                      "type": "button",
                      "entity": "switch.shellypro1_ece334ee1b64",
                      "name": "Cumulus",
                      "icon": "mdi:water-boiler",
                      "tap_action": {
                        "action": "toggle"
                      },
                      "show_name": true,
                      "show_icon": true,
                      "icon_height": "30px"
                    }
                  ]
                }
              ]
            },
            {
              "type": "horizontal-stack",
              "cards": [
                {
                  "type": "custom:button-card",
                  "aspect_ratio": "1/1",
                  "show_icon": false,
                  "show_state": false,
                  "show_name": false,
                  "tap_action": {
                    "action": "more-info"
                  },
                  "variables": {
                    "person": "person.isabelle",
                    "battery": "sensor.iphone_isa_battery_level",
                    "charging": "sensor.iphone_isa_battery_state",
                    "wifi": "sensor.iphone_isa_connection_type",
                    "distance": "proximity.home_isa",
                    "avatar_min": 50,
                    "avatar_max": 132,
                    "avatar_pct": 0.33,
                    "ring_home": "#22c55e",
                    "ring_away": "#ef4444",
                    "ring_unknown": "#94a3b8"
                  },
                  "triggers_update": [
                    "[[[ return variables.person ]]]",
                    "[[[ return variables.battery ]]]",
                    "[[[ return variables.charging ]]]",
                    "[[[ return variables.wifi ]]]",
                    "[[[ return variables.distance ]]]"
                  ],
                  "styles": {
                    "card": [
                      {
                        "border-radius": "14px"
                      },
                      {
                        "box-shadow": "0 4px 14px rgba(0,0,0,.10)"
                      },
                      {
                        "background": "linear-gradient(135deg, rgba(6,182,212,.16), rgba(6,182,212,.06))\n"
                      },
                      {
                        "padding": "10px 12px 10px 4px"
                      }
                    ],
                    "grid": [
                      {
                        "grid-template-areas": "\"status status\" \"avatar avatar\" \"batt   batt\" \"wifi   dist\""
                      },
                      {
                        "grid-template-columns": "1fr 1fr"
                      },
                      {
                        "grid-template-rows": "auto 1fr auto auto"
                      },
                      {
                        "row-gap": "6px"
                      }
                    ],
                    "custom_fields": {
                      "status": [
                        {
                          "justify-self": "end"
                        },
                        {
                          "align-self": "start"
                        }
                      ],
                      "avatar": [
                        {
                          "justify-self": "start"
                        },
                        {
                          "align-self": "start"
                        },
                        {
                          "margin-top": "-6px"
                        },
                        {
                          "margin-left": "-2px"
                        }
                      ],
                      "batt": [
                        {
                          "justify-self": "start"
                        },
                        {
                          "align-self": "end"
                        }
                      ],
                      "wifi": [
                        {
                          "justify-self": "start"
                        },
                        {
                          "align-self": "start"
                        }
                      ],
                      "dist": [
                        {
                          "justify-self": "end"
                        },
                        {
                          "align-self": "end"
                        },
                        {
                          "margin-bottom": "2px"
                        }
                      ]
                    }
                  },
                  "custom_fields": {
                    "status": "[[[\n  const ha = this.shadowRoot.querySelector('ha-card');\n  const w  = Math.max(180, ha?.getBoundingClientRect?.().width || this?.offsetWidth || 300);\n  const fs = Math.round(Math.min(16, Math.max(12, w * 0.04)));\n  const st  = states[variables.person]?.state ?? 'unknown';\n  const txt = st === 'home' ? 'Maison' : (st === 'not_home' ? 'Absent' : st);\n  const ic  = st === 'home' ? 'mdi:home'\n             : (st === 'not_home' ? 'mdi:map-marker-off' : 'mdi:map-marker-radius');\n  return `<div style=\"display:flex;gap:6px;align-items:center;\n                      color:var(--secondary-text-color);font-size:${fs}px;white-space:nowrap\">\n            <ha-icon icon=\"${ic}\" style=\"--mdc-icon-size:${fs}px\"></ha-icon>\n            <span>${txt}</span>\n          </div>`;\n]]]\n",
                    "avatar": "[[[\n  const min = Number(variables.avatar_min)||72;\n  const max = Number(variables.avatar_max)||132;\n  const pct = Number(variables.avatar_pct)||0.34;\n  const ha  = this.shadowRoot.querySelector('ha-card');\n  const w   = Math.max(1, ha?.getBoundingClientRect?.().width || this?.offsetWidth || 300);\n  const size  = Math.round(Math.min(max, Math.max(min, w * pct)));\n  const ringW = Math.max(4, Math.round(size * 0.06));\n  const st   = states[variables.person]?.state ?? 'unknown';\n  const ring = st === 'home' ? variables.ring_home\n             : (st === 'not_home' ? variables.ring_away : variables.ring_unknown);\n  let pic = states[variables.person]?.attributes?.entity_picture || '';\n  if (pic.includes('/128x128')) pic = pic.replace('/128x128','/512x512');\n  const bust = pic ? ((pic.includes('?')?'&':'?')+'v='+(Date.now()%1e7)) : '';\n  const base = `width:${size}px;height:${size}px;border-radius:50%;\n                border:${ringW}px solid ${ring};\n                box-shadow: inset 0 0 0 3px rgba(255,255,255,.85), 0 3px 8px rgba(0,0,0,.12);`;\n  return pic\n    ? `<div style=\"${base} background:url('${pic}${bust}') center/cover no-repeat;\"></div>`\n    : `<div style=\"${base} display:flex;align-items:center;justify-content:center;background:rgba(255,255,255,.92);\">\n         <ha-icon icon=\"mdi:account\" style=\"--mdc-icon-size:${Math.round(size*0.6)}px;color:rgba(0,0,0,.55)\"></ha-icon>\n       </div>`;\n]]]\n",
                    "batt": "[[[\n  const ha = this.shadowRoot.querySelector('ha-card');\n  const w  = Math.max(180, ha?.getBoundingClientRect?.().width || this?.offsetWidth || 300);\n  const fs = Math.round(Math.min(20, Math.max(12, w * 0.055)));\n  const lvl = Number(states[variables.battery]?.state);\n  const st  = (states[variables.charging]?.state || '').toLowerCase();\n  const charging = ['charging','en charge','ac power','plugged','full'].some(x=>st.includes(x));\n  const step = isNaN(lvl) ? 0 : Math.min(100, Math.max(0, Math.round(lvl/10)*10));\n  const ic   = charging ? `mdi:battery-charging-${step || 10}`\n                        : (step===100 ? 'mdi:battery' : `mdi:battery-${step || 10}`);\n  const txt  = isNaN(lvl) ? '‚Äî' : `${lvl}%`;\n  return `<div style=\"display:flex;gap:6px;align-items:center;font-weight:700;\n                      font-size:${fs}px;white-space:nowrap\">\n            <ha-icon icon=\"${ic}\" style=\"--mdc-icon-size:${Math.max(18, fs)}px\"></ha-icon>\n            <span>${txt} Batterie</span>\n          </div>`;\n]]]\n",
                    "wifi": "[[[\n  const ha = this.shadowRoot.querySelector('ha-card');\n  const w  = Math.max(180, ha?.getBoundingClientRect?.().width || this?.offsetWidth || 300);\n  const fs = Math.round(Math.min(18, Math.max(12, w * 0.048)));\n  const t = (states[variables.wifi]?.state || '').toLowerCase();\n  const isWifi = t.includes('wifi') || t.includes('wi-fi');\n  const label  = isWifi ? 'Wi-Fi' : (t ? 'Cellulaire' : 'Cellulaire');\n  const ic     = isWifi ? 'mdi:wifi' : 'mdi:signal-cellular-3';\n  return `<div style=\"display:flex;gap:6px;align-items:center;opacity:.9;\n                      font-size:${fs}px;white-space:nowrap\">\n            <ha-icon icon=\"${ic}\" style=\"--mdc-icon-size:${Math.max(18, fs)}px\"></ha-icon>\n            <span>${label}</span>\n          </div>`;\n]]]\n",
                    "dist": "[[[\n  const ha = this.shadowRoot.querySelector('ha-card');\n  const w  = Math.max(180, ha?.getBoundingClientRect?.().width || this?.offsetWidth || 300);\n  const fs = Math.round(Math.min(20, Math.max(12, w * 0.055)));  // m√™me taille que batterie\n  let km = Number(states[variables.distance]?.state);\n  if (isNaN(km)) km = 0;\n  km = Math.round(km*10)/10;\n  if (Math.abs(km) < 0.05) km = 0;\n  return `<div style=\"display:flex;gap:6px;align-items:center;font-weight:800;\n                      font-size:${fs}px;white-space:nowrap\">\n            <ha-icon icon=\"mdi:map-marker-distance\" style=\"--mdc-icon-size:${Math.max(18, fs)}px\"></ha-icon>\n            <span style=\"font-variant-numeric:tabular-nums\">${km} km</span>\n          </div>`;\n]]]\n"
                  }
                },
                {
                  "type": "custom:button-card",
                  "aspect_ratio": "1/1",
                  "show_icon": false,
                  "show_state": false,
                  "show_name": false,
                  "tap_action": {
                    "action": "more-info"
                  },
                  "variables": {
                    "person": "person.laurent",
                    "battery": "sensor.iphone_laurent_battery_level",
                    "charging": "sensor.iphone_laurent_battery_state",
                    "wifi": "sensor.iphone_laurent_connection_type",
                    "distance": "proximity.home_laurent",
                    "ipad_battery": "sensor.ipad_laurent_battery_level",
                    "ipad_charging": "sensor.ipad_laurent_battery_state",
                    "avatar_min": 50,
                    "avatar_max": 133,
                    "avatar_pct": 0.33,
                    "ring_home": "#22c55e",
                    "ring_away": "#ef4444",
                    "ring_unknown": "#94a3b8"
                  },
                  "triggers_update": [
                    "[[[ return variables.person ]]]",
                    "[[[ return variables.battery ]]]",
                    "[[[ return variables.charging ]]]",
                    "[[[ return variables.ipad_battery ]]]",
                    "[[[ return variables.ipad_charging ]]]",
                    "[[[ return variables.wifi ]]]",
                    "[[[ return variables.distance ]]]"
                  ],
                  "styles": {
                    "card": [
                      {
                        "border-radius": "14px"
                      },
                      {
                        "box-shadow": "0 4px 14px rgba(0,0,0,.10)"
                      },
                      {
                        "background": "linear-gradient(135deg, rgba(6,182,212,.16), rgba(6,182,212,.06))\n"
                      },
                      {
                        "padding": "10px 12px 10px 4px"
                      }
                    ],
                    "grid": [
                      {
                        "grid-template-areas": "\"status status\" \"avatar avatar\" \"batt   batt\" \"ipad   ipad\" \"wifi   dist\""
                      },
                      {
                        "grid-template-columns": "1fr 1fr"
                      },
                      {
                        "grid-template-rows": "auto 1fr auto auto auto"
                      },
                      {
                        "row-gap": "6px"
                      }
                    ],
                    "custom_fields": {
                      "status": [
                        {
                          "justify-self": "end"
                        },
                        {
                          "align-self": "start"
                        }
                      ],
                      "avatar": [
                        {
                          "justify-self": "start"
                        },
                        {
                          "align-self": "start"
                        },
                        {
                          "margin-top": "-6px"
                        },
                        {
                          "margin-left": "-2px"
                        }
                      ],
                      "batt": [
                        {
                          "justify-self": "start"
                        },
                        {
                          "align-self": "end"
                        }
                      ],
                      "ipad": [
                        {
                          "justify-self": "start"
                        },
                        {
                          "align-self": "start"
                        }
                      ],
                      "wifi": [
                        {
                          "justify-self": "start"
                        },
                        {
                          "align-self": "start"
                        }
                      ],
                      "dist": [
                        {
                          "justify-self": "end"
                        },
                        {
                          "align-self": "end"
                        },
                        {
                          "margin-bottom": "2px"
                        }
                      ]
                    }
                  },
                  "custom_fields": {
                    "status": "[[[\n  const ha = this.shadowRoot.querySelector('ha-card');\n  const w  = Math.max(180, ha?.getBoundingClientRect?.().width || this?.offsetWidth || 300);\n  const fs = Math.round(Math.min(16, Math.max(12, w * 0.04)));\n  const st  = states[variables.person]?.state ?? 'unknown';\n  const txt = st === 'home' ? 'Maison' : (st === 'not_home' ? 'Absent' : st);\n  const ic  = st === 'home' ? 'mdi:home'\n             : (st === 'not_home' ? 'mdi:map-marker-off' : 'mdi:map-marker-radius');\n  return `<div style=\"display:flex;gap:6px;align-items:center;\n                      color:var(--secondary-text-color);font-size:${fs}px;white-space:nowrap\">\n            <ha-icon icon=\"${ic}\" style=\"--mdc-icon-size:${fs}px\"></ha-icon>\n            <span>${txt}</span>\n          </div>`;\n]]]\n",
                    "avatar": "[[[\n  const min = Number(variables.avatar_min)||72;\n  const max = Number(variables.avatar_max)||132;\n  const pct = Number(variables.avatar_pct)||0.34;\n  const ha  = this.shadowRoot.querySelector('ha-card');\n  const w   = Math.max(1, ha?.getBoundingClientRect?.().width || this?.offsetWidth || 300);\n  const size  = Math.round(Math.min(max, Math.max(min, w * pct)));\n  const ringW = Math.max(4, Math.round(size * 0.06));\n  const st   = states[variables.person]?.state ?? 'unknown';\n  const ring = st === 'home' ? variables.ring_home\n             : (st === 'not_home' ? variables.ring_away : variables.ring_unknown);\n  let pic = states[variables.person]?.attributes?.entity_picture || '';\n  if (pic.includes('/128x128')) pic = pic.replace('/128x128','/512x512');\n  const bust = pic ? ((pic.includes('?')?'&':'?')+'v='+(Date.now()%1e7)) : '';\n  const base = `width:${size}px;height:${size}px;border-radius:50%;\n                border:${ringW}px solid ${ring};\n                box-shadow: inset 0 0 0 3px rgba(255,255,255,.85), 0 3px 8px rgba(0,0,0,.12);`;\n  return pic\n    ? `<div style=\"${base} background:url('${pic}${bust}') center/cover no-repeat;\"></div>`\n    : `<div style=\"${base} display:flex;align-items:center;justify-content:center;background:rgba(255,255,255,.92);\">\n         <ha-icon icon=\"mdi:account\" style=\"--mdc-icon-size:${Math.round(size*0.6)}px;color:rgba(0,0,0,.55)\"></ha-icon>\n       </div>`;\n]]]\n",
                    "batt": "[[[\n  const ha = this.shadowRoot.querySelector('ha-card');\n  const w  = Math.max(180, ha?.getBoundingClientRect?.().width || this?.offsetWidth || 300);\n  const fs = Math.round(Math.min(20, Math.max(12, w * 0.055)));\n  const lvl = Number(states[variables.battery]?.state);\n  const s   = (states[variables.charging]?.state || '').toLowerCase();\n  const charging = /(charging|ac power|plugged|full)/.test(s) && !/not/.test(s);\n  const step = isNaN(lvl) ? 0 : Math.min(100, Math.max(0, Math.round(lvl/10)*10));\n  const ic   = charging ? `mdi:battery-charging-${step || 10}`\n                        : (step===100 ? 'mdi:battery' : `mdi:battery-${step || 10}`);\n  const txt  = isNaN(lvl) ? '‚Äî' : `${lvl}%`;\n  return `<div style=\"display:flex;gap:6px;align-items:center;font-weight:700;\n                      font-size:${fs}px;white-space:nowrap\">\n            <ha-icon icon=\"${ic}\" style=\"--mdc-icon-size:${Math.max(18, fs)}px\"></ha-icon>\n            <span>${txt} Batterie</span>\n          </div>`;\n]]]\n",
                    "ipad": "[[[\n  const ha = this.shadowRoot.querySelector('ha-card');\n  const w  = Math.max(180, ha?.getBoundingClientRect?.().width || this?.offsetWidth || 300);\n  const fs = Math.round(Math.min(18, Math.max(12, w * 0.05)));\n  const lvl = Number(states[variables.ipad_battery]?.state);\n  const s   = (states[variables.ipad_charging]?.state || '').toLowerCase();\n  const charging = /(charging|ac power|plugged|full)/.test(s) && !/not/.test(s);\n  const step = isNaN(lvl) ? 0 : Math.min(100, Math.max(0, Math.round(lvl/10)*10));\n  const ic   = charging ? `mdi:battery-charging-${step || 10}`\n                        : (step===100 ? 'mdi:battery' : `mdi:battery-${step || 10}`);\n  const txt  = isNaN(lvl) ? '‚Äî' : `${lvl}%`;\n  return `<div style=\"display:flex;gap:6px;align-items:center;font-weight:600;\n                      font-size:${fs}px;white-space:nowrap;opacity:.95\">\n            <ha-icon icon=\"mdi:tablet\" style=\"--mdc-icon-size:${Math.max(18, fs)}px\"></ha-icon>\n            <ha-icon icon=\"${ic}\" style=\"--mdc-icon-size:${Math.max(18, fs)}px\"></ha-icon>\n            <span>iPad ${txt}</span>\n          </div>`;\n]]]\n",
                    "wifi": "[[[\n  const ha = this.shadowRoot.querySelector('ha-card');\n  const w  = Math.max(180, ha?.getBoundingClientRect?.().width || this?.offsetWidth || 300);\n  const fs = Math.round(Math.min(18, Math.max(12, w * 0.048)));\n  const t = (states[variables.wifi]?.state || '').toLowerCase();\n  const isWifi = t.includes('wifi') || t.includes('wi-fi');\n  const label  = isWifi ? 'Wi-Fi' : (t ? 'Cellulaire' : 'Cellulaire');\n  const ic     = isWifi ? 'mdi:wifi' : 'mdi:signal-cellular-3';\n  return `<div style=\"display:flex;gap:6px;align-items:center;opacity:.9;\n                      font-size:${fs}px;white-space:nowrap\">\n            <ha-icon icon=\"${ic}\" style=\"--mdc-icon-size:${Math.max(18, fs)}px\"></ha-icon>\n            <span>${label}</span>\n          </div>`;\n]]]\n",
                    "dist": "[[[\n  const ha = this.shadowRoot.querySelector('ha-card');\n  const w  = Math.max(180, ha?.getBoundingClientRect?.().width || this?.offsetWidth || 300);\n  const fs = Math.round(Math.min(20, Math.max(12, w * 0.055)));\n  let km = Number(states[variables.distance]?.state);\n  if (isNaN(km)) km = 0;\n  km = Math.round(km*10)/10;\n  if (Math.abs(km) < 0.05) km = 0;\n  return `<div style=\"display:flex;gap:6px;align-items:center;font-weight:800;\n                      font-size:${fs}px;white-space:nowrap\">\n            <ha-icon icon=\"mdi:map-marker-distance\" style=\"--mdc-icon-size:${Math.max(18, fs)}px\"></ha-icon>\n            <span style=\"font-variant-numeric:tabular-nums\">${km} km</span>\n          </div>`;\n]]]\n"
                  }
                }
              ]
            },
            {
              "type": "custom:vertical-stack-in-card",
              "cards": [
                {
                  "type": "grid",
                  "columns": 3,
                  "square": false,
                  "cards": [
                    {
                      "type": "custom:button-card",
                      "entity": "climate.thermostat_sdb",
                      "show_name": false,
                      "show_state": false,
                      "icon": "mdi:minus",
                      "tap_action": {
                        "action": "call-service",
                        "service": "climate.set_temperature",
                        "data": {
                          "entity_id": "climate.thermostat_sdb",
                          "temperature": "[[[\n  const t = Number(entity.attributes?.temperature ?? 19);\n  const step = Number(entity.attributes?.target_temp_step ?? 0.5);\n  const tMin = Number(entity.attributes?.min_temp ?? 7);\n  const v = Math.max(tMin, t - step);\n  return Number(v.toFixed(1));\n]]]\n"
                        }
                      },
                      "hold_action": {
                        "action": "call-service",
                        "service": "climate.set_temperature",
                        "data": {
                          "entity_id": "climate.thermostat_sdb",
                          "temperature": "[[[\n  const t = Number(entity.attributes?.temperature ?? 19);\n  const v = Math.max(Number(entity.attributes?.min_temp ?? 7), t - 1);\n  return Number(v.toFixed(1));\n]]]\n"
                        }
                      },
                      "styles": {
                        "card": [
                          {
                            "min-height": "68px"
                          },
                          {
                            "border-radius": "16px"
                          },
                          {
                            "box-shadow": "0 8px 24px rgba(0,0,0,.08), inset 0 1px 0 rgba(255,255,255,.35)"
                          },
                          {
                            "background": "linear-gradient(145deg,#f2f5fb,#e9edf7)"
                          }
                        ],
                        "icon": [
                          {
                            "width": "22px"
                          }
                        ]
                      }
                    },
                    {
                      "type": "custom:button-card",
                      "entity": "climate.thermostat_sdb",
                      "name": "SDB",
                      "show_icon": false,
                      "show_state": false,
                      "show_name": true,
                      "tap_action": {
                        "action": "more-info"
                      },
                      "triggers_update": [
                        "climate.thermostat_sdb"
                      ],
                      "styles": {
                        "card": [
                          {
                            "padding": "8px 10px 10px"
                          },
                          {
                            "border-radius": "16px"
                          },
                          {
                            "background": "linear-gradient(135deg,#eef2ff,#f0fbff)"
                          },
                          {
                            "box-shadow": "0 8px 24px rgba(0,0,0,.08), inset 0 1px 0 rgba(255,255,255,.35)"
                          },
                          {
                            "min-height": "68px"
                          }
                        ],
                        "name": [
                          {
                            "font-size": ".9rem"
                          },
                          {
                            "font-weight": 700
                          },
                          {
                            "margin": "2px 0 6px 2px"
                          }
                        ],
                        "custom_fields": {
                          "bar": [
                            {
                              "margin": "0 2px"
                            }
                          ]
                        }
                      },
                      "custom_fields": {
                        "bar": "[[[\n  const e = entity || {};\n  const t = Number(e.attributes?.temperature ?? 19);\n  const a = Number(e.attributes?.current_temperature ?? t);\n  const tMin = Number(e.attributes?.min_temp ?? 7);\n  const tMax = Number(e.attributes?.max_temp ?? 30);\n  const pct = (v)=>Math.min(100,Math.max(0,((v-tMin)/(tMax-tMin))*100));\n  const pT = pct(t), pA = pct(a);\n  const fmt = v => (Math.round(v*10)/10).toLocaleString('fr-FR',{minimumFractionDigits:1,maximumFractionDigits:1});\n  return `\n    <div style=\"display:flex;flex-direction:column;gap:8px;\">\n      <div style=\"display:flex;align-items:baseline;justify-content:center;gap:10px;\">\n        <div style=\"font-size:32px;font-weight:800;letter-spacing:.2px\">${fmt(t)}<span style=\"font-size:14px\">¬∞C</span></div>\n        <div style=\"font-size:14px;opacity:.8\">‚Ä¢ ${fmt(a)} ¬∞C</div>\n      </div>\n      <div style=\"position:relative;height:16px;border-radius:9999px;background:#e6eaf3;box-shadow: inset 0 2px 4px rgba(0,0,0,.06); overflow:hidden;\">\n        <div style=\"height:100%;width:${pT}%;border-radius:9999px;background:\n          linear-gradient(90deg,#60a5fa,#a78bfa,#34d399);transition:width .25s ease\"></div>\n        <div style=\"position:absolute;top:50%;left:calc(${pA}% - 9px);width:18px;height:18px;border-radius:50%;\n          background:white;box-shadow:0 2px 6px rgba(0,0,0,.2), inset 0 0 0 2px rgba(96,165,250,.6);transform:translateY(-50%);\"></div>\n      </div>\n    </div>`;\n]]]\n"
                      }
                    },
                    {
                      "type": "custom:button-card",
                      "entity": "climate.thermostat_sdb",
                      "show_name": false,
                      "show_state": false,
                      "icon": "mdi:plus",
                      "tap_action": {
                        "action": "call-service",
                        "service": "climate.set_temperature",
                        "data": {
                          "entity_id": "climate.thermostat_sdb",
                          "temperature": "[[[\n  const t = Number(entity.attributes?.temperature ?? 19);\n  const step = Number(entity.attributes?.target_temp_step ?? 0.5);\n  const tMax = Number(entity.attributes?.max_temp ?? 30);\n  const v = Math.min(tMax, t + step);\n  return Number(v.toFixed(1));\n]]]\n"
                        }
                      },
                      "hold_action": {
                        "action": "call-service",
                        "service": "climate.set_temperature",
                        "data": {
                          "entity_id": "climate.thermostat_sdb",
                          "temperature": "[[[\n  const t = Number(entity.attributes?.temperature ?? 19);\n  const v = Math.min(Number(entity.attributes?.max_temp ?? 30), t + 1);\n  return Number(v.toFixed(1));\n]]]\n"
                        }
                      },
                      "styles": {
                        "card": [
                          {
                            "min-height": "68px"
                          },
                          {
                            "border-radius": "16px"
                          },
                          {
                            "box-shadow": "0 8px 24px rgba(0,0,0,.08), inset 0 1px 0 rgba(255,255,255,.35)"
                          },
                          {
                            "background": "linear-gradient(145deg,#f2f5fb,#e9edf7)"
                          }
                        ],
                        "icon": [
                          {
                            "width": "22px"
                          }
                        ]
                      }
                    }
                  ]
                },
                {
                  "type": "grid",
                  "columns": 3,
                  "square": false,
                  "cards": [
                    {
                      "type": "custom:button-card",
                      "entity": "climate.thermostat_sdb",
                      "name": "Chauffe",
                      "icon": "mdi:fire",
                      "tap_action": {
                        "action": "call-service",
                        "service": "climate.set_hvac_mode",
                        "data": {
                          "entity_id": "climate.thermostat_sdb",
                          "hvac_mode": "heat"
                        }
                      },
                      "styles": {
                        "card": [
                          {
                            "padding": "8px"
                          },
                          {
                            "min-height": "56px"
                          },
                          {
                            "border-radius": "14px"
                          },
                          {
                            "background": "[[[\n  return entity.state==='heat'\n    ? 'linear-gradient(135deg,#fde68a,#fca5a5)'\n    : 'linear-gradient(135deg,#eef2f7,#e9edf6)';\n]]]\n"
                          },
                          {
                            "box-shadow": "0 6px 16px rgba(0,0,0,.08)"
                          }
                        ],
                        "icon": [
                          {
                            "width": "20px"
                          }
                        ],
                        "name": [
                          {
                            "font-size": ".85rem"
                          },
                          {
                            "margin-top": "2px"
                          }
                        ]
                      }
                    },
                    {
                      "type": "custom:button-card",
                      "entity": "climate.thermostat_sdb",
                      "name": "Arr√™t",
                      "icon": "mdi:power",
                      "tap_action": {
                        "action": "call-service",
                        "service": "climate.set_hvac_mode",
                        "data": {
                          "entity_id": "climate.thermostat_sdb",
                          "hvac_mode": "off"
                        }
                      },
                      "styles": {
                        "card": [
                          {
                            "padding": "8px"
                          },
                          {
                            "min-height": "56px"
                          },
                          {
                            "border-radius": "14px"
                          },
                          {
                            "background": "[[[\n  return entity.state==='off'\n    ? 'linear-gradient(135deg,#fbcfe8,#fecaca)'\n    : 'linear-gradient(135deg,#eef2f7,#e9edf6)';\n]]]\n"
                          },
                          {
                            "box-shadow": "0 6px 16px rgba(0,0,0,.08)"
                          }
                        ],
                        "icon": [
                          {
                            "width": "18px"
                          }
                        ],
                        "name": [
                          {
                            "font-size": ".85rem"
                          },
                          {
                            "margin-top": "2px"
                          }
                        ]
                      }
                    },
                    {
                      "type": "custom:button-card",
                      "entity": "climate.thermostat_sdb",
                      "name": "Boost",
                      "icon": "mdi:rocket-launch",
                      "tap_action": {
                        "action": "call-service",
                        "service": "climate.set_preset_mode",
                        "data": {
                          "entity_id": "climate.thermostat_sdb",
                          "preset_mode": "boost"
                        }
                      },
                      "styles": {
                        "card": [
                          {
                            "padding": "8px"
                          },
                          {
                            "min-height": "56px"
                          },
                          {
                            "border-radius": "14px"
                          },
                          {
                            "background": "linear-gradient(135deg,#e0f2fe,#e9d5ff)"
                          },
                          {
                            "box-shadow": "0 6px 16px rgba(0,0,0,.08)"
                          },
                          {
                            "display": "[[[\n  const P = entity.attributes?.preset_modes || [];\n  return P.includes('boost') ? 'block' : 'none';\n]]]\n"
                          }
                        ],
                        "icon": [
                          {
                            "width": "20px"
                          }
                        ],
                        "name": [
                          {
                            "font-size": ".85rem"
                          },
                          {
                            "margin-top": "2px"
                          }
                        ]
                      }
                    }
                  ]
                }
              ]
            },
            {
              "type": "custom:vertical-stack-in-card",
              "cards": [
                {
                  "type": "grid",
                  "columns": 3,
                  "square": false,
                  "cards": [
                    {
                      "type": "custom:button-card",
                      "entity": "climate.thermostat_sdb",
                      "show_name": false,
                      "show_icon": false,
                      "show_state": false,
                      "styles": {
                        "card": [
                          {
                            "min-height": "140px"
                          },
                          {
                            "padding": "12px 0"
                          },
                          {
                            "border-radius": "18px"
                          },
                          {
                            "background": "#f1f3f8"
                          },
                          {
                            "box-shadow": "8px 8px 18px #dde1ea, -6px -6px 16px #ffffff"
                          }
                        ],
                        "custom_fields": {
                          "thermo": [
                            {
                              "margin": "0 auto"
                            }
                          ]
                        }
                      },
                      "custom_fields": {
                        "thermo": "[[[\n  const e = entity || {};\n  const t = Number(e.attributes?.temperature ?? 19);\n  const a = Number(e.attributes?.current_temperature ?? t);\n  const tMin = Number(e.attributes?.min_temp ?? 7);\n  const tMax = Number(e.attributes?.max_temp ?? 30);\n  const pct = v => Math.min(100, Math.max(0, ((v - tMin) / (tMax - tMin)) * 100));\n  const pT = pct(t), pA = pct(a);\n  return `\n    <div style=\"position:relative;width:34px;height:112px;border-radius:20px;\n      background:#e7eaf1;box-shadow: inset 2px 2px 6px rgba(0,0,0,.08),\n      inset -2px -2px 6px rgba(255,255,255,.8);overflow:hidden\">\n      <div style=\"position:absolute;bottom:0;left:0;width:100%;height:${pT}%;\n        background:linear-gradient(#b4c6ff,#86efac);transition:height .25s\"></div>\n      <div style=\"position:absolute;bottom:calc(${pA}% - 1px);left:-4px;right:-4px;height:2px;\n        background:rgba(0,0,0,.25);border-radius:2px\"></div>\n    </div>`;\n]]]\n"
                      }
                    },
                    {
                      "type": "custom:button-card",
                      "entity": "climate.thermostat_sdb",
                      "name": "SDB",
                      "show_icon": false,
                      "show_state": false,
                      "show_name": true,
                      "tap_action": {
                        "action": "more-info"
                      },
                      "styles": {
                        "card": [
                          {
                            "min-height": "140px"
                          },
                          {
                            "border-radius": "18px"
                          },
                          {
                            "background": "#f1f3f8"
                          },
                          {
                            "box-shadow": "8px 8px 18px #dde1ea, -6px -6px 16px #ffffff"
                          }
                        ],
                        "name": [
                          {
                            "font-size": ".9rem"
                          },
                          {
                            "font-weight": 700
                          },
                          {
                            "margin": "10px 0 6px 8px"
                          }
                        ],
                        "custom_fields": {
                          "value": [
                            {
                              "margin": "0 auto"
                            }
                          ]
                        }
                      },
                      "custom_fields": {
                        "value": "[[[\n  const e = entity || {};\n  const t = Number(e.attributes?.temperature ?? 19);\n  const a = Number(e.attributes?.current_temperature ?? t);\n  const fmt = v => (Math.round(v*10)/10)\n      .toLocaleString('fr-FR',{minimumFractionDigits:1,maximumFractionDigits:1});\n  return `\n    <div style=\"display:flex;flex-direction:column;align-items:center;gap:6px\">\n      <div style=\"font-size:36px;font-weight:800\">${fmt(t)}<span style=\"font-size:14px\">¬∞C</span></div>\n      <div style=\"font-size:14px;opacity:.75\">${fmt(a)} ¬∞C</div>\n    </div>`;\n]]]\n"
                      }
                    },
                    {
                      "type": "vertical-stack",
                      "cards": [
                        {
                          "type": "custom:button-card",
                          "entity": "climate.thermostat_sdb",
                          "icon": "mdi:plus",
                          "show_name": false,
                          "show_state": false,
                          "tap_action": {
                            "action": "call-service",
                            "service": "climate.set_temperature",
                            "data": {
                              "entity_id": "climate.thermostat_sdb",
                              "temperature": "[[[\n  const t = Number(entity.attributes?.temperature ?? 19);\n  const s = Number(entity.attributes?.target_temp_step ?? 0.5);\n  const tMax = Number(entity.attributes?.max_temp ?? 30);\n  return Number(Math.min(tMax, t + s).toFixed(1));\n]]]\n"
                            }
                          },
                          "styles": {
                            "card": [
                              {
                                "min-height": "64px"
                              },
                              {
                                "border-radius": "18px"
                              },
                              {
                                "background": "#f1f3f8"
                              },
                              {
                                "box-shadow": "8px 8px 18px #dde1ea, -6px -6px 16px #ffffff"
                              }
                            ],
                            "icon": [
                              {
                                "width": "22px"
                              }
                            ]
                          }
                        },
                        {
                          "type": "custom:button-card",
                          "entity": "climate.thermostat_sdb",
                          "icon": "mdi:minus",
                          "show_name": false,
                          "show_state": false,
                          "tap_action": {
                            "action": "call-service",
                            "service": "climate.set_temperature",
                            "data": {
                              "entity_id": "climate.thermostat_sdb",
                              "temperature": "[[[\n  const t = Number(entity.attributes?.temperature ?? 19);\n  const s = Number(entity.attributes?.target_temp_step ?? 0.5);\n  const tMin = Number(entity.attributes?.min_temp ?? 7);\n  return Number(Math.max(tMin, t - s).toFixed(1));\n]]]\n"
                            }
                          },
                          "styles": {
                            "card": [
                              {
                                "min-height": "64px"
                              },
                              {
                                "border-radius": "18px"
                              },
                              {
                                "margin-top": "8px"
                              },
                              {
                                "background": "#f1f3f8"
                              },
                              {
                                "box-shadow": "8px 8px 18px #dde1ea, -6px -6px 16px #ffffff"
                              }
                            ],
                            "icon": [
                              {
                                "width": "22px"
                              }
                            ]
                          }
                        }
                      ]
                    }
                  ]
                },
                {
                  "type": "grid",
                  "columns": 3,
                  "square": false,
                  "cards": [
                    {
                      "type": "custom:button-card",
                      "entity": "climate.thermostat_sdb",
                      "name": "Chauffe",
                      "icon": "mdi:fire",
                      "tap_action": {
                        "action": "call-service",
                        "service": "climate.set_hvac_mode",
                        "data": {
                          "entity_id": "climate.thermostat_sdb",
                          "hvac_mode": "heat"
                        }
                      },
                      "styles": {
                        "card": [
                          {
                            "border-radius": "14px"
                          },
                          {
                            "padding": "8px"
                          },
                          {
                            "min-height": "54px"
                          },
                          {
                            "background": "#f1f3f8"
                          },
                          {
                            "box-shadow": "8px 8px 18px #dde1ea, -6px -6px 16px #ffffff"
                          }
                        ],
                        "icon": [
                          {
                            "width": "20px"
                          }
                        ],
                        "name": [
                          {
                            "font-size": ".85rem"
                          },
                          {
                            "margin-top": "2px"
                          },
                          {
                            "font-weight": 600
                          }
                        ]
                      }
                    },
                    {
                      "type": "custom:button-card",
                      "entity": "climate.thermostat_sdb",
                      "name": "Arr√™t",
                      "icon": "mdi:power",
                      "tap_action": {
                        "action": "call-service",
                        "service": "climate.set_hvac_mode",
                        "data": {
                          "entity_id": "climate.thermostat_sdb",
                          "hvac_mode": "off"
                        }
                      },
                      "styles": {
                        "card": [
                          {
                            "border-radius": "14px"
                          },
                          {
                            "padding": "8px"
                          },
                          {
                            "min-height": "54px"
                          },
                          {
                            "background": "#f1f3f8"
                          },
                          {
                            "box-shadow": "8px 8px 18px #dde1ea, -6px -6px 16px #ffffff"
                          }
                        ],
                        "icon": [
                          {
                            "width": "18px"
                          }
                        ],
                        "name": [
                          {
                            "font-size": ".85rem"
                          },
                          {
                            "margin-top": "2px"
                          },
                          {
                            "font-weight": 600
                          }
                        ]
                      }
                    },
                    {
                      "type": "custom:button-card",
                      "entity": "climate.thermostat_sdb",
                      "name": "Boost",
                      "icon": "mdi:rocket-launch",
                      "tap_action": {
                        "action": "call-service",
                        "service": "climate.set_preset_mode",
                        "data": {
                          "entity_id": "climate.thermostat_sdb",
                          "preset_mode": "boost"
                        }
                      },
                      "styles": {
                        "card": [
                          {
                            "border-radius": "14px"
                          },
                          {
                            "padding": "8px"
                          },
                          {
                            "min-height": "54px"
                          },
                          {
                            "background": "#f1f3f8"
                          },
                          {
                            "box-shadow": "8px 8px 18px #dde1ea, -6px -6px 16px #ffffff"
                          },
                          {
                            "display": "[[[\n  const P = entity.attributes?.preset_modes || [];\n  return P.includes('boost') ? 'block' : 'none';\n]]]\n"
                          }
                        ],
                        "icon": [
                          {
                            "width": "20px"
                          }
                        ],
                        "name": [
                          {
                            "font-size": ".85rem"
                          },
                          {
                            "margin-top": "2px"
                          },
                          {
                            "font-weight": 600
                          }
                        ]
                      }
                    }
                  ]
                }
              ]
            },
            {
              "type": "custom:vertical-stack-in-card",
              "cards": [
                {
                  "type": "grid",
                  "columns": 3,
                  "square": false,
                  "cards": [
                    {
                      "type": "custom:button-card",
                      "entity": "climate.thermostat_sdb",
                      "show_name": false,
                      "show_icon": false,
                      "show_state": false,
                      "triggers_update": [
                        "climate.thermostat_sdb"
                      ],
                      "styles": {
                        "card": [
                          {
                            "min-height": "132px"
                          },
                          {
                            "padding": "10px 0"
                          },
                          {
                            "border-radius": "18px"
                          },
                          {
                            "background": "#f1f3f8"
                          },
                          {
                            "box-shadow": "8px 8px 18px #dde1ea, -6px -6px 16px #ffffff"
                          }
                        ],
                        "custom_fields": {
                          "thermo": [
                            {
                              "margin": "0 auto"
                            }
                          ]
                        }
                      },
                      "custom_fields": {
                        "thermo": "[[[\n  const e = entity || {};\n  const t = Number(e.attributes?.temperature ?? 19);\n  const a = Number(e.attributes?.current_temperature ?? t);\n  const tMin = Number(e.attributes?.min_temp ?? 7);\n  const tMax = Number(e.attributes?.max_temp ?? 30);\n  const pct = v => Math.min(100, Math.max(0, ((v - tMin) / (tMax - tMin)) * 100));\n  const pT = pct(t), pA = pct(a);\n  const heating = (e.attributes?.hvac_action === 'heating');\n  const fill = heating\n    ? 'linear-gradient(#fb923c,#facc15)'      /* en chauffe : orange/jaune */\n    : 'linear-gradient(#b4c6ff,#86efac)';     /* idle/arr√™t : bleu/vert    */\n  return `\n    <div style=\"position:relative;width:42px;height:116px;border-radius:22px;\n      background:#e7eaf1;box-shadow: inset 2px 2px 6px rgba(0,0,0,.08),\n      inset -2px -2px 6px rgba(255,255,255,.8);overflow:hidden\">\n      <div style=\"position:absolute;bottom:0;left:0;width:100%;height:${pT}%;\n        background:${fill};transition:height .25s\"></div>\n      <div style=\"position:absolute;bottom:calc(${pA}% - 1px);left:-4px;right:-4px;height:2px;\n        background:rgba(0,0,0,.25);border-radius:2px\"></div>\n    </div>`;\n]]]\n"
                      }
                    },
                    {
                      "type": "custom:button-card",
                      "entity": "climate.thermostat_sdb",
                      "name": "SDB",
                      "show_icon": false,
                      "show_state": false,
                      "show_name": true,
                      "tap_action": {
                        "action": "more-info"
                      },
                      "triggers_update": [
                        "climate.thermostat_sdb"
                      ],
                      "styles": {
                        "card": [
                          {
                            "min-height": "132px"
                          },
                          {
                            "border-radius": "18px"
                          },
                          {
                            "background": "#f1f3f8"
                          },
                          {
                            "box-shadow": "8px 8px 18px #dde1ea, -6px -6px 16px #ffffff"
                          }
                        ],
                        "name": [
                          {
                            "font-size": ".9rem"
                          },
                          {
                            "font-weight": 700
                          },
                          {
                            "margin": "6px 0 2px 0"
                          },
                          {
                            "text-align": "center"
                          }
                        ],
                        "custom_fields": {
                          "value": [
                            {
                              "margin": "0 auto"
                            }
                          ]
                        }
                      },
                      "custom_fields": {
                        "value": "[[[\n  const e = entity || {};\n  const t = Number(e.attributes?.temperature ?? 19);\n  const a = Number(e.attributes?.current_temperature ?? t);\n  const fmt = v => (Math.round(v*10)/10)\n    .toLocaleString('fr-FR',{minimumFractionDigits:1,maximumFractionDigits:1});\n  return `\n    <div style=\"display:flex;flex-direction:column;align-items:center;gap:4px\">\n      <div style=\"font-size:34px;font-weight:800\">${fmt(t)}<span style=\"font-size:14px\">¬∞C</span></div>\n      <div style=\"font-size:14px;opacity:.75\">${fmt(a)} ¬∞C</div>\n    </div>`;\n]]]\n"
                      }
                    },
                    {
                      "type": "vertical-stack",
                      "cards": [
                        {
                          "type": "custom:button-card",
                          "entity": "climate.thermostat_sdb",
                          "icon": "mdi:plus",
                          "show_name": false,
                          "show_state": false,
                          "tap_action": {
                            "action": "call-service",
                            "service": "climate.set_temperature",
                            "data": {
                              "entity_id": "climate.thermostat_sdb",
                              "temperature": "[[[\n  const t = Number(entity.attributes?.temperature ?? 19);\n  const s = Number(entity.attributes?.target_temp_step ?? 0.5);\n  const tMax = Number(entity.attributes?.max_temp ?? 30);\n  return Number(Math.min(tMax, t + s).toFixed(1));\n]]]\n"
                            }
                          },
                          "hold_action": {
                            "action": "call-service",
                            "service": "climate.set_temperature",
                            "data": {
                              "entity_id": "climate.thermostat_sdb",
                              "temperature": "[[[\n  const t = Number(entity.attributes?.temperature ?? 19);\n  const tMax = Number(entity.attributes?.max_temp ?? 30);\n  return Number(Math.min(tMax, t + 1).toFixed(1));\n]]]\n"
                            }
                          },
                          "styles": {
                            "card": [
                              {
                                "min-height": "60px"
                              },
                              {
                                "border-radius": "18px"
                              },
                              {
                                "background": "#f1f3f8"
                              },
                              {
                                "box-shadow": "8px 8px 18px #dde1ea, -6px -6px 16px #ffffff"
                              }
                            ],
                            "icon": [
                              {
                                "width": "26px"
                              }
                            ]
                          }
                        },
                        {
                          "type": "custom:button-card",
                          "entity": "climate.thermostat_sdb",
                          "icon": "mdi:minus",
                          "show_name": false,
                          "show_state": false,
                          "tap_action": {
                            "action": "call-service",
                            "service": "climate.set_temperature",
                            "data": {
                              "entity_id": "climate.thermostat_sdb",
                              "temperature": "[[[\n  const t = Number(entity.attributes?.temperature ?? 19);\n  const s = Number(entity.attributes?.target_temp_step ?? 0.5);\n  const tMin = Number(entity.attributes?.min_temp ?? 7);\n  return Number(Math.max(tMin, t - s).toFixed(1));\n]]]\n"
                            }
                          },
                          "hold_action": {
                            "action": "call-service",
                            "service": "climate.set_temperature",
                            "data": {
                              "entity_id": "climate.thermostat_sdb",
                              "temperature": "[[[\n  const t = Number(entity.attributes?.temperature ?? 19);\n  const tMin = Number(entity.attributes?.min_temp ?? 7);\n  return Number(Math.max(tMin, t - 1).toFixed(1));\n]]]\n"
                            }
                          },
                          "styles": {
                            "card": [
                              {
                                "min-height": "60px"
                              },
                              {
                                "border-radius": "18px"
                              },
                              {
                                "margin-top": "8px"
                              },
                              {
                                "background": "#f1f3f8"
                              },
                              {
                                "box-shadow": "8px 8px 18px #dde1ea, -6px -6px 16px #ffffff"
                              }
                            ],
                            "icon": [
                              {
                                "width": "26px"
                              }
                            ]
                          }
                        }
                      ]
                    }
                  ]
                },
                {
                  "type": "grid",
                  "columns": 3,
                  "square": false,
                  "cards": [
                    {
                      "type": "custom:button-card",
                      "entity": "climate.thermostat_sdb",
                      "name": "Chauffe",
                      "icon": "mdi:fire",
                      "tap_action": {
                        "action": "call-service",
                        "service": "climate.set_hvac_mode",
                        "data": {
                          "entity_id": "climate.thermostat_sdb",
                          "hvac_mode": "heat"
                        }
                      },
                      "styles": {
                        "card": [
                          {
                            "border-radius": "14px"
                          },
                          {
                            "padding": "8px"
                          },
                          {
                            "min-height": "54px"
                          },
                          {
                            "background": "#f1f3f8"
                          },
                          {
                            "box-shadow": "8px 8px 18px #dde1ea, -6px -6px 16px #ffffff"
                          },
                          {
                            "filter": "[[[\n  return entity.state==='heat' ? 'none' : 'grayscale(20%)';\n]]]\n"
                          }
                        ],
                        "icon": [
                          {
                            "width": "20px"
                          }
                        ],
                        "name": [
                          {
                            "font-size": ".85rem"
                          },
                          {
                            "margin-top": "2px"
                          },
                          {
                            "font-weight": 600
                          }
                        ]
                      }
                    },
                    {
                      "type": "custom:button-card",
                      "entity": "climate.thermostat_sdb",
                      "name": "Arr√™t",
                      "icon": "mdi:power",
                      "tap_action": {
                        "action": "call-service",
                        "service": "climate.set_hvac_mode",
                        "data": {
                          "entity_id": "climate.thermostat_sdb",
                          "hvac_mode": "off"
                        }
                      },
                      "styles": {
                        "card": [
                          {
                            "border-radius": "14px"
                          },
                          {
                            "padding": "8px"
                          },
                          {
                            "min-height": "54px"
                          },
                          {
                            "background": "#f1f3f8"
                          },
                          {
                            "box-shadow": "8px 8px 18px #dde1ea, -6px -6px 16px #ffffff"
                          },
                          {
                            "filter": "[[[\n  return entity.state==='off' ? 'none' : 'grayscale(20%)';\n]]]\n"
                          }
                        ],
                        "icon": [
                          {
                            "width": "18px"
                          }
                        ],
                        "name": [
                          {
                            "font-size": ".85rem"
                          },
                          {
                            "margin-top": "2px"
                          },
                          {
                            "font-weight": 600
                          }
                        ]
                      }
                    },
                    {
                      "type": "custom:button-card",
                      "entity": "climate.thermostat_sdb",
                      "name": "Boost",
                      "icon": "mdi:rocket-launch",
                      "tap_action": {
                        "action": "call-service",
                        "service": "climate.set_preset_mode",
                        "data": {
                          "entity_id": "climate.thermostat_sdb",
                          "preset_mode": "boost"
                        }
                      },
                      "styles": {
                        "card": [
                          {
                            "border-radius": "14px"
                          },
                          {
                            "padding": "8px"
                          },
                          {
                            "min-height": "54px"
                          },
                          {
                            "background": "#f1f3f8"
                          },
                          {
                            "box-shadow": "8px 8px 18px #dde1ea, -6px -6px 16px #ffffff"
                          },
                          {
                            "display": "[[[\n  const P = entity.attributes?.preset_modes || [];\n  return P.includes('boost') ? 'block' : 'none';\n]]]\n"
                          }
                        ],
                        "icon": [
                          {
                            "width": "20px"
                          }
                        ],
                        "name": [
                          {
                            "font-size": ".85rem"
                          },
                          {
                            "margin-top": "2px"
                          },
                          {
                            "font-weight": 600
                          }
                        ]
                      }
                    }
                  ]
                }
              ]
            },
            {
              "type": "custom:vertical-stack-in-card",
              "cards": [
                {
                  "type": "grid",
                  "square": false,
                  "columns": 2,
                  "cards": [
                    {
                      "type": "custom:mushroom-entity-card",
                      "entity": "sensor.daikin_split_salon_climatecontrol_outdoor_temperature",
                      "primary_info": "state",
                      "secondary_info": "name",
                      "name": "T¬∞ ext√©rieure",
                      "icon_color": "amber"
                    },
                    {
                      "type": "custom:mushroom-entity-card",
                      "entity": "sensor.sanguinet_pressure",
                      "primary_info": "state",
                      "secondary_info": "name",
                      "icon_color": "light-blue",
                      "name": "Pression"
                    }
                  ]
                },
                {
                  "type": "custom:mini-graph-card",
                  "entities": [
                    {
                      "entity": "sensor.daikin_split_salon_climatecontrol_outdoor_temperature"
                    },
                    {
                      "color": "gray",
                      "entity": "sun.sun",
                      "name": "Sun",
                      "show_line": false,
                      "show_points": false,
                      "show_legend": false,
                      "y_axis": "secondary"
                    }
                  ],
                  "name_adaptive_color": true,
                  "show": {
                    "legend": false,
                    "state": false,
                    "name": false,
                    "icon": false,
                    "labels": false,
                    "graph": "line"
                  },
                  "color_thresholds": [
                    {
                      "value": 0,
                      "color": "#1F96F4"
                    },
                    {
                      "value": 6,
                      "color": "#1BDE69"
                    },
                    {
                      "value": 12,
                      "color": "#C2E433"
                    },
                    {
                      "value": 16,
                      "color": "#FB683B"
                    },
                    {
                      "value": 23,
                      "color": "#DC1246"
                    },
                    {
                      "value": 30,
                      "color": "#83172C"
                    },
                    {
                      "value": 37,
                      "color": "#A900F8"
                    }
                  ],
                  "hours_to_show": 48,
                  "state_map": [
                    {
                      "value": "above_horizon",
                      "label": "Day"
                    },
                    {
                      "value": "below_horizon",
                      "label": "Night",
                      "animate": true
                    }
                  ]
                }
              ]
            },
            {
              "type": "custom:mushroom-chips-card",
              "alignment": "end",
              "chips": [
                {
                  "type": "template",
                  "entity": "input_boolean.sdb_reveil_enable",
                  "icon": "{{ 'mdi:shower-head' if is_state('input_boolean.sdb_reveil_enable','on') else 'mdi:shower' }}",
                  "content": "{{ 'SDB Coll√®ge' if is_state('input_boolean.sdb_reveil_enable','on') else 'R√©veil SDB' }}",
                  "icon_color": "{{ 'green' if is_state('input_boolean.sdb_reveil_enable','on') else 'grey' }}",
                  "tap_action": {
                    "action": "toggle"
                  },
                  "hold_action": {
                    "action": "more-info"
                  }
                }
              ]
            },
            {
              "type": "custom:vertical-stack-in-card",
              "cards": [
                {
                  "type": "custom:mushroom-template-card",
                  "entity": "input_boolean.sdb_reveil_enable",
                  "primary": "R√©veil douche (SDB)",
                  "secondary": "{{ 'Actif' if is_state('input_boolean.sdb_reveil_enable','on') else 'Arr√™t√©' }}",
                  "icon": "{{ 'mdi:shower-head' if is_state('input_boolean.sdb_reveil_enable','on') else 'mdi:shower' }}",
                  "icon_color": "{{ 'green' if is_state('input_boolean.sdb_reveil_enable','on') else 'grey' }}",
                  "tap_action": {
                    "action": "none"
                  },
                  "hold_action": {
                    "action": "toggle"
                  },
                  "double_tap_action": {
                    "action": "none"
                  },
                  "card_mod": {
                    "style": "ha-card {\n  border-radius: 16px;\n  padding: 10px;\n  box-shadow: 0 2px 8px rgba(0,0,0,.12);\n  background: {{ is_state('input_boolean.sdb_reveil_enable','on')\n    | iif('linear-gradient(135deg, rgba(34,197,94,.14), rgba(6,182,212,.08))',\n          'linear-gradient(135deg, rgba(148,163,184,.16), rgba(6,182,212,.06))') }};\n}\n"
                  }
                },
                {
                  "type": "custom:layout-card",
                  "layout_type": "grid",
                  "layout": {
                    "grid-template-columns": "repeat(4, 1fr)",
                    "column-gap": "4px",
                    "row-gap": "4px"
                  },
                  "cards": [
                    {
                      "type": "custom:button-card",
                      "entity": "switch.chargeur_isa",
                      "name": "Chargeur",
                      "label": "Isa",
                      "icon": "mdi:battery-charging",
                      "show_state": false,
                      "show_label": true,
                      "styles": {
                        "card": [
                          {
                            "min-height": "52px"
                          },
                          {
                            "border-radius": "12px"
                          },
                          {
                            "padding": "0px 0px"
                          },
                          {
                            "box-shadow": "0 1px 6px rgba(0,0,0,.12)"
                          },
                          {
                            "background": "[[[\n  return (entity?.state === 'on')\n    ? 'linear-gradient(135deg, rgba(239,68,68,.14), rgba(6,182,212,.06))'\n    : 'linear-gradient(135deg, rgba(6,182,212,.10), rgba(6,182,212,.05))';\n]]]\n"
                          }
                        ],
                        "grid": [
                          {
                            "grid-template-areas": "\"i n\" \"i l\""
                          },
                          {
                            "grid-template-columns": "28px 1fr"
                          },
                          {
                            "row-gap": "2px"
                          }
                        ],
                        "icon": [
                          {
                            "width": "22px"
                          },
                          {
                            "color": "[[[\n  return (entity?.state === 'on') ? '#ef4444' : '#0ea5e9';\n]]]\n"
                          }
                        ],
                        "name": [
                          {
                            "align-self": "end"
                          },
                          {
                            "font-weight": 700
                          },
                          {
                            "font-size": ".82rem"
                          }
                        ],
                        "label": [
                          {
                            "align-self": "start"
                          },
                          {
                            "font-size": "1rem"
                          },
                          {
                            "opacity": 0.9
                          }
                        ]
                      },
                      "tap_action": {
                        "action": "toggle"
                      }
                    },
                    {
                      "type": "custom:button-card",
                      "entity": "switch.chargeur_laurent",
                      "name": "Chargeur",
                      "label": "Lau",
                      "icon": "mdi:battery-charging",
                      "show_state": false,
                      "show_label": true,
                      "styles": {
                        "card": [
                          {
                            "min-height": "52px"
                          },
                          {
                            "border-radius": "12px"
                          },
                          {
                            "padding": "0px 0px"
                          },
                          {
                            "box-shadow": "0 1px 6px rgba(0,0,0,.12)"
                          },
                          {
                            "background": "[[[\n  return (entity?.state === 'on')\n    ? 'linear-gradient(135deg, rgba(239,68,68,.14), rgba(6,182,212,.06))'\n    : 'linear-gradient(135deg, rgba(6,182,212,.10), rgba(6,182,212,.05))';\n]]]\n"
                          }
                        ],
                        "grid": [
                          {
                            "grid-template-areas": "\"i n\" \"i l\""
                          },
                          {
                            "grid-template-columns": "28px 1fr"
                          },
                          {
                            "row-gap": "2px"
                          }
                        ],
                        "icon": [
                          {
                            "width": "22px"
                          },
                          {
                            "color": "[[[\n  return (entity?.state === 'on') ? '#ef4444' : '#0ea5e9';\n]]]\n"
                          }
                        ],
                        "name": [
                          {
                            "align-self": "end"
                          },
                          {
                            "font-weight": 700
                          },
                          {
                            "font-size": ".82rem"
                          }
                        ],
                        "label": [
                          {
                            "align-self": "start"
                          },
                          {
                            "font-size": "1rem"
                          },
                          {
                            "opacity": 0.9
                          }
                        ]
                      },
                      "tap_action": {
                        "action": "toggle"
                      }
                    },
                    {
                      "type": "custom:button-card",
                      "entity": "switch.ordi_moniteur",
                      "name": "Hi-fi &",
                      "label": "√©cran",
                      "icon": "mdi:monitor-speaker",
                      "show_state": false,
                      "show_label": true,
                      "styles": {
                        "card": [
                          {
                            "min-height": "52px"
                          },
                          {
                            "border-radius": "12px"
                          },
                          {
                            "padding": "6px 8px"
                          },
                          {
                            "box-shadow": "0 1px 6px rgba(0,0,0,.12)"
                          },
                          {
                            "background": "[[[\n  return (entity?.state === 'on')\n    ? 'linear-gradient(135deg, rgba(239,68,68,.14), rgba(6,182,212,.06))'\n    : 'linear-gradient(135deg, rgba(6,182,212,.10), rgba(6,182,212,.05))';\n]]]\n"
                          }
                        ],
                        "grid": [
                          {
                            "grid-template-areas": "\"i n\" \"i l\""
                          },
                          {
                            "grid-template-columns": "28px 1fr"
                          },
                          {
                            "row-gap": "2px"
                          }
                        ],
                        "icon": [
                          {
                            "width": "22px"
                          },
                          {
                            "color": "[[[\n  return (entity?.state === 'on') ? '#ef4444' : '#0ea5e9';\n]]]\n"
                          }
                        ],
                        "name": [
                          {
                            "align-self": "end"
                          },
                          {
                            "font-weight": 600
                          },
                          {
                            "font-size": ".92rem"
                          }
                        ],
                        "label": [
                          {
                            "align-self": "start"
                          },
                          {
                            "font-weight": 600
                          },
                          {
                            "font-size": ".92rem"
                          },
                          {
                            "opacity": 0.95
                          }
                        ]
                      },
                      "tap_action": {
                        "action": "toggle"
                      }
                    },
                    {
                      "type": "custom:button-card",
                      "entity": "switch.0x08ddebfffed9ed45",
                      "name": "Atelier",
                      "icon": "mdi:lightbulb",
                      "show_state": false,
                      "show_label": true,
                      "label": "[[[\n  const v = states['sensor.thermo_garage_temperature']?.state;\n  if (!v || v === 'unknown' || v === 'unavailable') return '‚Äî';\n  const n = Number(v);\n  return isNaN(n) ? v : `${n.toFixed(1)}¬∞C`;\n]]]\n",
                      "styles": {
                        "card": [
                          {
                            "min-height": "52px"
                          },
                          {
                            "border-radius": "12px"
                          },
                          {
                            "padding": "6px 8px"
                          },
                          {
                            "box-shadow": "0 1px 6px rgba(0,0,0,.12)"
                          },
                          {
                            "background": "[[[\n  return (entity?.state === 'on')\n    ? 'linear-gradient(135deg, rgba(239,68,68,.14), rgba(6,182,212,.06))'\n    : 'linear-gradient(135deg, rgba(6,182,212,.10), rgba(6,182,212,.05))';\n]]]\n"
                          }
                        ],
                        "grid": [
                          {
                            "grid-template-areas": "\"i n\" \"i l\""
                          },
                          {
                            "grid-template-columns": "28px 1fr"
                          },
                          {
                            "grid-template-rows": "auto auto"
                          }
                        ],
                        "icon": [
                          {
                            "width": "22px"
                          },
                          {
                            "color": "[[[\n  return (entity?.state === 'on') ? '#facc15' : '#0ea5e9';\n]]]\n"
                          },
                          {
                            "filter": "[[[\n  return (entity?.state === 'on')\n    ? 'drop-shadow(0 0 6px rgba(250,204,21,.75)) saturate(120%)'\n    : 'none';\n]]]\n"
                          },
                          {
                            "transition": "filter .2s ease, color .2s ease"
                          }
                        ],
                        "name": [
                          {
                            "align-self": "end"
                          },
                          {
                            "font-weight": 600
                          },
                          {
                            "font-size": ".92rem"
                          },
                          {
                            "line-height": 1.05
                          }
                        ],
                        "label": [
                          {
                            "align-self": "start"
                          },
                          {
                            "font-weight": 600
                          },
                          {
                            "font-size": ".92rem"
                          },
                          {
                            "line-height": 1.05
                          }
                        ]
                      },
                      "tap_action": {
                        "action": "toggle"
                      }
                    }
                  ]
                },
                {
                  "type": "custom:layout-card",
                  "layout_type": "grid",
                  "layout": {
                    "grid-template-columns": "repeat(3, 1fr)",
                    "column-gap": "4px",
                    "row-gap": "4px"
                  },
                  "cards": [
                    {
                      "type": "custom:button-card",
                      "entity": "switch.shellypro1_ece334ee1b64",
                      "name": "Cumulus",
                      "icon": "mdi:water-boiler",
                      "show_state": false,
                      "styles": {
                        "card": [
                          {
                            "min-height": "52px"
                          },
                          {
                            "border-radius": "12px"
                          },
                          {
                            "padding": "6px 8px"
                          },
                          {
                            "box-shadow": "0 1px 6px rgba(0,0,0,.12)"
                          },
                          {
                            "background": "[[[\n  return (entity?.state === 'on')\n    ? 'linear-gradient(135deg, rgba(239,68,68,.14), rgba(6,182,212,.06))'\n    : 'linear-gradient(135deg, rgba(6,182,212,.10), rgba(6,182,212,.05))';\n]]]\n"
                          }
                        ],
                        "grid": [
                          {
                            "grid-template-areas": "\"i n\""
                          },
                          {
                            "grid-template-columns": "28px 1fr"
                          }
                        ],
                        "icon": [
                          {
                            "width": "28px"
                          },
                          {
                            "color": "[[[\n  return (entity?.state === 'on') ? '#ef4444' : '#0ea5e9';\n]]]\n"
                          }
                        ],
                        "name": [
                          {
                            "align-self": "center"
                          },
                          {
                            "font-weight": 600
                          },
                          {
                            "font-size": ".92rem"
                          }
                        ]
                      },
                      "tap_action": {
                        "action": "toggle"
                      }
                    },
                    {
                      "type": "custom:button-card",
                      "entity": "sensor.iphone_isa_battery_level",
                      "name": "iPhone",
                      "icon": "mdi:cellphone",
                      "show_state": false,
                      "show_label": false,
                      "custom_fields": {
                        "pct": "[[[\n  const v = Math.max(0, Math.min(100, Number(entity?.state) || 0));\n  return `${v.toFixed(0)} %`;\n]]]\n",
                        "bar": "[[[\n  const lvl = Math.max(0, Math.min(100, Number(entity?.state) || 0));\n  const hue = Math.round(lvl * 1.2); // 0‚Üí120 (rouge‚Üívert)\n  const color = `hsl(${hue}, 85%, 45%)`;\n  return `\n    <div style=\"height:4px;width:100%;background:var(--ha-card-background,#e6e9ef);border-radius:3px;overflow:hidden\">\n      <div style=\"height:100%;width:${lvl}%;background:${color}\"></div>\n    </div>`;\n]]]\n"
                      },
                      "styles": {
                        "card": [
                          {
                            "min-height": "52px"
                          },
                          {
                            "border-radius": "12px"
                          },
                          {
                            "padding": "6px 8px"
                          },
                          {
                            "box-shadow": "0 1px 6px rgba(0,0,0,.12)"
                          },
                          {
                            "background": "[[[\n  const lvl = Math.max(0, Math.min(100, Number(entity?.state) || 0));\n  const hue = Math.round(lvl * 1.2);\n  const c1 = `hsla(${hue}, 85%, 60%, .16)`;\n  const c2 = `hsla(${hue}, 85%, 60%, .08)`;\n  return `linear-gradient(135deg, ${c1}, ${c2})`;\n]]]\n"
                          }
                        ],
                        "grid": [
                          {
                            "grid-template-areas": "\"i n pct\" \"bar bar bar\""
                          },
                          {
                            "grid-template-columns": "20px 1fr auto"
                          },
                          {
                            "grid-template-rows": "auto 4px"
                          },
                          {
                            "row-gap": "4px"
                          }
                        ],
                        "icon": [
                          {
                            "width": "14px"
                          },
                          {
                            "color": "#0ea5e9"
                          }
                        ],
                        "name": [
                          {
                            "align-self": "center"
                          },
                          {
                            "font-weight": 600
                          },
                          {
                            "font-size": ".92rem"
                          }
                        ],
                        "custom_fields": {
                          "pct": [
                            {
                              "grid-area": "pct"
                            },
                            {
                              "align-self": "center"
                            },
                            {
                              "justify-self": "end"
                            },
                            {
                              "font-size": ".9rem"
                            },
                            {
                              "opacity": 0.95
                            }
                          ],
                          "bar": [
                            {
                              "grid-area": "bar"
                            },
                            {
                              "align-self": "end"
                            }
                          ]
                        }
                      },
                      "tap_action": {
                        "action": "more-info"
                      },
                      "triggers_update": [
                        "sensor.iphone_isa_battery_level"
                      ]
                    },
                    {
                      "type": "custom:button-card",
                      "entity": "sensor.ipad_de_isabelle_battery_level",
                      "name": "iPad Air",
                      "icon": "mdi:tablet",
                      "show_state": false,
                      "show_label": false,
                      "custom_fields": {
                        "pct": "[[[\n  const v = Math.max(0, Math.min(100, Number(entity?.state) || 0));\n  return `${v.toFixed(0)} %`;\n]]]\n",
                        "bar": "[[[\n  const lvl = Math.max(0, Math.min(100, Number(entity?.state) || 0));\n  const hue = Math.round(lvl * 1.2);\n  const color = `hsl(${hue}, 85%, 45%)`;\n  return `\n    <div style=\"height:4px;width:100%;background:var(--ha-card-background,#e6e9ef);border-radius:3px;overflow:hidden\">\n      <div style=\"height:100%;width:${lvl}%;background:${color}\"></div>\n    </div>`;\n]]]\n"
                      },
                      "styles": {
                        "card": [
                          {
                            "min-height": "52px"
                          },
                          {
                            "border-radius": "12px"
                          },
                          {
                            "padding": "6px 8px"
                          },
                          {
                            "box-shadow": "0 1px 6px rgba(0,0,0,.12)"
                          },
                          {
                            "background": "[[[\n  const lvl = Math.max(0, Math.min(100, Number(entity?.state) || 0));\n  const hue = Math.round(lvl * 1.2);\n  const c1 = `hsla(${hue}, 85%, 60%, .16)`;\n  const c2 = `hsla(${hue}, 85%, 60%, .08)`;\n  return `linear-gradient(135deg, ${c1}, ${c2})`;\n]]]\n"
                          }
                        ],
                        "grid": [
                          {
                            "grid-template-areas": "\"i n pct\" \"bar bar bar\""
                          },
                          {
                            "grid-template-columns": "20px 1fr auto"
                          },
                          {
                            "grid-template-rows": "auto 4px"
                          },
                          {
                            "row-gap": "4px"
                          }
                        ],
                        "icon": [
                          {
                            "width": "24px"
                          },
                          {
                            "color": "#0ea5e9"
                          }
                        ],
                        "name": [
                          {
                            "align-self": "center"
                          },
                          {
                            "font-weight": 600
                          },
                          {
                            "font-size": ".92rem"
                          }
                        ],
                        "custom_fields": {
                          "pct": [
                            {
                              "grid-area": "pct"
                            },
                            {
                              "align-self": "center"
                            },
                            {
                              "justify-self": "end"
                            },
                            {
                              "font-size": ".9rem"
                            },
                            {
                              "opacity": 0.95
                            }
                          ],
                          "bar": [
                            {
                              "grid-area": "bar"
                            },
                            {
                              "align-self": "end"
                            }
                          ]
                        }
                      },
                      "tap_action": {
                        "action": "more-info"
                      },
                      "triggers_update": [
                        "sensor.ipad_de_isabelle_battery_level"
                      ]
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "title": "CalendrierTest ",
          "path": "calendriertest",
          "icon": "mdi:calendar-month-outline",
          "type": "panel",
          "visible": [
            {
              "user": "65f9557d9a4e4b3ca7469ddd356031a8"
            }
          ],
          "cards": [
            {
              "type": "custom:week-planner-card",
              "title": "",
              "class": "col-12",
              "startingDay": "today",
              "hideWeekend": false,
              "calendars": [
                {
                  "entity": "calendar.planning_cours_isa",
                  "color": "#e6c229"
                },
                {
                  "entity": "calendar.jours_feries_en_france",
                  "color": "#1a8fe3"
                },
                {
                  "entity": "calendar.vacances_scolaires",
                  "color": "#d11149"
                }
              ],
              "weather": {
                "entity": "weather.biscarrosse",
                "showTemperature": true,
                "showLowTemperature": true
              },
              "days": 40,
              "noCardBackground": true,
              "eventBackground": "rgba(0, 0, 0, .75)",
              "compact": false,
              "updateInterval": 300,
              "texts": {
                "today": "Aujourdhui",
                "tomorrow": "Demain",
                "noEvents": "",
                "fullDay": ""
              },
              "card_mod": {
                "style": "ha-card {\n  margin-top: 1px;\n  }\n.event.past {\n  opacity: .7;\n}\n"
              }
            }
          ]
        },
        {
          "title": "Solaire",
          "path": "solaire",
          "icon": "mdi:solar-power",
          "type": "masonry",
          "badges": [
            {
              "entity": "binary_sensor.hc_actives"
            },
            {
              "entity": "sensor.price_current_eur_kwh"
            }
          ],
          "cards": [
            {
              "type": "vertical-stack",
              "cards": [
                {
                  "type": "entities",
                  "title": "Baseline (calibrage)",
                  "entities": [
                    {
                      "entity": "input_number.economie_baseline_eur",
                      "name": "Baseline ‚Ç¨ (ant√©rieur)"
                    },
                    {
                      "entity": "input_number.kwh_baseline",
                      "name": "Baseline kWh (ant√©rieur)"
                    }
                  ]
                },
                {
                  "type": "horizontal-stack",
                  "cards": [
                    {
                      "type": "button",
                      "name": "Fixer baseline = totaux actuels",
                      "icon": "mdi:content-save-cog",
                      "tap_action": {
                        "action": "call-service",
                        "service": "script.solaire_set_baseline_from_current"
                      }
                    },
                    {
                      "type": "button",
                      "name": "Remettre baseline √† 0",
                      "icon": "mdi:backup-restore",
                      "tap_action": {
                        "action": "call-service",
                        "service": "script.solaire_reset_baseline"
                      }
                    }
                  ]
                }
              ]
            },
            {
              "type": "grid",
              "title": "Indicateurs cl√©s",
              "columns": 2,
              "square": false,
              "cards": [
                {
                  "type": "tile",
                  "entity": "sensor.savings_day_eur",
                  "name": "√âconomies (jour)",
                  "icon": "mdi:currency-eur"
                },
                {
                  "type": "tile",
                  "entity": "sensor.energy_saved_day_kwh",
                  "name": "kWh √©vit√©s (jour)",
                  "icon": "mdi:lightning-bolt-circle"
                },
                {
                  "type": "tile",
                  "entity": "sensor.savings_month_eur",
                  "name": "√âconomies (mois)",
                  "icon": "mdi:calendar-month"
                },
                {
                  "type": "tile",
                  "entity": "sensor.savings_year_eur",
                  "name": "√âconomies (ann√©e)",
                  "icon": "mdi:calendar"
                },
                {
                  "type": "tile",
                  "entity": "sensor.savings_total_eur_with_baseline",
                  "name": "Total ‚Ç¨ (baseline incluse)",
                  "icon": "mdi:cou"
                }
              ]
            },
            {
              "type": "entities",
              "title": "Audit √©conomies (jour)",
              "entities": [
                {
                  "entity": "sensor.savings_day_eur",
                  "name": "‚Ç¨ jour (total)"
                },
                {
                  "entity": "sensor.savings_hp_day_eur",
                  "name": "‚Ç¨ jour HP"
                },
                {
                  "entity": "sensor.savings_hc_day_eur",
                  "name": "‚Ç¨ jour HC"
                },
                {
                  "entity": "binary_sensor.hc_actives",
                  "name": "HC actives ?"
                },
                {
                  "entity": "sensor.price_current_eur_kwh",
                  "name": "Tarif courant (‚Ç¨/kWh)"
                },
                {
                  "entity": "sensor.power_saved_w",
                  "name": "Puissance √©vit√©e (W)"
                },
                {
                  "entity": "sensor.sb_ac_output_w",
                  "name": "SB AC (W)"
                },
                {
                  "entity": "sensor.aps_power_w",
                  "name": "APS (W)"
                },
                {
                  "entity": "sensor.grid_export_w",
                  "name": "Export r√©seau (W)"
                },
                {
                  "entity": "sensor.batt_charge_w",
                  "name": "Charge batterie (W)"
                }
              ]
            },
            {
              "type": "entities",
              "title": "Debug Nuit",
              "entities": [
                "sensor.aps_power_w",
                "sensor.sb_pv_w",
                "sensor.batt_discharge_w",
                "sensor.batt_charge_w",
                "sensor.sb_ac_output_w",
                "sensor.grid_export_w",
                "sensor.power_saved_w",
                "sensor.saving_rate_eur_per_hour"
              ]
            },
            {
              "type": "picture-elements",
              "image": "https://www.monchauffageelectrique.com/wp-content/uploads/2019/06/panneaux-solaires-photovoltaiques.jpg",
              "elements": [
                {
                  "type": "state-label",
                  "entity": "sensor.dashboard_titre_photovoltaique",
                  "style": {
                    "top": "10%",
                    "left": "50%",
                    "transform": "translateX(-50%)",
                    "color": "white",
                    "font-size": "24px",
                    "font-weight": "bold",
                    "text-shadow": "2px 2px 4px rgba(0,0,0,0.8)",
                    "background": "rgba(0,0,0,0.4)",
                    "padding": "6px 12px",
                    "border-radius": "8px"
                  }
                },
                {
                  "type": "custom:button-card",
                  "entity": "sensor.savings_day_eur",
                  "name": "Aujourd‚Äôhui",
                  "icon": "mdi:calendar-today",
                  "layout": "icon_state",
                  "show_icon": false,
                  "show_state": true,
                  "state_display": "[[[\n  const v = Number(entity.state);\n  return isNaN(v) ? '‚Äî' :\n    v.toLocaleString('fr-FR',{minimumFractionDigits:2, maximumFractionDigits:2}) + ' ‚Ç¨';\n]]]\n",
                  "styles": {
                    "card": [
                      {
                        "width": "100px"
                      },
                      {
                        "height": "100px"
                      },
                      {
                        "border-radius": "50%"
                      },
                      {
                        "background": "rgba(33,150,243,0.85)"
                      },
                      {
                        "box-shadow": "0 4px 10px rgba(0,0,0,0.6)"
                      }
                    ],
                    "icon": [
                      {
                        "color": "#ffeb3b"
                      },
                      {
                        "width": "32px"
                      },
                      {
                        "height": "32px"
                      }
                    ],
                    "state": [
                      {
                        "color": "white"
                      },
                      {
                        "font-size": "16px"
                      },
                      {
                        "font-weight": "bold"
                      },
                      {
                        "margin-right": "35px"
                      }
                    ],
                    "name": [
                      {
                        "color": "white"
                      },
                      {
                        "font-size": "16px"
                      },
                      {
                        "margin-bottom": "10px"
                      }
                    ]
                  },
                  "style": {
                    "top": "60%",
                    "left": "14%",
                    "transform": "translate(-50%, -50%)"
                  }
                },
                {
                  "type": "custom:button-card",
                  "name": "Mensuel",
                  "icon": "mdi:calendar-month",
                  "layout": "icon_state",
                  "show_icon": false,
                  "show_state": true,
                  "styles": {
                    "card": [
                      {
                        "width": "100px"
                      },
                      {
                        "height": "100px"
                      },
                      {
                        "border-radius": "50%"
                      },
                      {
                        "background": "rgba(76,175,80,0.85)"
                      },
                      {
                        "box-shadow": "0 4px 10px rgba(0,0,0,0.6)"
                      }
                    ],
                    "icon": [
                      {
                        "color": "white"
                      },
                      {
                        "width": "32px"
                      },
                      {
                        "height": "32px"
                      }
                    ],
                    "state": [
                      {
                        "color": "white"
                      },
                      {
                        "font-size": "16px"
                      },
                      {
                        "font-weight": "bold"
                      },
                      {
                        "margin-right": "35px"
                      }
                    ],
                    "name": [
                      {
                        "color": "white"
                      },
                      {
                        "font-size": "16px"
                      },
                      {
                        "margin-bottom": "10px"
                      }
                    ]
                  },
                  "style": {
                    "top": "60%",
                    "left": "38%",
                    "transform": "translate(-50%, -50%)"
                  }
                },
                {
                  "type": "custom:button-card",
                  "entity": "sensor.savings_total_eur_with_baseline",
                  "name": "Annuel",
                  "icon": "mdi:chart-box-outline",
                  "layout": "icon_state",
                  "show_icon": false,
                  "show_state": true,
                  "state_display": "[[[\n  const v = Number(entity.state);\n  return isNaN(v) ? '‚Äî' :\n    v.toLocaleString('fr-FR',{minimumFractionDigits:2, maximumFractionDigits:2}) + ' ‚Ç¨';\n]]]\n",
                  "styles": {
                    "card": [
                      {
                        "width": "100px"
                      },
                      {
                        "height": "100px"
                      },
                      {
                        "border-radius": "50%"
                      },
                      {
                        "background": "rgba(255,165,40,0.8)"
                      },
                      {
                        "box-shadow": "0 4px 10px rgba(0,0,0,0.6)"
                      }
                    ],
                    "icon": [
                      {
                        "color": "white"
                      },
                      {
                        "width": "32px"
                      },
                      {
                        "height": "32px"
                      }
                    ],
                    "state": [
                      {
                        "color": "white"
                      },
                      {
                        "font-size": "14px"
                      },
                      {
                        "font-weight": "bold"
                      },
                      {
                        "margin-right": "35px"
                      }
                    ],
                    "name": [
                      {
                        "color": "white"
                      },
                      {
                        "font-size": "16px"
                      },
                      {
                        "margin-top": "0px"
                      },
                      {
                        "margin-bottom": "10px"
                      }
                    ]
                  },
                  "style": {
                    "top": "60%",
                    "left": "62%",
                    "transform": "translate(-50%, -50%)"
                  }
                },
                {
                  "type": "custom:button-card",
                  "entity": "sensor.savings_total_eur_with_baseline",
                  "name": "Total",
                  "icon": "mdi:chart-box-outline",
                  "layout": "icon_state",
                  "show_icon": false,
                  "show_state": true,
                  "state_display": "[[[\n  const v = Number(entity.state);\n  return isNaN(v) ? '‚Äî' :\n    v.toLocaleString('fr-FR',{minimumFractionDigits:2, maximumFractionDigits:2}) + ' ‚Ç¨';\n]]]\n",
                  "styles": {
                    "card": [
                      {
                        "width": "100px"
                      },
                      {
                        "height": "100px"
                      },
                      {
                        "border-radius": "50%"
                      },
                      {
                        "background": "rgba(244,67,54,0.85)"
                      },
                      {
                        "box-shadow": "0 4px 10px rgba(0,0,0,0.6)"
                      }
                    ],
                    "icon": [
                      {
                        "color": "white"
                      },
                      {
                        "width": "32px"
                      },
                      {
                        "height": "32px"
                      }
                    ],
                    "state": [
                      {
                        "color": "white"
                      },
                      {
                        "font-size": "14px"
                      },
                      {
                        "font-weight": "bold"
                      },
                      {
                        "margin-right": "35px"
                      }
                    ],
                    "name": [
                      {
                        "color": "white"
                      },
                      {
                        "font-size": "16px"
                      },
                      {
                        "margin-top": "0px"
                      },
                      {
                        "margin-bottom": "10px"
                      }
                    ]
                  },
                  "style": {
                    "top": "60%",
                    "left": "86%",
                    "transform": "translate(-50%, -50%)"
                  }
                }
              ]
            },
            {
              "type": "entities",
              "title": "Watchdog HC/HP",
              "entities": [
                {
                  "entity": "binary_sensor.hc_actives",
                  "name": "HC actives ?"
                },
                {
                  "entity": "sensor.price_current_eur_kwh",
                  "name": "Tarif courant (‚Ç¨/kWh)"
                },
                {
                  "type": "section",
                  "label": "R√©partition du jour"
                },
                {
                  "entity": "sensor.savings_hc_day_eur",
                  "name": "‚Ç¨ jour HC"
                },
                {
                  "entity": "sensor.savings_hp_day_eur",
                  "name": "‚Ç¨ jour HP"
                }
              ]
            },
            {
              "type": "vertical-stack",
              "cards": [
                {
                  "type": "entities",
                  "title": "Audit ‚Ç¨ en direct (4 d√©cimales)",
                  "entities": [
                    {
                      "entity": "binary_sensor.hc_actives",
                      "name": "HC actives ?"
                    },
                    {
                      "entity": "sensor.price_current_eur_kwh",
                      "name": "Tarif courant (‚Ç¨/kWh)"
                    },
                    {
                      "entity": "sensor.power_saved_w",
                      "name": "Puissance √©vit√©e (W)"
                    },
                    {
                      "type": "section",
                      "label": "Taux ‚Ç¨/h"
                    },
                    {
                      "entity": "sensor.saving_rate_hc_eur_per_hour",
                      "name": "D√©bit HC (‚Ç¨/h)"
                    },
                    {
                      "entity": "sensor.saving_rate_hp_eur_per_hour",
                      "name": "D√©bit HP (‚Ç¨/h)"
                    },
                    {
                      "type": "section",
                      "label": "Int√©grales brutes (4 d√©cimales)"
                    },
                    {
                      "entity": "sensor.savings_hc_eur",
                      "name": "‚Ç¨ HC (total)"
                    },
                    {
                      "entity": "sensor.savings_hp_eur",
                      "name": "‚Ç¨ HP (total)"
                    },
                    {
                      "entity": "sensor.savings_eur",
                      "name": "‚Ç¨ Total (HC+HP)"
                    }
                  ]
                },
                {
                  "type": "history-graph",
                  "title": "√âvolution (60 min)",
                  "hours_to_show": 1,
                  "entities": [
                    "sensor.savings_hc_eur",
                    "sensor.savings_hp_eur",
                    "sensor.saving_rate_hc_eur_per_hour"
                  ]
                }
              ]
            },
            {
              "type": "picture-elements",
              "image": "/local/images/fond_anker.JPEG",
              "elements": [
                {
                  "type": "conditional",
                  "conditions": [
                    {
                      "entity": "sensor.smart_meter_grid_export",
                      "state_not": "0"
                    }
                  ],
                  "elements": [
                    {
                      "type": "icon",
                      "icon": "mdi:arrow-up-bold",
                      "style": {
                        "top": "20%",
                        "left": "87%",
                        "color": "green",
                        "transform": "rotate(0deg)"
                      }
                    },
                    {
                      "type": "state-label",
                      "entity": "sensor.smart_meter_grid_export",
                      "style": {
                        "top": "17%",
                        "left": "82%",
                        "color": "green",
                        "font-size": "18px",
                        "font-weight": "bold"
                      }
                    }
                  ]
                },
                {
                  "type": "conditional",
                  "conditions": [
                    {
                      "entity": "sensor.smart_meter_grid_import",
                      "state_not": "0"
                    }
                  ],
                  "elements": [
                    {
                      "type": "icon",
                      "icon": "mdi:arrow-down-bold",
                      "style": {
                        "top": "20%",
                        "left": "87%",
                        "color": "red",
                        "transform": "rotate(0deg)"
                      }
                    },
                    {
                      "type": "state-label",
                      "entity": "sensor.smart_meter_grid_import",
                      "style": {
                        "top": "17%",
                        "left": "82%",
                        "color": "red",
                        "font-size": "18px",
                        "font-weight": "bold"
                      }
                    }
                  ]
                },
                {
                  "type": "conditional",
                  "conditions": [
                    {
                      "entity": "sensor.smart_meter_grid_export",
                      "state": "0"
                    },
                    {
                      "entity": "sensor.smart_meter_grid_import",
                      "state": "0"
                    }
                  ],
                  "elements": [
                    {
                      "type": "state-label",
                      "entity": "sensor.smart_meter_grid_export",
                      "style": {
                        "top": "17%",
                        "left": "82%",
                        "font-size": "18px",
                        "font-weight": "bold"
                      }
                    }
                  ]
                },
                {
                  "type": "conditional",
                  "conditions": [
                    {
                      "entity": "sensor.solarbank_3_e2700_pro_puissance_de_charge",
                      "state": "0",
                      "condition": "above"
                    }
                  ],
                  "elements": [
                    {
                      "type": "icon",
                      "icon": "mdi:arrow-up-bold",
                      "style": {
                        "top": "35%",
                        "left": "60%",
                        "color": "green"
                      }
                    },
                    {
                      "type": "state-label",
                      "entity": "sensor.solarbank_3_e2700_pro_puissance_de_charge",
                      "style": {
                        "top": "90%",
                        "left": "60%",
                        "color": "green",
                        "font-size": "18px",
                        "font-weight": "bold"
                      }
                    }
                  ]
                },
                {
                  "type": "conditional",
                  "conditions": [
                    {
                      "entity": "sensor.solarbank_3_e2700_pro_puissance_de_charge",
                      "state": "-0.1",
                      "condition": "below"
                    }
                  ],
                  "elements": [
                    {
                      "type": "icon",
                      "icon": "mdi:arrow-down-bold",
                      "style": {
                        "top": "35%",
                        "left": "60%",
                        "color": "red"
                      }
                    },
                    {
                      "type": "state-label",
                      "entity": "sensor.solarbank_3_e2700_pro_puissance_de_charge",
                      "style": {
                        "top": "40%",
                        "left": "60%",
                        "font-size": "18px",
                        "font-weight": "bold"
                      }
                    }
                  ]
                },
                {
                  "type": "conditional",
                  "conditions": [
                    {
                      "entity": "sensor.solarbank_3_e2700_pro_puissance_de_charge",
                      "state": "0"
                    }
                  ],
                  "elements": [
                    {
                      "type": "state-label",
                      "entity": "sensor.solarbank_3_e2700_pro_puissance_de_charge",
                      "style": {
                        "top": "40%",
                        "left": "60%",
                        "font-size": "18px",
                        "font-weight": "bold"
                      }
                    }
                  ]
                }
              ]
            },
            {
              "type": "custom:apexcharts-card",
              "chart_type": "pie",
              "header": {
                "show": true,
                "title": "√ânergie d‚Äôaujourd‚Äôhui"
              },
              "series": [
                {
                  "entity": "sensor.energie_autoconsommee_2",
                  "name": "Solaire",
                  "color": "#ffd700"
                },
                {
                  "entity": "sensor.import_edf_quotidien",
                  "name": "EDF",
                  "color": "#0074D9"
                },
                {
                  "entity": "sensor.export_daily_2",
                  "name": "Surplus",
                  "color": "#d35454"
                }
              ],
              "apex_config": {
                "tooltip": {
                  "enabled": false
                },
                "legend": {
                  "show": true,
                  "position": "bottom"
                },
                "dataLabels": {
                  "enabled": true,
                  "formatter": "EVAL:function (val, opts) {\n  var p = opts.w.globals.seriesPercent[opts.seriesIndex][0];\n  return Math.round(p) + '%';\n}\n"
                },
                "plotOptions": {
                  "pie": {
                    "donut": {
                      "size": "68%",
                      "labels": {
                        "show": true,
                        "name": {
                          "show": true
                        },
                        "value": {
                          "show": true,
                          "formatter": "EVAL:function(){ return ''; }\n"
                        },
                        "total": {
                          "show": true,
                          "showAlways": true,
                          "label": "Batterie",
                          "formatter": "EVAL:function () {\n  var id = 'sensor.system_sanguinet_etat_de_charge_du_sb';\n  var h  = window.hass;\n  if (!h || !h.states || !h.states[id]) { return '‚Äî %'; }\n  var v = parseFloat(h.states[id].state);\n  if (isNaN(v)) { return '‚Äî %'; }\n  return Math.round(v) + ' %';\n}\n"
                        }
                      }
                    }
                  }
                },
                "stroke": {
                  "width": 2,
                  "colors": [
                    "#ffffff"
                  ]
                }
              }
            }
          ]
        },
        {
          "type": "sections",
          "max_columns": 1,
          "title": "Solaire",
          "path": "solaire-2",
          "icon": "mdi:solar-power",
          "visible": [
            {
              "user": "65f9557d9a4e4b3ca7469ddd356031a8"
            }
          ],
          "sections": [
            {
              "type": "grid",
              "cards": [
                {
                  "type": "heading",
                  "heading": "SolarSystem"
                },
                {
                  "type": "tile",
                  "entity": "sensor.system_sanguinet_alimentation_de_la_batterie_sb"
                },
                {
                  "type": "tile",
                  "entity": "sensor.system_sanguinet_alimentation_domestique_sb"
                },
                {
                  "type": "tile",
                  "entity": "sensor.system_sanguinet_demande_domestique"
                },
                {
                  "type": "tile",
                  "entity": "sensor.system_sanguinet_economies_de_co2"
                },
                {
                  "type": "tile",
                  "entity": "sensor.system_sanguinet_energie_solaire_sb"
                },
                {
                  "type": "tile",
                  "entity": "sensor.system_sanguinet_etat_de_charge_du_sb"
                },
                {
                  "type": "tile",
                  "entity": "sensor.system_sanguinet_mode_d_utilisation_actif"
                },
                {
                  "type": "tile",
                  "entity": "sensor.system_sanguinet_reglage_puissance_de_sortie_du_systeme"
                },
                {
                  "type": "tile",
                  "entity": "sensor.system_sanguinet_rendement_total"
                },
                {
                  "type": "tile",
                  "entity": "sensor.system_sanguinet_temps_de_donnees_sb"
                }
              ]
            },
            {
              "type": "grid",
              "cards": [
                {
                  "type": "heading",
                  "heading": "sb3"
                },
                {
                  "type": "tile",
                  "entity": "sensor.solarbank_3_e2700_pro_ac_puissance_de_la_prise"
                },
                {
                  "type": "tile",
                  "entity": "sensor.solarbank_3_e2700_pro_charge_du_reseau"
                },
                {
                  "type": "tile",
                  "entity": "sensor.solarbank_3_e2700_pro_ac_puissance_domestique"
                },
                {
                  "type": "tile",
                  "entity": "sensor.solarbank_3_e2700_pro_energie_de_la_batterie"
                },
                {
                  "type": "tile",
                  "entity": "sensor.solarbank_3_e2700_pro_mode"
                },
                {
                  "type": "tile",
                  "entity": "sensor.solarbank_3_e2700_pro_puissance_de_charge"
                },
                {
                  "type": "tile",
                  "entity": "sensor.solarbank_3_e2700_pro_puissance_de_chauffage"
                },
                {
                  "type": "tile",
                  "entity": "sensor.solarbank_3_e2700_pro_puissance_de_sortie"
                },
                {
                  "type": "tile",
                  "entity": "sensor.solarbank_3_e2700_pro_puissance_solaire"
                },
                {
                  "type": "tile",
                  "entity": "sensor.solarbank_3_e2700_pro_reglage_puissance_de_sortie"
                },
                {
                  "type": "tile",
                  "entity": "sensor.solarbank_3_e2700_pro_solaire_pv1"
                },
                {
                  "type": "tile",
                  "entity": "sensor.solarbank_3_e2700_pro_solaire_pv2"
                },
                {
                  "type": "tile",
                  "entity": "sensor.solarbank_3_e2700_pro_solaire_pv3"
                },
                {
                  "type": "tile",
                  "entity": "sensor.solarbank_3_e2700_pro_solaire_pv4"
                }
              ]
            },
            {
              "type": "grid",
              "cards": [
                {
                  "type": "heading",
                  "heading": "SmartMeter"
                },
                {
                  "type": "tile",
                  "entity": "sensor.smart_meter_grid_export"
                },
                {
                  "type": "tile",
                  "entity": "sensor.smart_meter_grid_import"
                }
              ]
            },
            {
              "type": "grid",
              "cards": [
                {
                  "type": "heading",
                  "heading": "SolarAPS"
                },
                {
                  "type": "tile",
                  "entity": "sensor.solar_lifetime_production_of_p1"
                },
                {
                  "type": "tile",
                  "entity": "sensor.solar_lifetime_production_of_p2"
                },
                {
                  "type": "tile",
                  "entity": "sensor.solar_power_of_p1"
                },
                {
                  "type": "tile",
                  "entity": "sensor.solar_power_of_p2"
                },
                {
                  "type": "tile",
                  "entity": "sensor.solar_production_of_today"
                },
                {
                  "type": "tile",
                  "entity": "sensor.solar_production_of_today_from_p1"
                },
                {
                  "type": "tile",
                  "entity": "sensor.solar_production_of_today_from_p2"
                },
                {
                  "type": "tile",
                  "entity": "sensor.solar_total_lifetime_production"
                },
                {
                  "type": "tile",
                  "entity": "sensor.solar_total_power"
                }
              ]
            }
          ],
          "cards": [
            {
              "type": "custom:apexcharts-card",
              "chart_type": "pie",
              "header": {
                "title": "√ânergie d‚Äôaujourd‚Äôhui",
                "show": true,
                "show_states": false
              },
              "series": [
                {
                  "entity": "sensor.energie_autoconsommee_2",
                  "name": "Solaire",
                  "color": "#ffd700"
                },
                {
                  "entity": "sensor.import_edf_quotidien",
                  "name": "EDF",
                  "color": "#0074D9"
                },
                {
                  "entity": "sensor.export_daily_2",
                  "name": "Surplus"
                }
              ],
              "apex_config": {
                "legend": {
                  "show": true,
                  "position": "bottom"
                },
                "plotOptions": {
                  "pie": {
                    "dataLabels": {
                      "enabled": false
                    }
                  }
                },
                "tooltip": {
                  "enabled": false
                }
              }
            },
            {
              "type": "custom:mushroom-template-card",
              "entity": "sensor.cumulus_pv_garde_bloquante",
              "primary": "Garde bloquante",
              "multiline_secondary": true,
              "secondary": "{% set L = state_attr('sensor.cumulus_pv_garde_bloquante','raisons_list') or [] %}\n{% set nb = state_attr('sensor.cumulus_pv_garde_bloquante','nb_raisons')|int(0) %}\n{% if nb == 0 %}\nAucune garde active\n{% else %}\n{{ nb }} raison{{ 's' if nb>1 else '' }} :\n{% for r in L %}\n‚Ä¢ {{ r }}\n{% endfor %}\n{% endif %}\n",
              "icon": "{% set L = state_attr('sensor.cumulus_pv_garde_bloquante','raisons_list') or [] %} {% set S = (' | '.join(L)) if L else '' %} {% if L|length == 0 %}\n  mdi:shield-check\n{% elif 'Interdit' in S or 'Verrou jour' in S %}\n  mdi:lock-alert\n{% elif 'Verrou PV' in S %}\n  mdi:lock\n{% elif 'SOC < seuil' in S %}\n  mdi:battery-alert\n{% elif 'Hors fen√™tre PV' in S %}\n  mdi:weather-sunny-off\n{% elif 'Pr√©vision Solcast insuffisante' in S %}\n  mdi:weather-sunny-alert\n{% elif 'Jour non autoris√©' in S %}\n  mdi:calendar-remove\n{% else %}\n  mdi:alert-circle\n{% endif %}\n",
              "icon_color": "{% set L = state_attr('sensor.cumulus_pv_garde_bloquante','raisons_list') or [] %} {% set S = (' | '.join(L)) if L else '' %} {% if L|length == 0 %}\n  green\n{% elif 'Hors fen√™tre PV' in S or 'Pr√©vision Solcast insuffisante' in S %}\n  amber\n{% elif 'Verrou PV' in S %}\n  blue\n{% else %}\n  red\n{% endif %}\n",
              "card_mod": {
                "style": "ha-card { border-left: 4px solid var(--primary-color); padding: 8px 12px; }\n"
              }
            }
          ]
        },
        {
          "title": "Maison ‚Äì Synth√®se",
          "icon": "mdi:home-lightning-bolt",
          "path": "maison-synthese",
          "visible": [
            {
              "user": "65f9557d9a4e4b3ca7469ddd356031a8"
            }
          ],
          "type": "custom:masonry-layout",
          "badges": [
            {
              "type": "entity",
              "entity": "switch.ordi_moniteur",
              "name": "Hi-fi & √©cran",
              "icon": "mdi:monitor-speaker",
              "show_state": false,
              "tap_action": {
                "action": "toggle"
              }
            },
            {
              "type": "entity",
              "entity": "switch.0x08ddebfffed9ed45",
              "name": "Atelier",
              "icon": "mdi:lightbulb",
              "show_state": false,
              "tap_action": {
                "action": "toggle"
              }
            },
            {
              "type": "entity",
              "entity": "switch.shellypro1_ece334ee1b64",
              "name": "Cumulus",
              "icon": "mdi:water-boiler",
              "show_state": false,
              "tap_action": {
                "action": "toggle"
              }
            }
          ],
          "cards": [
            {
              "type": "custom:mushroom-chips-card",
              "alignment": "justify",
              "chips": [
                {
                  "type": "entity",
                  "entity": "switch.ordi_moniteur",
                  "icon": "mdi:monitor-speaker",
                  "tap_action": {
                    "action": "toggle"
                  }
                },
                {
                  "type": "entity",
                  "entity": "switch.0x08ddebfffed9ed45",
                  "icon": "mdi:lightbulb",
                  "tap_action": {
                    "action": "toggle"
                  }
                },
                {
                  "type": "entity",
                  "entity": "switch.shellypro1_ece334ee1b64",
                  "icon": "mdi:water-boiler",
                  "tap_action": {
                    "action": "toggle"
                  }
                },
                {
                  "type": "template",
                  "entity": "binary_sensor.cumulus_en_fenetre_pv",
                  "icon": "mdi:weather-sunny",
                  "content": "{% if is_state(entity,'on') %}Fen√™tre PV{% else %}Hors PV{% endif %}\n",
                  "icon_color": "{% if is_state(entity,'on') %}amber{% else %}disabled{% endif %}\n"
                },
                {
                  "type": "template",
                  "entity": "binary_sensor.cumulus_en_heures_creuses",
                  "icon": "mdi:clock-time-three",
                  "content": "{% if is_state(entity,'on') %}Heures creuses{% else %}Heures pleines{% endif %}\n",
                  "icon_color": "{% if is_state(entity,'on') %}blue{% else %}disabled{% endif %}\n"
                },
                {
                  "type": "template",
                  "entity": "input_boolean.cumulus_vacances",
                  "icon": "mdi:beach",
                  "content": "{% if is_state(entity,'on') %}Vacances{% else %}Normal{% endif %}\n",
                  "icon_color": "{% if is_state(entity,'on') %}teal{% else %}disabled{% endif %}\n",
                  "tap_action": {
                    "action": "toggle"
                  }
                }
              ]
            },
            {
              "type": "custom:vertical-stack-in-card",
              "cards": [
                {
                  "type": "custom:mushroom-title-card",
                  "title": "R√©sum√© √©nergie"
                },
                {
                  "type": "grid",
                  "square": false,
                  "columns": 4,
                  "cards": [
                    {
                      "type": "gauge",
                      "entity": "sensor.solarbank_3_e2700_pro_etat_de_charge",
                      "name": "Batterie",
                      "min": 0,
                      "max": 100,
                      "unit": "%",
                      "severity": {
                        "green": 50,
                        "yellow": 20,
                        "red": 0
                      }
                    },
                    {
                      "type": "custom:apexcharts-card",
                      "chart_type": "pie",
                      "header": {
                        "title": "√ânergie d‚Äôaujourd‚Äôhui",
                        "show": true
                      },
                      "series": [
                        {
                          "entity": "sensor.energie_autoconsommee_2",
                          "name": "Solaire",
                          "color": "#ffd700"
                        },
                        {
                          "entity": "sensor.import_edf_quotidien",
                          "name": "EDF",
                          "color": "#0074D9"
                        },
                        {
                          "entity": "sensor.export_daily_2",
                          "name": "Surplus"
                        }
                      ],
                      "apex_config": {
                        "legend": {
                          "show": true,
                          "position": "bottom"
                        },
                        "plotOptions": {
                          "pie": {
                            "dataLabels": {
                              "enabled": false
                            }
                          }
                        },
                        "tooltip": {
                          "enabled": false
                        }
                      }
                    },
                    {
                      "type": "custom:button-card",
                      "name": "Aujourd‚Äôhui",
                      "icon": "mdi:calendar-today",
                      "show_icon": false,
                      "show_state": true,
                      "entity": "sensor.savings_day_eur",
                      "state_display": "[[[\n  const v = Number(entity?.state);\n  return isNaN(v) ? '‚Äî' :\n    v.toLocaleString('fr-FR',{minimumFractionDigits:2, maximumFractionDigits:2}) + ' ‚Ç¨';\n]]]\n",
                      "styles": {
                        "card": [
                          {
                            "width": "100px"
                          },
                          {
                            "height": "100px"
                          },
                          {
                            "border-radius": "50%"
                          },
                          {
                            "background": "rgba(33,150,243,0.85)"
                          },
                          {
                            "box-shadow": "0 4px 10px rgba(0,0,0,0.4)"
                          }
                        ],
                        "state": [
                          {
                            "color": "white"
                          },
                          {
                            "font-size": "16px"
                          },
                          {
                            "font-weight": "bold"
                          }
                        ],
                        "name": [
                          {
                            "color": "white"
                          },
                          {
                            "font-size": "14px"
                          },
                          {
                            "margin-bottom": "6px"
                          }
                        ]
                      }
                    },
                    {
                      "type": "custom:button-card",
                      "name": "Mensuel",
                      "icon": "mdi:calendar-month",
                      "show_icon": false,
                      "show_state": true,
                      "state_display": "[[[\n  const e = states['sensor.savings_month_eur'];\n  if(!e || e.state === undefined) return '‚Äî';\n  const v = Number(e.state);\n  return isNaN(v) ? '‚Äî' :\n    v.toLocaleString('fr-FR',{minimumFractionDigits:2, maximumFractionDigits:2}) + ' ‚Ç¨';\n]]]\n",
                      "styles": {
                        "card": [
                          {
                            "width": "100px"
                          },
                          {
                            "height": "100px"
                          },
                          {
                            "border-radius": "50%"
                          },
                          {
                            "background": "rgba(76,175,80,0.85)"
                          },
                          {
                            "box-shadow": "0 4px 10px rgba(0,0,0,0.4)"
                          }
                        ],
                        "state": [
                          {
                            "color": "white"
                          },
                          {
                            "font-size": "16px"
                          },
                          {
                            "font-weight": "bold"
                          }
                        ],
                        "name": [
                          {
                            "color": "white"
                          },
                          {
                            "font-size": "14px"
                          },
                          {
                            "margin-bottom": "6px"
                          }
                        ]
                      }
                    }
                  ]
                },
                {
                  "type": "grid",
                  "square": false,
                  "columns": 4,
                  "cards": [
                    {
                      "type": "custom:button-card",
                      "name": "Annuel",
                      "icon": "mdi:chart-box-outline",
                      "show_icon": false,
                      "show_state": true,
                      "state_display": "[[[\n  const e = states['sensor.savings_year_eur_with_baseline'] || states['sensor.savings_year_eur'];\n  if(!e || e.state === undefined) return '‚Äî';\n  const v = Number(e.state);\n  return isNaN(v) ? '‚Äî' :\n    v.toLocaleString('fr-FR',{minimumFractionDigits:2, maximumFractionDigits:2}) + ' ‚Ç¨';\n]]]\n",
                      "styles": {
                        "card": [
                          {
                            "width": "100px"
                          },
                          {
                            "height": "100px"
                          },
                          {
                            "border-radius": "50%"
                          },
                          {
                            "background": "rgba(255,165,40,0.85)"
                          },
                          {
                            "box-shadow": "0 4px 10px rgba(0,0,0,0.4)"
                          }
                        ],
                        "state": [
                          {
                            "color": "white"
                          },
                          {
                            "font-size": "14px"
                          },
                          {
                            "font-weight": "bold"
                          }
                        ],
                        "name": [
                          {
                            "color": "white"
                          },
                          {
                            "font-size": "14px"
                          }
                        ]
                      }
                    },
                    {
                      "type": "custom:button-card",
                      "name": "Total",
                      "icon": "mdi:chart-box-outline",
                      "show_icon": false,
                      "show_state": true,
                      "entity": "sensor.savings_total_eur_with_baseline",
                      "state_display": "[[[\n  const v = Number(entity?.state);\n  return isNaN(v) ? '‚Äî' :\n    v.toLocaleString('fr-FR',{minimumFractionDigits:2, maximumFractionDigits:2}) + ' ‚Ç¨';\n]]]\n",
                      "styles": {
                        "card": [
                          {
                            "width": "100px"
                          },
                          {
                            "height": "100px"
                          },
                          {
                            "border-radius": "50%"
                          },
                          {
                            "background": "rgba(244,67,54,0.85)"
                          },
                          {
                            "box-shadow": "0 4px 10px rgba(0,0,0,0.4)"
                          }
                        ],
                        "state": [
                          {
                            "color": "white"
                          },
                          {
                            "font-size": "14px"
                          },
                          {
                            "font-weight": "bold"
                          }
                        ],
                        "name": [
                          {
                            "color": "white"
                          },
                          {
                            "font-size": "14px"
                          }
                        ]
                      }
                    }
                  ]
                }
              ]
            },
            {
              "type": "custom:apexcharts-card",
              "graph_span": "6h",
              "show": {
                "loading": false
              },
              "header": {
                "show": true,
                "title": "Import / Export / PV & Seuils"
              },
              "apex_config": {
                "legend": {
                  "show": true
                },
                "stroke": {
                  "width": 2
                }
              },
              "series": [
                {
                  "entity": "sensor.cumulus_import_reseau_w",
                  "name": "Import",
                  "type": "line",
                  "group_by": {
                    "duration": "1min",
                    "func": "avg"
                  }
                },
                {
                  "entity": "sensor.cumulus_export_reseau_w",
                  "name": "Export",
                  "type": "line",
                  "group_by": {
                    "duration": "1min",
                    "func": "avg"
                  }
                },
                {
                  "entity": "sensor.cumulus_prod_pv_w",
                  "name": "PV",
                  "type": "area",
                  "group_by": {
                    "duration": "1min",
                    "func": "avg"
                  }
                },
                {
                  "entity": "sensor.cumulus_import_max_acceptable_w",
                  "name": "Seuil import dyn.",
                  "type": "line",
                  "stroke_width": 1,
                  "curve": "stepline"
                },
                {
                  "entity": "sensor.cumulus_seuil_demarrage_pv_w",
                  "name": "Seuil ON PV",
                  "type": "line",
                  "stroke_width": 1,
                  "curve": "stepline"
                },
                {
                  "entity": "sensor.cumulus_seuil_arret_pv_w",
                  "name": "Seuil OFF PV",
                  "type": "line",
                  "stroke_width": 1,
                  "curve": "stepline"
                }
              ]
            },
            {
              "type": "custom:vertical-stack-in-card",
              "cards": [
                {
                  "type": "custom:mushroom-title-card",
                  "title": "Pilotage Cumulus"
                },
                {
                  "type": "grid",
                  "square": false,
                  "columns": 2,
                  "cards": [
                    {
                      "type": "custom:mushroom-entity-card",
                      "entity": "switch.shellypro1_ece334ee1b64",
                      "name": "Contacteur",
                      "icon": "mdi:water-boiler",
                      "tap_action": {
                        "action": "toggle"
                      }
                    },
                    {
                      "type": "custom:mushroom-entity-card",
                      "entity": "input_boolean.cumulus_jour_autorise",
                      "name": "Jour autoris√©",
                      "icon": "mdi:calendar",
                      "tap_action": {
                        "action": "toggle"
                      }
                    },
                    {
                      "type": "custom:mushroom-entity-card",
                      "entity": "input_boolean.cumulus_verrou_jour",
                      "name": "Verrou jour",
                      "icon": "mdi:lock-clock",
                      "tap_action": {
                        "action": "toggle"
                      }
                    },
                    {
                      "type": "custom:mushroom-entity-card",
                      "entity": "input_boolean.cumulus_verrou_pv",
                      "name": "Verrou PV",
                      "icon": "mdi:lock",
                      "tap_action": {
                        "action": "toggle"
                      }
                    },
                    {
                      "type": "custom:mushroom-entity-card",
                      "entity": "input_boolean.cumulus_vacances",
                      "name": "Vacances",
                      "icon": "mdi:beach",
                      "tap_action": {
                        "action": "toggle"
                      }
                    }
                  ]
                },
                {
                  "type": "grid",
                  "square": false,
                  "columns": 3,
                  "cards": [
                    {
                      "type": "custom:mushroom-template-card",
                      "entity": "binary_sensor.cumulus_en_fenetre_pv",
                      "primary": "En fen√™tre PV",
                      "secondary": "{{ 'En cours' if is_state(entity,'on') else '√Ä l‚Äôarr√™t' }}\n",
                      "icon": "mdi:weather-sunny",
                      "icon_color": "{{ 'amber' if is_state(entity,'on') else 'grey' }}\n"
                    },
                    {
                      "type": "custom:mushroom-template-card",
                      "entity": "binary_sensor.cumulus_en_heures_creuses",
                      "primary": "Heures creuses",
                      "secondary": "{{ 'En cours' if is_state(entity,'on') else 'Hors HC' }}\n",
                      "icon": "mdi:clock-time-three",
                      "icon_color": "{{ 'blue' if is_state(entity,'on') else 'grey' }}\n"
                    },
                    {
                      "type": "custom:mushroom-template-card",
                      "entity": "binary_sensor.cumulus_pv_ok_statique",
                      "primary": "PV OK (gardes)",
                      "secondary": "{{ 'Actif' if is_state(entity,'on') else 'D√©sactiv√©' }}",
                      "icon": "mdi:shield-check",
                      "icon_color": "{{ 'green' if is_state(entity,'on') else 'red' }}\n"
                    },
                    {
                      "type": "custom:mushroom-template-card",
                      "entity": "input_boolean.cumulus_suspendu_conso",
                      "primary": "D√©lestage",
                      "secondary": "{{ 'Suspendu' if is_state(entity,'on') else 'Normal' }}",
                      "icon": "mdi:flash-alert",
                      "icon_color": "{{ 'red' if is_state(entity,'on') else 'green' }}\n"
                    },
                    {
                      "type": "custom:mushroom-template-card",
                      "entity": "binary_sensor.cumulus_deadband_actif",
                      "primary": "Deadband",
                      "secondary": "{{ 'Actif' if is_state(entity,'on') else 'off' }}",
                      "icon": "mdi:timer-sand",
                      "icon_color": "{{ 'amber' if is_state(entity,'on') else 'grey' }}\n"
                    },
                    {
                      "type": "custom:mushroom-template-card",
                      "entity": "binary_sensor.cumulus_chauffe_reelle",
                      "primary": "Cumulus chauffe",
                      "secondary": "{{ 'En chauffe' if is_state(entity,'on') else '√Ä l‚Äôarr√™t' }}",
                      "icon": "mdi:water-boiler",
                      "icon_color": "{{ 'deep-orange' if is_state(entity,'on') else 'grey' }}\n"
                    }
                  ]
                },
                {
                  "type": "custom:mushroom-title-card",
                  "title": "R√©glages rapides"
                },
                {
                  "type": "grid",
                  "columns": 3,
                  "square": false,
                  "cards": [
                    {
                      "type": "custom:mushroom-number-card",
                      "entity": "input_number.cumulus_allowed_import_pv_w",
                      "name": "Import PV autoris√©",
                      "display_mode": "slider"
                    },
                    {
                      "type": "custom:mushroom-number-card",
                      "entity": "input_number.cumulus_talon_reseau_w",
                      "name": "Talon r√©seau",
                      "display_mode": "slider"
                    },
                    {
                      "type": "custom:mushroom-number-card",
                      "entity": "input_number.cumulus_pv_hysteresis_w",
                      "name": "Hyst√©r√©sis PV",
                      "display_mode": "slider"
                    },
                    {
                      "type": "custom:mushroom-number-card",
                      "entity": "input_number.cumulus_on_delay_s",
                      "name": "Temporisation ON",
                      "display_mode": "slider"
                    },
                    {
                      "type": "custom:mushroom-number-card",
                      "entity": "input_number.cumulus_off_delay_s",
                      "name": "Temporisation OFF",
                      "display_mode": "slider"
                    },
                    {
                      "type": "custom:mushroom-number-card",
                      "entity": "input_number.cumulus_soc_start_pct",
                      "name": "SOC mini PV",
                      "display_mode": "slider"
                    }
                  ]
                },
                {
                  "type": "custom:mushroom-title-card",
                  "title": "Mesures instantan√©es"
                },
                {
                  "type": "grid",
                  "columns": 3,
                  "square": false,
                  "cards": [
                    {
                      "type": "custom:mushroom-template-card",
                      "entity": "sensor.cumulus_import_reseau_w",
                      "primary": "Import",
                      "secondary": "{{ states(entity)|int(0) }} W",
                      "icon": "mdi:transmission-tower-import",
                      "icon_color": "{% set v = states(entity)|float(0) %} {% if v < 100 %}green{% elif v < 500 %}lime{% elif v < 1000 %}amber{% else %}red{% endif %}\n"
                    },
                    {
                      "type": "custom:mushroom-template-card",
                      "entity": "sensor.cumulus_export_reseau_w",
                      "primary": "Export",
                      "secondary": "{{ states(entity)|int(0) }} W",
                      "icon": "mdi:transmission-tower-export",
                      "icon_color": "{% if states(entity)|float(0) > 0 %}blue{% else %}disabled{% endif %}\n"
                    },
                    {
                      "type": "custom:mushroom-template-card",
                      "entity": "sensor.cumulus_prod_pv_w",
                      "primary": "PV",
                      "secondary": "{{ states(entity)|int(0) }} W",
                      "icon": "mdi:solar-power",
                      "icon_color": "{% if states(entity)|float(0) > 0 %}yellow{% else %}disabled{% endif %}\n"
                    },
                    {
                      "type": "custom:mushroom-template-card",
                      "entity": "sensor.cumulus_soc_batt_pct",
                      "primary": "SOC",
                      "secondary": "{{ states(entity)|round(0) }} %",
                      "icon": "mdi:battery",
                      "icon_color": "{% set v = states(entity)|float(0) %} {% if v >= 50 %}green{% elif v >= 25 %}amber{% else %}red{% endif %}\n"
                    },
                    {
                      "type": "custom:mushroom-template-card",
                      "entity": "sensor.cumulus_seuil_demarrage_pv_w",
                      "primary": "Seuil ON PV",
                      "secondary": "{{ states(entity)|int(0) }} W",
                      "icon": "mdi:flash",
                      "icon_color": "teal"
                    },
                    {
                      "type": "custom:mushroom-template-card",
                      "entity": "sensor.cumulus_seuil_arret_pv_w",
                      "primary": "Seuil OFF PV",
                      "secondary": "{{ states(entity)|int(0) }} W",
                      "icon": "mdi:flash-off",
                      "icon_color": "grey"
                    },
                    {
                      "type": "custom:mushroom-template-card",
                      "entity": "sensor.cumulus_import_max_acceptable_w",
                      "primary": "Seuil import dyn.",
                      "secondary": "{{ states(entity)|int(0) }} W",
                      "icon": "mdi:chart-bell-curve-cumulative",
                      "icon_color": "cyan"
                    }
                  ]
                },
                {
                  "type": "custom:apexcharts-card",
                  "graph_span": "3h",
                  "header": {
                    "show": true,
                    "title": "Pente dP/dt & D√©tection appareil"
                  },
                  "yaxis": [
                    {
                      "id": "y1",
                      "min": -800,
                      "max": 800,
                      "decimals": 0,
                      "apex_config": {
                        "title": {
                          "text": "W/s"
                        }
                      }
                    }
                  ],
                  "series": [
                    {
                      "entity": "sensor.cumulus_grid_dpdt",
                      "name": "dP/dt",
                      "yaxis_id": "y1",
                      "type": "column",
                      "opacity": 0.6,
                      "group_by": {
                        "duration": "30s",
                        "func": "avg"
                      }
                    },
                    {
                      "entity": "binary_sensor.cumulus_appareil_demarre",
                      "name": "Appareil d√©marr√©",
                      "transform": "return x === 'on' ? 600 : 0",
                      "yaxis_id": "y1",
                      "type": "area",
                      "opacity": 0.2
                    }
                  ]
                }
              ]
            },
            {
              "type": "custom:vertical-stack-in-card",
              "cards": [
                {
                  "type": "custom:mushroom-title-card",
                  "title": "Personnes & appareils"
                },
                {
                  "type": "grid",
                  "square": false,
                  "columns": 4,
                  "cards": [
                    {
                      "type": "custom:mushroom-person-card",
                      "entity": "person.laurent",
                      "layout": "vertical",
                      "primary_info": "none",
                      "secondary_info": "state",
                      "icon_type": "entity-picture"
                    },
                    {
                      "type": "button",
                      "entity": "switch.chargeur_laurent",
                      "name": "Chargeur",
                      "icon": "mdi:power-plug",
                      "tap_action": {
                        "action": "toggle"
                      },
                      "icon_height": "24px",
                      "card_mod": {
                        "style": "ha-card { font-size: 12px !important; }"
                      }
                    },
                    {
                      "type": "gauge",
                      "entity": "sensor.iphone_laurent_battery_level",
                      "name": "iPhone 16 Pro",
                      "severity": {
                        "green": 50,
                        "yellow": 20,
                        "red": 0
                      }
                    },
                    {
                      "type": "gauge",
                      "entity": "sensor.ipad_pro_battery_level",
                      "name": "iPad Pro",
                      "severity": {
                        "green": 50,
                        "yellow": 20,
                        "red": 0
                      }
                    }
                  ]
                },
                {
                  "type": "grid",
                  "square": false,
                  "columns": 4,
                  "cards": [
                    {
                      "type": "custom:mushroom-person-card",
                      "entity": "person.isabelle",
                      "layout": "vertical",
                      "primary_info": "none",
                      "secondary_info": "state",
                      "icon_type": "entity-picture"
                    },
                    {
                      "type": "button",
                      "entity": "switch.chargeur_isa",
                      "name": "Chargeur",
                      "icon": "mdi:power-plug",
                      "tap_action": {
                        "action": "toggle"
                      },
                      "icon_height": "24px",
                      "card_mod": {
                        "style": "ha-card { font-size: 12px !important; }"
                      }
                    },
                    {
                      "type": "gauge",
                      "entity": "sensor.iphone_isa_battery_level",
                      "name": "iPhone",
                      "severity": {
                        "green": 50,
                        "yellow": 20,
                        "red": 0
                      }
                    },
                    {
                      "type": "gauge",
                      "entity": "sensor.ipad_de_isabelle_battery_level",
                      "name": "iPad Air",
                      "severity": {
                        "green": 50,
                        "yellow": 20,
                        "red": 0
                      }
                    }
                  ]
                }
              ]
            },
            {
              "type": "entities",
              "title": "Volets",
              "state_color": true,
              "entities": [
                "cover.vr_ch_parents",
                "cover.vr_salon"
              ]
            },
            {
              "type": "custom:vertical-stack-in-card",
              "cards": [
                {
                  "type": "custom:mushroom-title-card",
                  "title": "Imprimante Epson"
                },
                {
                  "type": "custom:button-card",
                  "variables": {
                    "printer_state": "switch.imprimante_epson",
                    "c_state": "sensor.epson_et_2870_cyan_ink_cached",
                    "y_state": "sensor.epson_et_2870_yellow_ink_cached",
                    "m_state": "sensor.epson_et_2870_magenta_ink_cached",
                    "b_state": "sensor.epson_et_2870_black_ink_cached"
                  },
                  "triggers_update": [
                    "switch.imprimante_epson",
                    "sensor.epson_et_2870_black_ink_cached",
                    "sensor.epson_et_2870_cyan_ink_cached",
                    "sensor.epson_et_2870_magenta_ink_cached",
                    "sensor.epson_et_2870_yellow_ink_cached"
                  ],
                  "show_name": false,
                  "show_state": false,
                  "show_icon": false,
                  "styles": {
                    "card": [
                      {
                        "padding": "3px"
                      }
                    ],
                    "grid": [
                      {
                        "grid-template-areas": "\"haut bas\""
                      },
                      {
                        "grid-template-columns": "4fr 5fr"
                      },
                      {
                        "grid-template-rows": "100%"
                      }
                    ],
                    "custom_fields": {
                      "haut": [
                        {
                          "filter": "opacity(100%)"
                        },
                        {
                          "overflow": "visible"
                        }
                      ],
                      "bas": [
                        {
                          "filter": "opacity(100%)"
                        },
                        {
                          "overflow": "visible"
                        }
                      ]
                    }
                  },
                  "custom_fields": {
                    "haut": {
                      "card": {
                        "type": "custom:mushroom-entity-card",
                        "entity": "[[[ return variables.printer_state ]]]",
                        "tap_action": {
                          "action": "toggle"
                        },
                        "icon": "mdi:printer",
                        "card_mod": {
                          "style": "ha-card {\n  padding: 0px !important;\n  padding-bottom: 1px !important;\n  text-align: left !important;\n  border: none !important;\n  box-shadow: none !important;\n}\n"
                        }
                      }
                    },
                    "bas": {
                      "card": {
                        "type": "grid",
                        "columns": 4,
                        "square": false,
                        "cards": [
                          {
                            "type": "custom:button-card",
                            "entity": "[[[ return variables.b_state ]]]",
                            "size": "100%",
                            "styles": {
                              "grid": [
                                {
                                  "grid-template-areas": "\"s\""
                                },
                                {
                                  "grid-template-columns": "100%"
                                },
                                {
                                  "grid-template-rows": "100%"
                                }
                              ],
                              "state": [
                                {
                                  "font-size": "1rem"
                                },
                                {
                                  "font-weight": "bold"
                                },
                                {
                                  "color": "var(--primary-text-color)"
                                }
                              ],
                              "card": [
                                {
                                  "background": "[[[ return `linear-gradient(to top, rgba(150,150,150,0.2) 0%, rgba(150,150,150,0.2) ${states[variables.b_state].state}%, rgba(150,150,150,0.1) ${states[variables.b_state].state}%, rgba(150,150,150,0.1) 100%)`; ]]]\n"
                                },
                                {
                                  "height": "3rem"
                                }
                              ]
                            },
                            "show_name": false,
                            "show_state": true,
                            "show_label": false,
                            "state_display": "[[[\n  const v = Math.round(Number(states[variables.b_state].state)||0);\n  const u = states[variables.b_state].attributes.unit_of_measurement || '%';\n  return `${v}${u}`;\n]]]\n",
                            "card_mod": {
                              "style": "ha-card { padding: 1px !important; margin: 0; border: none; box-shadow: none; }"
                            }
                          },
                          {
                            "type": "custom:button-card",
                            "entity": "[[[ return variables.c_state ]]]",
                            "size": "100%",
                            "styles": {
                              "grid": [
                                {
                                  "grid-template-areas": "\"s\""
                                },
                                {
                                  "grid-template-columns": "100%"
                                },
                                {
                                  "grid-template-rows": "100%"
                                }
                              ],
                              "state": [
                                {
                                  "font-size": "1rem"
                                },
                                {
                                  "font-weight": "bold"
                                },
                                {
                                  "color": "darkcyan"
                                }
                              ],
                              "card": [
                                {
                                  "background": "[[[ return `linear-gradient(to top, rgba(0,139,139,0.2) 0%, rgba(0,139,139,0.2) ${states[variables.c_state].state}%, rgba(0,139,139,0.1) ${states[variables.c_state].state}%, rgba(0,139,139,0.1) 100%)`; ]]]\n"
                                },
                                {
                                  "height": "3rem"
                                }
                              ]
                            },
                            "show_name": false,
                            "show_state": true,
                            "state_display": "[[[\n  const v = Math.round(Number(states[variables.c_state].state)||0);\n  const u = states[variables.c_state].attributes.unit_of_measurement || '%';\n  return `${v}${u}`;\n]]]\n",
                            "card_mod": {
                              "style": "ha-card { padding: 1px !important; margin: 0; border: none; box-shadow: none; }"
                            }
                          },
                          {
                            "type": "custom:button-card",
                            "entity": "[[[ return variables.m_state ]]]",
                            "size": "100%",
                            "styles": {
                              "grid": [
                                {
                                  "grid-template-areas": "\"s\""
                                },
                                {
                                  "grid-template-columns": "100%"
                                },
                                {
                                  "grid-template-rows": "100%"
                                }
                              ],
                              "state": [
                                {
                                  "font-size": "1rem"
                                },
                                {
                                  "font-weight": "bold"
                                },
                                {
                                  "color": "magenta"
                                }
                              ],
                              "card": [
                                {
                                  "background": "[[[ return `linear-gradient(to top, rgba(255,0,255,0.2) 0%, rgba(255,0,255,0.2) ${states[variables.m_state].state}%, rgba(255,0,255,0.1) ${states[variables.m_state].state}%, rgba(255,0,255,0.1) 100%)`; ]]]\n"
                                },
                                {
                                  "height": "3rem"
                                }
                              ]
                            },
                            "show_name": false,
                            "show_state": true,
                            "state_display": "[[[\n  const v = Math.round(Number(states[variables.m_state].state)||0);\n  const u = states[variables.m_state].attributes.unit_of_measurement || '%';\n  return `${v}${u}`;\n]]]\n",
                            "card_mod": {
                              "style": "ha-card { padding: 1px !important; margin: 0; border: none; box-shadow: none; }"
                            }
                          },
                          {
                            "type": "custom:button-card",
                            "entity": "[[[ return variables.y_state ]]]",
                            "size": "100%",
                            "styles": {
                              "grid": [
                                {
                                  "grid-template-areas": "\"s\""
                                },
                                {
                                  "grid-template-columns": "100%"
                                },
                                {
                                  "grid-template-rows": "100%"
                                }
                              ],
                              "state": [
                                {
                                  "font-size": "1rem"
                                },
                                {
                                  "font-weight": "bold"
                                },
                                {
                                  "color": "darkorange"
                                }
                              ],
                              "card": [
                                {
                                  "background": "[[[ return `linear-gradient(to top, rgba(255,140,0,0.2) 0%, rgba(255,140,0,0.2) ${states[variables.y_state].state}%, rgba(255,140,0,0.1) ${states[variables.y_state].state}%, rgba(255,140,0,0.1) 100%)`; ]]]\n"
                                },
                                {
                                  "height": "3rem"
                                }
                              ]
                            },
                            "show_name": false,
                            "show_state": true,
                            "state_display": "[[[\n  const v = Math.round(Number(states[variables.y_state].state)||0);\n  const u = states[variables.y_state].attributes.unit_of_measurement || '%';\n  return `${v}${u}`;\n]]]\n",
                            "card_mod": {
                              "style": "ha-card { padding: 1px !important; margin: 0; border: none; box-shadow: none; }"
                            }
                          }
                        ]
                      }
                    }
                  }
                }
              ]
            },
            {
              "type": "custom:mushroom-template-card",
              "entity": "sensor.cumulus_pv_garde_bloquante",
              "primary": "Garde bloquante",
              "multiline_secondary": true,
              "secondary": "{% set L = state_attr('sensor.cumulus_pv_garde_bloquante','raisons_list') or [] %} {% set nb = state_attr('sensor.cumulus_pv_garde_bloquante','nb_raisons')|int(0) %} {% if nb == 0 %}\n  Aucune garde active\n{% else %}\n  {{ nb }} raison{{ 's' if nb>1 else '' }} :\n  {% for r in L %}‚Ä¢ {{ r }}{% if not loop.last %}\\n{% endif %}{% endfor %}\n{% endif %}\n",
              "icon": "{% set L = state_attr('sensor.cumulus_pv_garde_bloquante','raisons_list') or [] %} {% set S = (' | '.join(L)) if L else '' %} {% if L|length == 0 %}mdi:shield-check {% elif 'Interdit' in S or 'Verrou jour' in S %}mdi:lock-alert {% elif 'Verrou PV' in S %}mdi:lock {% elif 'SOC < seuil' in S %}mdi:battery-alert {% elif 'Hors fen√™tre PV' in S %}mdi:weather-sunny-off {% elif 'Pr√©vision Solcast insuffisante' in S %}mdi:weather-sunny-alert {% elif 'Jour non autoris√©' in S %}mdi:calendar-remove {% else %}mdi:alert-circle {% endif %}\n",
              "icon_color": "{% set L = state_attr('sensor.cumulus_pv_garde_bloquante','raisons_list') or [] %} {% set S = (' | '.join(L)) if L else '' %} {% if L|length == 0 %}green {% elif 'Hors fen√™tre PV' in S or 'Pr√©vision Solcast insuffisante' in S %}amber {% elif 'Verrou PV' in S %}blue {% else %}red {% endif %}\n",
              "card_mod": {
                "style": "ha-card { border-left: 4px solid var(--primary-color); padding: 8px 12px; }"
              }
            },
            {
              "type": "custom:button-card",
              "entity": "sensor.solarbank_3_e2700_pro_etat_de_charge",
              "show_name": false,
              "show_state": false,
              "tap_action": {
                "action": "more-info"
              },
              "styles": {
                "card": [
                  {
                    "padding": "10px"
                  },
                  {
                    "border-radius": "18px"
                  },
                  {
                    "height": "140px"
                  },
                  {
                    "background": "linear-gradient(180deg,#111827,#0b1220)"
                  },
                  {
                    "border": "1px solid rgba(255,255,255,.06)"
                  },
                  {
                    "--ha-card-background": "#111827"
                  },
                  {
                    "--card-background-color": "#111827"
                  },
                  {
                    "--primary-text-color": "#e5e7eb"
                  },
                  {
                    "--disabled-color": "rgba(255,255,255,.18)"
                  }
                ],
                "grid": [
                  {
                    "grid-template-areas": "\"ring\""
                  },
                  {
                    "grid-template-columns": "1fr"
                  },
                  {
                    "grid-template-rows": "1fr"
                  }
                ],
                "custom_fields": {
                  "ring": [
                    {
                      "display": "grid"
                    },
                    {
                      "place-items": "center"
                    },
                    {
                      "width": "120px"
                    },
                    {
                      "height": "120px"
                    },
                    {
                      "margin": "0 auto"
                    },
                    {
                      "border-radius": "999px"
                    }
                  ]
                }
              },
              "custom_fields": {
                "ring": "[[[\n  const soc = Math.round(Number(states['sensor.solarbank_3_e2700_pro_etat_de_charge']?.state) || 0);\n  const p   = Number(states['sensor.solarbank_3_e2700_pro_puissance_de_charge']?.state) || 0;\n  const charging = p > 20, discharg = p < -20;\n  const color = charging\n    ? 'rgb(34,197,94)'    // vert vif\n    : (discharg ? 'rgb(239,68,68)' : 'rgba(255,255,255,.6)'); // neutre clair\n  const sign  = charging ? '+' : (discharg ? '‚àí' : '');\n  const watts = (charging || discharg) ? `${sign}${Math.round(Math.abs(p))} W` : '0 W';\n  const icon  = charging ? 'mdi:battery-charging' : (discharg ? 'mdi:battery-arrow-down' : 'mdi:battery');\n\n  return `\n    <div style=\"\n      position:relative; width:100%; height:100%; display:grid; place-items:center; border-radius:999px;\n      background:\n        radial-gradient(closest-side, var(--ha-card-background, var(--card-background-color)) 74%, transparent 75% 100%),\n        conic-gradient(${color} ${soc}%, var(--disabled-color) 0);\n    \">\n      <div style=\"display:grid; place-items:center; gap:2px; text-align:center;\">\n        <ha-icon icon=\"${icon}\" style=\"width:22px;height:22px;color:${color};\"></ha-icon>\n        <div style=\"font-weight:700; font-size:1.1rem; color:#e5e7eb;\">${soc}%</div>\n        <div style=\"font-size:.82rem; color:${color};\">${watts}</div>\n      </div>\n    </div>\n  `;\n]]]\n"
              }
            },
            {
              "type": "custom:button-card",
              "show_name": false,
              "show_state": false,
              "tap_action": {
                "action": "more-info"
              },
              "styles": {
                "card": [
                  {
                    "padding": "10px"
                  },
                  {
                    "border-radius": "18px"
                  },
                  {
                    "box-sizing": "border-box"
                  }
                ],
                "grid": [
                  {
                    "grid-template-areas": "\"title\" \"pie\" \"legend\""
                  },
                  {
                    "grid-template-rows": "auto auto auto"
                  },
                  {
                    "grid-template-columns": "1fr"
                  }
                ],
                "custom_fields": {
                  "title": [
                    {
                      "justify-self": "start"
                    },
                    {
                      "font-weight": 600
                    },
                    {
                      "font-size": "1.05rem"
                    },
                    {
                      "padding": "2px 4px 8px"
                    }
                  ],
                  "pie": [
                    {
                      "width": "220px"
                    },
                    {
                      "height": "220px"
                    },
                    {
                      "margin": "0 auto"
                    }
                  ],
                  "legend": [
                    {
                      "margin-top": "6px"
                    },
                    {
                      "font-size": ".95rem"
                    },
                    {
                      "display": "block"
                    }
                  ]
                }
              },
              "custom_fields": {
                "title": "√ânergie d‚Äôaujourd‚Äôhui",
                "pie": "[[[\n  // === Donn√©es ===\n  const idSolar   = 'sensor.energie_autoconsommee_2';\n  const idEDF     = 'sensor.import_edf_quotidien';\n  const idSurplus = 'sensor.export_daily_2';\n\n  const v = id => Number(states[id]?.state) || 0;\n  const solar = v(idSolar);\n  const edf   = v(idEDF);\n  const surp  = v(idSurplus);\n  const total = Math.max(solar + edf + surp, 0.0001);\n\n  // === Couleurs ===\n  const cSolar = '#ffd700';\n  const cEDF   = '#0074D9';\n  const cSurp  = '#ff4136';     // rouge lisible\n\n  // === G√©om√©trie ===\n  const size = 220, cx=110, cy=110, r=80, stroke=34;\n  const C = 2 * Math.PI * r;\n  const gap = 4; // s√©paration blanche entre parts (en px de p√©rim√®tre)\n\n  // helper pour formatages FR (8 / 0,8)\n  const fmt = (x) => (x >= 1 ? Math.round(x) : Math.round(x*10)/10)\n                      .toLocaleString('fr-FR');\n\n  // calcule longueur de part + offset cumulatif\n  const len = (val) => Math.max(C * (val/total) - gap, 0);\n\n  const Lsolar = len(solar);\n  const Ledf   = len(edf);\n  const Lsurp  = len(surp);\n\n  const offSolar = 0;\n  const offEDF   = offSolar + (C*(solar/total));\n  const offSurp  = offEDF   + (C*(edf/total));\n\n  // position de label au milieu de la part\n  const pos = (start, val) => {\n    const mid = (start + (C*(val/total))/2) / C * 360 - 90; // deg\n    const rad = mid * Math.PI/180;\n    const rr  = r - stroke*0.10;\n    const x = cx + rr * Math.cos(rad);\n    const y = cy + rr * Math.sin(rad);\n    return {x,y};\n  };\n\n  const pSolar = pos(0, solar);\n  const pEDF   = pos(C*(solar/total), edf);\n  const pSurp  = pos(C*(solar/total)+C*(edf/total), surp);\n\n  // Texte pour chaque part (seulement si assez grand)\n  const labelIf = (val, p, col) => {\n    if (val <= total*0.04) return ''; // √©vite chevauchements si trop petit\n    return `<text x=\"${p.x}\" y=\"${p.y}\" text-anchor=\"middle\"\n            dominant-baseline=\"middle\"\n            style=\"font-weight:700; fill:#fff; font-size:16px; paint-order:stroke; stroke:rgba(0,0,0,.35); stroke-width:3px;\">\n            ${fmt(val)}\n            </text>`;\n  };\n\n  // SVG : base blanche + trois arcs\n  return `\n    <svg viewBox=\"0 0 ${size} ${size}\" width=\"${size}\" height=\"${size}\">\n      <!-- anneau de fond blanc (sert aussi de s√©parateur) -->\n      <circle cx=\"${cx}\" cy=\"${cy}\" r=\"${r}\"\n              fill=\"none\" stroke=\"white\" stroke-width=\"${stroke}\"></circle>\n\n      <!-- parts -->\n      <g transform=\"rotate(-90 ${cx} ${cy})\">\n        <circle cx=\"${cx}\" cy=\"${cy}\" r=\"${r}\"\n          fill=\"none\" stroke=\"${cSolar}\" stroke-width=\"${stroke}\"\n          stroke-dasharray=\"${Lsolar} ${C}\" stroke-linecap=\"butt\"\n          stroke-dashoffset=\"0\"></circle>\n        <circle cx=\"${cx}\" cy=\"${cy}\" r=\"${r}\"\n          fill=\"none\" stroke=\"${cEDF}\" stroke-width=\"${stroke}\"\n          stroke-dasharray=\"${Ledf} ${C}\" stroke-linecap=\"butt\"\n          stroke-dashoffset=\"-${offEDF}\"></circle>\n        <circle cx=\"${cx}\" cy=\"${cy}\" r=\"${r}\"\n          fill=\"none\" stroke=\"${cSurp}\" stroke-width=\"${stroke}\"\n          stroke-dasharray=\"${Lsurp} ${C}\" stroke-linecap=\"butt\"\n          stroke-dashoffset=\"-${offSurp}\"></circle>\n      </g>\n\n      <!-- √©tiquettes valeurs -->\n      ${labelIf(solar, pSolar, cSolar)}\n      ${labelIf(edf,   pEDF,   cEDF)}\n      ${labelIf(surp,  pSurp,  cSurp)}\n    </svg>`;\n]]]\n",
                "legend": "[[[\n  const solar = Number(states['sensor.energie_autoconsommee_2']?.state) || 0;\n  const edf   = Number(states['sensor.import_edf_quotidien']?.state) || 0;\n  const surp  = Number(states['sensor.export_daily_2']?.state) || 0;\n  const fmt = (x) => (x >= 1 ? Math.round(x) : Math.round(x*10)/10)\n                      .toLocaleString('fr-FR');\n\n  return `\n    <div style=\"display:flex; gap:18px; justify-content:center; flex-wrap:wrap;\">\n      <div><span style=\"display:inline-block;width:12px;height:12px;border-radius:50%;background:#ffd700;margin-right:6px;\"></span>\n           Solaire: <b>${fmt(solar)}</b> kWh</div>\n      <div><span style=\"display:inline-block;width:12px;height:12px;border-radius:50%;background:#0074D9;margin-right:6px;\"></span>\n           EDF: <b>${fmt(edf)}</b> kWh</div>\n      <div><span style=\"display:inline-block;width:12px;height:12px;border-radius:50%;background:#ff4136;margin-right:6px;\"></span>\n           Surplus: <b>${fmt(surp)}</b> kWh</div>\n    </div>`;\n]]]\n"
              }
            },
            {
              "type": "horizontal-stack",
              "cards": [
                {
                  "type": "custom:button-card",
                  "show_name": false,
                  "show_state": false,
                  "styles": {
                    "card": [
                      {
                        "padding": "6px"
                      },
                      {
                        "border-radius": "16px"
                      },
                      {
                        "--ring-max": "280px"
                      }
                    ],
                    "grid": [
                      {
                        "grid-template-areas": "\"title\" \"pie\""
                      },
                      {
                        "grid-template-rows": "auto 1fr"
                      },
                      {
                        "grid-template-columns": "1fr"
                      }
                    ],
                    "custom_fields": {
                      "title": [
                        {
                          "justify-self": "start"
                        },
                        {
                          "font-weight": 600
                        },
                        {
                          "font-size": "1rem"
                        },
                        {
                          "padding": "0 2px 4px"
                        }
                      ],
                      "pie": [
                        {
                          "width": "100%"
                        },
                        {
                          "max-width": "var(--ring-max)"
                        },
                        {
                          "aspect-ratio": "1 / 1"
                        },
                        {
                          "margin": "0 auto"
                        },
                        {
                          "justify-self": "center"
                        }
                      ]
                    }
                  },
                  "custom_fields": {
                    "title": "√ânergie d‚Äôaujourd‚Äôhui",
                    "pie": "[[[\n  // Donn√©es\n  const idSolar='sensor.energie_autoconsommee_2';\n  const idEDF='sensor.import_edf_quotidien';\n  const idSurplus='sensor.export_daily_2';\n  const v=id=>Number(states[id]?.state)||0;\n  const solar=v(idSolar), edf=v(idEDF), surp=v(idSurplus);\n  const sum = solar+edf+surp;\n\n  // Couleurs\n  const cSolar='#ffd700', cEDF='#0074D9', cSurp='#ff4136';\n  const cGrey = getComputedStyle(document.documentElement).getPropertyValue('--disabled-color') || '#c8c8c8';\n\n  // G√©om√©trie fixe dans le viewBox (elle s'agrandit/retr√©cit avec width:100%)\n  const S=200, cx=100, cy=100, r=76, stroke=32;  // √ò‚âà200 ; √©paisseur relative (32/200)\n  const C=2*Math.PI*r, gap=2;\n  const fmt = x => (x>=1 ? Math.round(x) : Math.round(x*10)/10).toLocaleString('fr-FR');\n\n  // Taille de police responsive (en fonction de la largeur r√©elle de la carte)\n  const sizePx = this.offsetWidth || 220;\n  const f = (min, k, max)=>Math.max(min, Math.min(max, sizePx*k));\n  const fs = {\n    line:  f(12, .045, 16)  // 12‚Äì16 px\n  };\n\n  const centerLegend = (svg) => `\n    <div style=\"position:relative;width:100%;height:100%;\">\n      ${svg}\n      <div style=\"position:absolute;inset:0;display:grid;place-items:center;\">\n        <div style=\"text-align:center;line-height:1;display:flex;flex-direction:column;gap:2px;font-size:${fs.line}px\">\n          <div style=\"white-space:nowrap;\">\n            <span style=\"display:inline-block;width:10px;height:10px;border-radius:50%;background:${cSolar};margin-right:6px;\"></span>\n            Solaire <b>${fmt(solar)}</b> kWh\n          </div>\n          <div style=\"white-space:nowrap;\">\n            <span style=\"display:inline-block;width:10px;height:10px;border-radius:50%;background:${cEDF};margin-right:6px;\"></span>\n            EDF <b>${fmt(edf)}</b> kWh\n          </div>\n          <div style=\"white-space:nowrap;\">\n            <span style=\"display:inline-block;width:10px;height:10px;border-radius:50%;background:${cSurp};margin-right:6px;\"></span>\n            Surplus <b>${fmt(surp)}</b> kWh\n          </div>\n        </div>\n      </div>\n    </div>`;\n\n  if (sum <= 0.00001) {\n    const svg = `\n      <svg viewBox=\"0 0 ${S} ${S}\" width=\"100%\" height=\"100%\">\n        <circle cx=\"${cx}\" cy=\"${cy}\" r=\"${r}\" fill=\"none\" stroke=\"white\" stroke-width=\"${stroke}\"></circle>\n        <g transform=\"rotate(-90 ${cx} ${cy})\">\n          <circle cx=\"${cx}\" cy=\"${cy}\" r=\"${r}\" fill=\"none\" stroke=\"${cGrey}\" stroke-width=\"${stroke}\"></circle>\n        </g>\n      </svg>`;\n    return centerLegend(svg);\n  }\n\n  const total=sum;\n  const len = val => Math.max(C*(val/total)-gap,0);\n  const Lsolar=len(solar), Ledf=len(edf), Lsurp=len(surp);\n  const offEDF  =  C*(solar/total);\n  const offSurp =  offEDF + C*(edf/total);\n\n  const svg = `\n    <svg viewBox=\"0 0 ${S} ${S}\" width=\"100%\" height=\"100%\">\n      <circle cx=\"${cx}\" cy=\"${cy}\" r=\"${r}\" fill=\"none\" stroke=\"white\" stroke-width=\"${stroke}\"></circle>\n      <g transform=\"rotate(-90 ${cx} ${cy})\">\n        <circle cx=\"${cx}\" cy=\"${cy}\" r=\"${r}\" fill=\"none\" stroke=\"${cSolar}\" stroke-width=\"${stroke}\"\n                stroke-dasharray=\"${Lsolar} ${C}\"></circle>\n        <circle cx=\"${cx}\" cy=\"${cy}\" r=\"${r}\" fill=\"none\" stroke=\"${cEDF}\" stroke-width=\"${stroke}\"\n                stroke-dasharray=\"${Ledf} ${C}\" stroke-dashoffset=\"-${offEDF}\"></circle>\n        <circle cx=\"${cx}\" cy=\"${cy}\" r=\"${r}\" fill=\"none\" stroke=\"${cSurp}\" stroke-width=\"${stroke}\"\n                stroke-dasharray=\"${Lsurp} ${C}\" stroke-dashoffset=\"-${offSurp}\"></circle>\n      </g>\n    </svg>`;\n  return centerLegend(svg);\n]]]\n"
                  }
                },
                {
                  "type": "custom:button-card",
                  "show_name": false,
                  "show_state": false,
                  "styles": {
                    "card": [
                      {
                        "padding": "6px"
                      },
                      {
                        "border-radius": "16px"
                      },
                      {
                        "--ring-max": "280px"
                      }
                    ],
                    "grid": [
                      {
                        "grid-template-areas": "\"title\" \"ring\""
                      },
                      {
                        "grid-template-rows": "auto 1fr"
                      },
                      {
                        "grid-template-columns": "1fr"
                      }
                    ],
                    "custom_fields": {
                      "title": [
                        {
                          "justify-self": "start"
                        },
                        {
                          "font-weight": 600
                        },
                        {
                          "font-size": "1rem"
                        },
                        {
                          "padding": "0 2px 4px"
                        }
                      ],
                      "ring": [
                        {
                          "width": "100%"
                        },
                        {
                          "max-width": "var(--ring-max)"
                        },
                        {
                          "aspect-ratio": "1 / 1"
                        },
                        {
                          "margin": "0 auto"
                        },
                        {
                          "justify-self": "center"
                        }
                      ]
                    }
                  },
                  "custom_fields": {
                    "title": "Batterie",
                    "ring": "[[[\n  const soc = Math.round(Number(states['sensor.solarbank_3_e2700_pro_etat_de_charge']?.state) || 0);\n  const p   = Number(states['sensor.solarbank_3_e2700_pro_puissance_de_charge']?.state) || 0;\n  const charging = p > 20, discharg = p < -20;\n\n  // G√©om√©trie identique au camembert (viewBox fixe, rendu responsive)\n  const S=200, cx=100, cy=100, r=76, stroke=32;\n  const C=2*Math.PI*r;\n\n  const color = charging ? 'var(--success-color, #16a34a)'\n                         : (discharg ? 'var(--error-color, #ef4444)'\n                                     : 'var(--secondary-text-color)');\n  const sign  = charging ? '+' : (discharg ? '‚àí' : '');\n  const watts = (charging || discharg) ? `${sign}${Math.round(Math.abs(p))} W` : '0 W';\n\n  // Polices responsives\n  const sizePx = this.offsetWidth || 220;\n  const f = (min, k, max)=>Math.max(min, Math.min(max, sizePx*k));\n  const fsPct = f(14, .055, 18);\n  const fsW   = f(12, .05, 16);\n\n  const Lcol = Math.max(C * (soc/100), 0);\n  const Lrem = Math.max(C - Lcol, 0);\n\n  return `\n    <div style=\"position:relative;width:100%;height:100%;\">\n      <svg viewBox=\"0 0 ${S} ${S}\" width=\"100%\" height=\"100%\">\n        <circle cx=\"${cx}\" cy=\"${cy}\" r=\"${r}\" fill=\"none\" stroke=\"white\" stroke-width=\"${stroke}\"></circle>\n        <g transform=\"rotate(-90 ${cx} ${cy})\">\n          <circle cx=\"${cx}\" cy=\"${cy}\" r=\"${r}\" fill=\"none\" stroke=\"${color}\" stroke-width=\"${stroke}\"\n                  stroke-dasharray=\"${Lcol} ${C}\"></circle>\n          <circle cx=\"${cx}\" cy=\"${cy}\" r=\"${r}\" fill=\"none\"\n                  stroke=\"var(--disabled-color)\" stroke-width=\"${stroke}\"\n                  stroke-dasharray=\"${Lrem} ${C}\" stroke-dashoffset=\"-${Lcol}\"></circle>\n        </g>\n      </svg>\n      <div style=\"position:absolute;inset:0;display:grid;place-items:center;\">\n        <div style=\"text-align:center;line-height:1;display:flex;flex-direction:column;gap:2px\">\n          <ha-icon icon=\"${charging ? 'mdi:battery-charging' : (discharg ? 'mdi:battery-arrow-down' : 'mdi:battery')}\"\n                   style=\"width:20px;height:20px;color:${color};\"></ha-icon>\n          <div style=\"font-weight:700;font-size:${fsPct}px;\">${soc}%</div>\n          <div style=\"font-size:${fsW}px;color:${color};\">${watts}</div>\n        </div>\n      </div>\n    </div>\n  `;\n]]]\n"
                  }
                }
              ]
            },
            {
              "type": "custom:power-flow-card-plus",
              "title": "Flux d'√©nergie ‚Äî Maison",
              "dashboard_link": "/energy",
              "kw_decimals": 1,
              "w_decimals": 0,
              "watt_threshold": 10000,
              "use_new_flow_rate_model": true,
              "display_zero_lines": {
                "mode": "grey_out"
              },
              "entities": {
                "grid": {
                  "entity": {
                    "consumption": "sensor.smart_meter_grid_import",
                    "production": "sensor.smart_meter_grid_export"
                  },
                  "display_state": "one_way",
                  "color_circle": true
                },
                "solar": {
                  "entity": "sensor.cumulus_prod_pv_w"
                },
                "battery": {
                  "entity": "sensor.solarbank_3_e2700_pro_puissance_de_charge",
                  "state_of_charge": "sensor.cumulus_soc_batt_pct",
                  "state_of_charge_decimals": 0,
                  "display_state": "one_way"
                },
                "individual": [
                  {
                    "entity": "sensor.cumulus_puissance_estimee_w",
                    "name": "Cumulus",
                    "icon": "mdi:water-boiler",
                    "color": {
                      "consumption": "#ff7043",
                      "production": "#ff7043"
                    },
                    "secondary_info": {
                      "entity": "switch.shellypro1_ece334ee1b64",
                      "icon": "mdi:toggle-switch"
                    },
                    "display_zero_state": false
                  }
                ]
              }
            }
          ]
        },
        {
          "title": "Planning ‚Äî TEST",
          "path": "planning-test",
          "icon": "mdi:calendar-check",
          "panel": false,
          "badges": [],
          "cards": [
            {
              "type": "calendar",
              "entities": [
                "calendar.planning_cours_isa",
                "calendar.jours_feries_en_france",
                "calendar.vacances_scolaires"
              ],
              "initial_view": "list",
              "max_days_to_show": 14
            },
            {
              "type": "weather-forecast",
              "entity": "weather.biscarrosse"
            },
            {
              "type": "entities",
              "title": "Diagnostic rapide",
              "entities": [
                "calendar.planning_cours_isa",
                "calendar.jours_feries_en_france",
                "calendar.vacances_scolaires",
                "weather.biscarrosse"
              ]
            }
          ]
        }
      ]
    }
  }
}