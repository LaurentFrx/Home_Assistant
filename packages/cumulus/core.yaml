# ╔══════════════════════════════════════════════════════════════════════════╗
# ║ CUMULUS INTELLIGENT - MODULE CORE                                          ║
# ║ Input helpers et configuration de base                                     ║
# ╚══════════════════════════════════════════════════════════════════════════╝
#
# Ce module contient tous les paramètres configurables du système cumulus.
# Architecture 4 couches : Config → Sensors → Détecteurs → Contrôle
#
# Version: 2.0.0
# Auteur: Laurent
# Dernière mise à jour: 2024-11

# ┌─────────────────────────────────────────────────────────────────────────┐
# │ SEUILS DE PUISSANCE                                                      │
# └─────────────────────────────────────────────────────────────────────────┘
input_number:
  # Seuil minimal de production PV pour démarrage (W)
  cumulus_seuil_pv_statique_w:
    name: "Cumulus - Seuil PV statique"
    min: 0
    max: 500
    step: 10
    initial: 100
    unit_of_measurement: "W"
    icon: mdi:solar-power

  # Seuil PV ajusté dynamiquement selon SOC batterie
  cumulus_seuil_pv_dynamique_w:
    name: "Cumulus - Seuil PV dynamique"
    min: 0
    max: 500
    step: 10
    initial: 100
    unit_of_measurement: "W"
    icon: mdi:solar-power-variant

  # Import maximal autorisé depuis le réseau (W)
  cumulus_import_max_w:
    name: "Cumulus - Import max réseau"
    min: 0
    max: 2000
    step: 50
    initial: 500
    unit_of_measurement: "W"
    icon: mdi:transmission-tower-import

  # Consommation de base de la maison (W)
  cumulus_talon_maison_w:
    name: "Cumulus - Talon maison"
    min: 0
    max: 1000
    step: 50
    initial: 400
    unit_of_measurement: "W"
    icon: mdi:home-lightning-bolt

  # Puissance maximale extractible de la Solarbank (W)
  cumulus_solarbank_max_w:
    name: "Cumulus - Puissance max Solarbank"
    min: 0
    max: 2000
    step: 100
    initial: 1200
    unit_of_measurement: "W"
    icon: mdi:battery-charging

# ┌─────────────────────────────────────────────────────────────────────────┐
# │ TEMPÉRATURES CIBLES                                                      │
# └─────────────────────────────────────────────────────────────────────────┘
  # Température cible en mode PV (°C)
  cumulus_temperature_cible_pv:
    name: "Cumulus - Température cible PV"
    min: 45
    max: 65
    step: 1
    initial: 58
    unit_of_measurement: "°C"
    icon: mdi:thermometer-high

  # Température cible en heures creuses (°C)
  cumulus_temperature_cible_hc:
    name: "Cumulus - Température cible HC"
    min: 40
    max: 60
    step: 1
    initial: 52
    unit_of_measurement: "°C"
    icon: mdi:thermometer-low

  # Température minimale absolue (sécurité légionelle)
  cumulus_temperature_minimale:
    name: "Cumulus - Température minimale"
    min: 35
    max: 50
    step: 1
    initial: 42
    unit_of_measurement: "°C"
    icon: mdi:thermometer-alert

  # Gradient de refroidissement (°C/heure)
  cumulus_gradient_refroidissement:
    name: "Cumulus - Gradient refroidissement"
    min: 0.1
    max: 2.0
    step: 0.1
    initial: 0.8
    unit_of_measurement: "°C/h"
    icon: mdi:trending-down

# ┌─────────────────────────────────────────────────────────────────────────┐
# │ TEMPORISATIONS ET DÉLAIS                                                │
# └─────────────────────────────────────────────────────────────────────────┘
  # Délai avant démarrage effectif (anti-oscillation)
  cumulus_delai_on_secondes:
    name: "Cumulus - Délai démarrage"
    min: 5
    max: 300
    step: 5
    initial: 30
    unit_of_measurement: "s"
    icon: mdi:timer-play

  # Délai avant arrêt effectif (anti-oscillation)
  cumulus_delai_off_secondes:
    name: "Cumulus - Délai arrêt"
    min: 5
    max: 300
    step: 5
    initial: 60
    unit_of_measurement: "s"
    icon: mdi:timer-stop

  # Espacement minimal entre deux chauffes (heures)
  cumulus_espacement_minimal_heures:
    name: "Cumulus - Espacement minimal chauffes"
    min: 1
    max: 72
    step: 1
    initial: 24
    unit_of_measurement: "h"
    icon: mdi:hours-24

  # SOC minimum batterie pour démarrage PV (%)
  cumulus_soc_min:
    name: "Cumulus - SOC minimum"
    min: 5
    max: 50
    step: 5
    initial: 10
    unit_of_measurement: "%"
    icon: mdi:battery-low

# ┌─────────────────────────────────────────────────────────────────────────┐
# │ FENÊTRE HORAIRE PV                                                      │
# └─────────────────────────────────────────────────────────────────────────┘
input_datetime:
  # Heure de début de la fenêtre PV
  cumulus_heure_debut_pv:
    name: "Cumulus - Début fenêtre PV"
    has_date: false
    has_time: true
    initial: "09:00:00"
    icon: mdi:weather-sunset-up

  # Heure de fin de la fenêtre PV
  cumulus_heure_fin_pv:
    name: "Cumulus - Fin fenêtre PV"
    has_date: false
    has_time: true
    initial: "17:00:00"
    icon: mdi:weather-sunset-down

# ┌─────────────────────────────────────────────────────────────────────────┐
# │ MODES ET VERROUS                                                        │
# └─────────────────────────────────────────────────────────────────────────┘
input_boolean:
  # Mode vacances (désactive les chauffes automatiques)
  cumulus_mode_vacances:
    name: "Cumulus - Mode vacances"
    initial: false
    icon: mdi:beach

  # Verrou anti-oscillation (deadband)
  cumulus_verrou_deadband:
    name: "Cumulus - Verrou deadband"
    initial: false
    icon: mdi:lock-clock

  # Verrou chauffe quotidienne (une fois par jour max)
  cumulus_verrou_chauffe_quotidienne:
    name: "Cumulus - Verrou chauffe quotidienne"
    initial: false
    icon: mdi:lock-check

  # Activation mode prédictif
  cumulus_mode_predictif:
    name: "Cumulus - Mode prédictif"
    initial: true
    icon: mdi:crystal-ball

  # Activation notifications
  cumulus_notifications_actives:
    name: "Cumulus - Notifications actives"
    initial: true
    icon: mdi:bell

  # Mode debug (logs détaillés)
  cumulus_mode_debug:
    name: "Cumulus - Mode debug"
    initial: false
    icon: mdi:bug

# ┌─────────────────────────────────────────────────────────────────────────┐
# │ STRATÉGIES D'OPTIMISATION                                               │
# └─────────────────────────────────────────────────────────────────────────┘
input_select:
  # Stratégie d'optimisation globale
  cumulus_strategie_optimisation:
    name: "Cumulus - Stratégie optimisation"
    options:
      - "Économie maximale"      # Minimise coût électrique
      - "Confort absolu"         # Eau chaude toujours disponible
      - "Préserver batterie"     # Limite cycles Solarbank
      - "Équilibré"             # Compromis intelligent (défaut)
      - "Personnalisé"          # Paramètres manuels
    initial: "Équilibré"
    icon: mdi:tune-variant

  # Mode de calcul température
  cumulus_mode_calcul_temperature:
    name: "Cumulus - Mode calcul température"
    options:
      - "Estimation simple"      # Gradient fixe
      - "Estimation adaptative"  # Apprentissage du gradient
      - "Capteur physique"      # Si capteur disponible (futur)
    initial: "Estimation adaptative"
    icon: mdi:thermometer-lines

# ┌─────────────────────────────────────────────────────────────────────────┐
# │ STOCKAGE TEXTE (historique, logs, raisons)                             │
# └─────────────────────────────────────────────────────────────────────────┘
input_text:
  # Raison du dernier arrêt (pour debug)
  cumulus_raison_arret:
    name: "Cumulus - Raison arrêt"
    initial: "Initialisation"
    max: 255
    icon: mdi:text-box

  # Raison du deadband actif
  cumulus_raison_deadband:
    name: "Cumulus - Raison deadband"
    initial: "Aucun"
    max: 255
    icon: mdi:text-box-outline

  # Historique des chauffes (JSON)
  cumulus_historique_chauffes:
    name: "Cumulus - Historique chauffes"
    initial: "[]"
    max: 5000
    icon: mdi:history

  # Configuration sauvegardée (backup)
  cumulus_config_backup:
    name: "Cumulus - Config backup"
    initial: "{}"
    max: 5000
    icon: mdi:content-save

  # Dernière notification envoyée
  cumulus_derniere_notification:
    name: "Cumulus - Dernière notification"
    initial: ""
    max: 255
    icon: mdi:message-text

# ┌─────────────────────────────────────────────────────────────────────────┐
# │ COMPTEURS ET STATISTIQUES                                              │
# └─────────────────────────────────────────────────────────────────────────┘
counter:
  # Nombre de chauffes aujourd'hui
  cumulus_chauffes_jour:
    name: "Cumulus - Chauffes du jour"
    initial: 0
    step: 1
    icon: mdi:counter

  # Nombre de chauffes ce mois
  cumulus_chauffes_mois:
    name: "Cumulus - Chauffes du mois"
    initial: 0
    step: 1
    icon: mdi:calendar-month

  # Nombre d'erreurs aujourd'hui
  cumulus_erreurs_jour:
    name: "Cumulus - Erreurs du jour"
    initial: 0
    step: 1
    icon: mdi:alert-circle

# ┌─────────────────────────────────────────────────────────────────────────┐
# │ TIMERS                                                                   │
# └─────────────────────────────────────────────────────────────────────────┘
timer:
  # Timer pour le deadband (anti-oscillation)
  cumulus_timer_deadband:
    name: "Cumulus - Timer deadband"
    duration: "00:05:00"
    icon: mdi:timer-sand

  # Timer pour la chauffe en cours
  cumulus_timer_chauffe:
    name: "Cumulus - Timer chauffe"
    duration: "02:30:00"
    icon: mdi:timer

  # Timer pour le mode boost
  cumulus_timer_boost:
    name: "Cumulus - Timer boost"
    duration: "01:00:00"
    icon: mdi:timer-alert
